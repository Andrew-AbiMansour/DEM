

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>simulation.PyGranSim.engine_liggghts &mdash; PyGran 1.2.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/main.css" type="text/css" />

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="PyGran 1.2.0 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../../index.html" class="fa fa-home"> PyGran</a>
        
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">PyGran’s documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">What is PyGran?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#brief-summary-of-dem">Brief summary of DEM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#installation">Installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../simulation.html">Simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../simulation.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../simulation.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../simulation.html#numerical-analysis">Numerical analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../simulation.html#dem-simulation">DEM simulation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../analysis.html">Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis.html#systems-subsystems">Systems &amp; SubSystems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../zreferences.html">Bibliography</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">PyGran</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>simulation.PyGranSim.engine_liggghts</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for simulation.PyGranSim.engine_liggghts</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Python wrapper for LIGGGHTS library via ctypes</span>

<span class="sd">Created on March 30, 2016</span>

<span class="sd">Author: Andrew Abi-Mansour</span>

<span class="sd">This is the::</span>

<span class="sd">  ██████╗ ██╗   ██╗ ██████╗ ██████╗  █████╗ ███╗   ██╗</span>
<span class="sd">  ██╔══██╗╚██╗ ██╔╝██╔════╝ ██╔══██╗██╔══██╗████╗  ██║</span>
<span class="sd">  ██████╔╝ ╚████╔╝ ██║  ███╗██████╔╝███████║██╔██╗ ██║</span>
<span class="sd">  ██╔═══╝   ╚██╔╝  ██║   ██║██╔══██╗██╔══██║██║╚██╗██║</span>
<span class="sd">  ██║        ██║   ╚██████╔╝██║  ██║██║  ██║██║ ╚████║</span>
<span class="sd">  ╚═╝        ╚═╝    ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═══╝</span>

<span class="sd">DEM simulation and analysis toolkit</span>
<span class="sd">http://www.pygran.org, support@pygran.org</span>

<span class="sd">Core developer and main author:</span>
<span class="sd">Andrew Abi-Mansour, andrew.abi.mansour@pygran.org</span>

<span class="sd">PyGran is open-source, distributed under the terms of the GNU Public</span>
<span class="sd">License, version 2 or later. It is distributed in the hope that it will</span>
<span class="sd">be useful, but WITHOUT ANY WARRANTY; without even the implied warranty</span>
<span class="sd">of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. You should have</span>
<span class="sd">received a copy of the GNU General Public License along with PyGran.</span>
<span class="sd">If not, see http://www.gnu.org/licenses . See also top-level README</span>
<span class="sd">and LICENSE files.</span>

<span class="sd">This file was modified from the LAMMPS source code.</span>

<span class="sd">LAMMPS - Large-scale Atomic/Molecular Massively Parallel Simulator</span>
<span class="sd">http://lammps.sandia.gov, Sandia National Laboratories</span>
<span class="sd">Steve Plimpton, sjplimp@sandia.gov</span>

<span class="sd">Copyright (2003) Sandia Corporation.  Under the terms of Contract</span>
<span class="sd">DE-AC04-94AL85000 with Sandia Corporation, the U.S. Government retains</span>
<span class="sd">certain rights in this software.  This software is distributed under</span>
<span class="sd">the GNU General Public License.</span>

<span class="sd">See the README file in the top-level LAMMPS directory.</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="k">import</span> <span class="n">MPI</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="k">import</span> <span class="n">import_module</span>
<span class="kn">from</span> <span class="nn">.tools</span> <span class="k">import</span> <span class="n">find</span><span class="p">,</span> <span class="n">dictToTuple</span>

<div class="viewcode-block" id="liggghts"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.liggghts">[docs]</a><span class="k">class</span> <span class="nc">liggghts</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  A class that provides API-like access to LIGGGHTS-PUBLIC</span>

<span class="sd">  :param library: full path to the LIGGGHTS-PUBLIC module (.so file)</span>
<span class="sd">  :type library: str</span>

<span class="sd">  :param style: particle type (&#39;spherical&#39; by default)</span>
<span class="sd">  :type style: str</span>

<span class="sd">  :param dim: simulation box dimension (default 3)</span>
<span class="sd">  :type dim: int</span>

<span class="sd">  :param units: unit system (default &#39;si&#39;). See `here &lt;https://www.cfdem.com/media/DEM/docu/units.html&gt;`_ for available options.</span>
<span class="sd">  :type units: str</span>
<span class="sd">  &quot;&quot;&quot;</span>
  
  <span class="c1"># detect if Python is using version of mpi4py that can pass a communicator</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">mpi4py</span> <span class="k">import</span> <span class="n">MPI</span>
  <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="k">pass</span>

  <span class="c1"># create instance of LIGGGHTS</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">library</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;spherical&#39;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;si&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmdargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">comm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ptr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># What is ptr used for?</span>

    <span class="k">if</span> <span class="n">library</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using &quot;</span> <span class="o">+</span> <span class="n">library</span> <span class="o">+</span> <span class="s2">&quot; as a shared library for DEM computations&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No library supplies.&#39;</span><span class="p">)</span>
      
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">comm</span><span class="p">:</span>
      <span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="n">library</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">RTLD_GLOBAL</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="n">etype</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
      <span class="n">traceback</span><span class="o">.</span><span class="n">print_exception</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">tb</span><span class="p">)</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Could not load LIGGGHTS dynamic library&quot;</span><span class="p">)</span>

    <span class="c1"># if no ptr provided, create an instance of LIGGGHTS</span>
    <span class="c1">#   don&#39;t know how to pass an MPI communicator from PyPar</span>
    <span class="c1">#   but we can pass an MPI communicator from mpi4py v2.0.0 and later</span>
    <span class="c1">#   no_mpi call lets LIGGGHTS use MPI_COMM_WORLD</span>
    <span class="c1">#   cargs = array of C strings from args</span>
    <span class="c1"># if ptr, then are embedding Python in LIGGGHTS input script</span>
    <span class="c1">#   ptr is the desired instance of LIGGGHTS</span>
    <span class="c1">#   just convert it to ctypes ptr and store in self.lmp</span>

    <span class="k">if</span> <span class="n">MPI</span><span class="o">.</span><span class="n">_sizeof</span><span class="p">(</span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm</span><span class="p">)</span> <span class="o">==</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">sizeof</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">):</span>
      <span class="n">MPI_Comm</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">MPI_Comm</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ptr</span><span class="p">:</span>
      <span class="c1"># with mpi4py v2, can pass MPI communicator to LIGGGHTS</span>
      <span class="c1"># need to adjust for type of MPI communicator object</span>
      <span class="c1"># allow for int (like MPICH) or void* (like OpenMPI)</span>

        <span class="n">narg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cargs</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">cmdargs</span><span class="p">:</span>
          <span class="n">cmdargs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;liggghts.py&quot;</span><span class="p">)</span>
          <span class="n">narg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmdargs</span><span class="p">)</span>
          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">narg</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmdargs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
              <span class="n">cmdargs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmdargs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

          <span class="n">cargs</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="o">*</span><span class="n">narg</span><span class="p">)(</span><span class="o">*</span><span class="n">cmdargs</span><span class="p">)</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="o">*</span><span class="n">narg</span><span class="p">,</span> \
                                           <span class="n">MPI_Comm</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> \
                                           <span class="n">MPI_Comm</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()</span>
        <span class="n">comm_ptr</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">_addressof</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
        <span class="n">comm_val</span> <span class="o">=</span> <span class="n">MPI_Comm</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="n">comm_ptr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open</span><span class="p">(</span><span class="n">narg</span><span class="p">,</span><span class="n">cargs</span><span class="p">,</span><span class="n">comm_val</span><span class="p">,</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="kc">False</span>

      <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c1"># Python 3 (uses PyCapsule API)</span>
        <span class="n">ctypes</span><span class="o">.</span><span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCapsule_GetPointer</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>
        <span class="n">ctypes</span><span class="o">.</span><span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCapsule_GetPointer</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">py_object</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCapsule_GetPointer</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Python 2 (uses PyCObject API)</span>
        <span class="n">ctypes</span><span class="o">.</span><span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCObject_AsVoidPtr</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>
        <span class="n">ctypes</span><span class="o">.</span><span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCObject_AsVoidPtr</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">py_object</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCObject_AsVoidPtr</span><span class="p">(</span><span class="n">ptr</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;lmp&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">opened</span><span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="liggghts.file"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.liggghts.file">[docs]</a>  <span class="k">def</span> <span class="nf">file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function for loading LIGGGHTS input file scripts. </span>

<span class="sd">    :param file: input filename</span>
<span class="sd">    :type file: str</span>

<span class="sd">    .. note:: For python 3, &quot;file&quot; is encoded as an 8 character utf </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">file</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="liggghts.command"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.liggghts.command">[docs]</a>  <span class="k">def</span> <span class="nf">command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cmd</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function for executing a LIGGGHTS command</span>

<span class="sd">    :param cmd: input LIGGGHTS command</span>
<span class="sd">    :type cmd: str</span>

<span class="sd">    .. note:: For python 3, &quot;cmd&quot; is encoded as an 8 character utf </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">cmd</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span></div>

  <span class="k">def</span> <span class="nf">extract_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">extract_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ptr</span>

  <span class="k">def</span> <span class="nf">extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">style</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">ptr</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">ptr</span>
    <span class="k">return</span> <span class="kc">None</span>

  <span class="c1"># in case of global datum, free memory for 1 double via lammps_free()</span>
  <span class="c1"># double was allocated by library interface function</span>

  <span class="k">def</span> <span class="nf">extract_fix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_free</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">result</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">style</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">style</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">ptr</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="kc">None</span>

  <span class="c1"># free memory for 1 double or 1 vector of doubles via lammps_free()</span>
  <span class="c1"># for vector, must copy nlocal returned values to local c_double vector</span>
  <span class="c1"># memory was allocated by library interface function</span>

  <span class="k">def</span> <span class="nf">extract_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">group</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">group</span><span class="p">)</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_free</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">result</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)</span>
      <span class="n">nlocalptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="s2">&quot;nlocal&quot;</span><span class="p">)</span>
      <span class="n">nlocal</span> <span class="o">=</span> <span class="n">nlocalptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="o">*</span><span class="n">nlocal</span><span class="p">)()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">group</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">nlocal</span><span class="p">):</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_free</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="kc">None</span>

  <span class="c1"># set variable value</span>
  <span class="c1"># value is converted to string</span>
  <span class="c1"># returns 0 for success, -1 if failed</span>

  <span class="k">def</span> <span class="nf">set_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_set_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
  <span class="c1"># return total number of atoms in system</span>

  <span class="k">def</span> <span class="nf">get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>

  <span class="c1"># return vector of atom properties gathered across procs, ordered by atom ID</span>

  <span class="k">def</span> <span class="nf">gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">):</span>
    <span class="n">natoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">data</span> <span class="o">=</span> <span class="p">((</span><span class="n">count</span><span class="o">*</span><span class="n">natoms</span><span class="p">)</span><span class="o">*</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">data</span> <span class="o">=</span> <span class="p">((</span><span class="n">count</span><span class="o">*</span><span class="n">natoms</span><span class="p">)</span><span class="o">*</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">data</span>

  <span class="c1"># scatter vector of atom properties across procs, ordered by atom ID</span>
  <span class="c1"># assume vector is of correct type and length, as created by gather_atoms()</span>

  <span class="k">def</span> <span class="nf">scatter_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_scatter_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="DEMPy"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy">[docs]</a><span class="k">class</span> <span class="nc">DEMPy</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;A class that implements a python interface for DEM computations</span>

<span class="sd">  :param units: unit system (default &#39;si&#39;). See `ref &lt;https://www.cfdem.com/media/DEM/docu/units.html&gt;`_.</span>
<span class="sd">  :type units: str</span>

<span class="sd">  :param style: particle type (&#39;spherical&#39; by default)</span>
<span class="sd">  :type style: str</span>

<span class="sd">  :param split: MPI communicator</span>
<span class="sd">  :type comm: MPI Intracomm</span>

<span class="sd">  :param species: defines the number and properties of all species</span>
<span class="sd">  :type species: tuple</span>

<span class="sd">  :param output: output dir name</span>
<span class="sd">  :type output: str</span>

<span class="sd">  :param print: specify which variables to print to stdout: (freq, &#39;varName1&#39;, &#39;varName2&#39;, ...). Default is (10**4, &#39;time&#39;, &#39;dt&#39;, &#39;atoms&#39;).</span>
<span class="sd">  :type print: tuple</span>

<span class="sd">  :param library: full path to the LIGGGHTS-PUBLIC module (.so file)</span>
<span class="sd">  :type library: str</span>

<span class="sd">  :param dim: simulation box dimension (2 or 3)</span>
<span class="sd">  :type dim: int</span>

<span class="sd">  :param restart: specify restart options via (freq=int, dirname=str, filename=str, restart=bool, frame=int)</span>
<span class="sd">  :type restart: tuple</span>

<span class="sd">  :param boundary: setup boundary conditions (see `ref &lt;https://www.cfdem.com/media/DEM/docu/boundary.html&gt;`_), e.g. (&#39;p&#39;, &#39;p&#39;, &#39;p&#39;) -&gt; periodic boundaries in 3D.</span>
<span class="sd">  :type boundary: tuple</span>

<span class="sd">  .. todo:: This class should be generic (not specific to liggghts), must handle all I/O, garbage collection, etc. and then moved to DEM.py</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">library</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="o">**</span><span class="n">pargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Initialize some settings and specifications &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s1">&#39;print&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pargs</span><span class="p">:</span>
      <span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;dt&#39;</span><span class="p">,</span> <span class="s1">&#39;atoms&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">split</span> <span class="o">=</span> <span class="n">split</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span> <span class="o">=</span> <span class="n">pargs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">monitorList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nSS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_configdir</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span> <span class="s1">&#39;.config&#39;</span><span class="p">,</span> <span class="s1">&#39;PyGran&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_monitor</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># a list of tuples of (varname, filename) to monitor</span>

    <span class="k">if</span> <span class="s1">&#39;__version__&#39;</span> <span class="ow">in</span> <span class="n">pargs</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">__version__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;__version__&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="k">global</span> <span class="n">logging</span>

      <span class="n">logging</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;logging&#39;</span><span class="p">)</span>

      <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;pygran.log&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1">:</span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Working in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating i/o directories&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dir&#39;</span><span class="p">]):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dir&#39;</span><span class="p">])</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
          <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Instantiating LIGGGHTS object&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">liggghts</span><span class="p">(</span><span class="n">comm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">,</span> <span class="n">library</span><span class="o">=</span><span class="n">library</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">cmdargs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-log&#39;</span><span class="p">,</span> <span class="s1">&#39;liggghts.log&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up problem dimensions and boundaries&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;units </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]))</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__version__&#39;</span><span class="p">):</span> 
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&gt;=</span> <span class="mf">3.6</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;hard_particles yes&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># Get version from version_liggghts.txt. TODO: find a faster way to do this</span>
      <span class="c1"># by reading version from stdout, and move this to tools!</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">version_txt</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="s1">&#39;version_liggghts.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__liggghts__</span> <span class="o">=</span> <span class="n">version_txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;version_liggghts.txt&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">version_txt</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
          <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">__version__</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">major</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">minor</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not find LIGGGHTS version. Proceeding ... &#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__liggghts__</span> <span class="o">=</span> <span class="s1">&#39;n/a&#39;</span>

      <span class="c1"># Write version + src dir to config file if it exists</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
        <span class="n">liggghts_ini</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_configdir</span><span class="p">,</span> <span class="s1">&#39;liggghts.ini&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">liggghts_ini</span><span class="p">):</span>
          <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">liggghts_ini</span><span class="p">,</span> <span class="s1">&#39;a+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">src=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__liggghts__</span><span class="p">))</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">version=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&gt;=</span> <span class="mf">3.6</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;hard_particles yes&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dimension </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;atom_style </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;atom_modify map array&#39;</span><span class="p">)</span> <span class="c1"># array is faster than hash in looking up atomic IDs, but the former takes more memory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;boundary &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;boundary&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;boundary&#39;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;newton off&#39;</span><span class="p">)</span> <span class="c1"># turn off newton&#39;s 3rd law ~ should lead to better scalability</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;communicate single vel yes&#39;</span><span class="p">)</span> <span class="c1"># have no idea what this does, but it&#39;s imp for ghost atoms</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;processors * * *&#39;</span><span class="p">)</span> <span class="c1"># let LIGGGHTS handle DD</span>

  <span class="k">def</span> <span class="nf">get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">scatter_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">scatter_atoms</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">gather_atoms</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">extract_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_global</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_compute</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">extract_fix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_fix</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>  

<div class="viewcode-block" id="DEMPy.createDomain"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.createDomain">[docs]</a>  <span class="k">def</span> <span class="nf">createDomain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Define the domain of the simulation &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating domain&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;box&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;region domain block &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; units box volume_limit 1e-20&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;cylinder&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;region domain cylinder &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;cylinder&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;cylinder&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; units box volume_limit 1e-20&#39;</span><span class="p">)</span> 

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;create_box </span><span class="si">{}</span><span class="s1"> domain&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;nSS&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="DEMPy.setupParticles"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.setupParticles">[docs]</a>  <span class="k">def</span> <span class="nf">setupParticles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Setup particle for insertion if requested by the user &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]:</span>

      <span class="c1"># Make sure we are setting up particles, not walls (so we check for id existence)</span>
      <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">ss</span> <span class="ow">and</span> <span class="s1">&#39;wall&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
          <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up particles for group</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">))</span>

        <span class="n">randName</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">pddName</span> <span class="o">=</span> <span class="s1">&#39;pdd&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">))</span>

        <span class="k">if</span> <span class="s1">&#39;vol_lim&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
          <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;vol_lim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-20</span>

        <span class="nb">id</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;group group</span><span class="si">{}</span><span class="s1"> type </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="s1">&#39;args&#39;</span><span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
          <span class="n">args</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">args</span> <span class="o">=</span> <span class="p">()</span>

        <span class="k">if</span> <span class="s1">&#39;radius&#39;</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
          <span class="n">radius</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span>

          <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>

          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;group</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; particletemplate/</span><span class="si">{style}</span><span class="s1"> 15485867 volume_limit </span><span class="si">{vol_lim}</span><span class="s1"> atom_type </span><span class="si">{id}</span><span class="s1"> density constant </span><span class="si">{density}</span><span class="s1"> radius&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">radius</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">radius</span><span class="p">)</span> \
          <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;group</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; particletemplate/</span><span class="si">{style}</span><span class="s1"> 15485867 volume_limit </span><span class="si">{vol_lim}</span><span class="s1"> atom_type </span><span class="si">{id}</span><span class="s1"> density constant </span><span class="si">{density}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pddName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;group</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; particledistribution/discrete 67867967 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="si">{}</span><span class="s1"> 1.0&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">))</span>

        <span class="c1"># Do weneed the code block below?</span>
        <span class="c1"># if ss[&#39;style&#39;] is &#39;multisphere&#39;:</span>
        <span class="c1">#   itype = ss[&#39;style&#39;]</span>
        <span class="c1"># else:</span>
        <span class="c1">#   itype = &#39;nve/{style}&#39;.format(**ss)</span>

        <span class="c1">#Do NOT unfix randName! Will cause a memory corruption error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pddName</span><span class="p">)</span></div>

<div class="viewcode-block" id="DEMPy.insert"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.insert">[docs]</a>  <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function inserts particles, and assigns particle velocities if requested by the user. If species is &#39;all&#39;,</span>
<span class="sd">    all components specified in SS are inserted. Otherwise, species must be the id of the component to be inserted.</span>
<span class="sd">    For available region shapes, see `ref &lt;https://www.cfdem.com/media/DEM/docu/region.html&gt;`_. The default region is</span>
<span class="sd">    the whole system.</span>

<span class="sd">    :param species: species id (&#39;all&#39;, or 1, 2, ... )</span>
<span class="sd">    :type param: int or str</span>

<span class="sd">    :param value:</span>

<span class="sd">    :param region: define region via (&#39;shape&#39;, (xmin, xmax, ymin, ymax, zmin, zmax)) or (&#39;shape&#39;, xmin, xmax, ymin, ymax, zmin, zmax)</span>
<span class="sd">    :type region: tuple</span>

<span class="sd">    .. todo:: Support insertion of all or multiple species at the same time for multiple regions. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probability distribution not set for particle insertion. Exiting ...&#39;</span><span class="p">)</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="k">if</span> <span class="s1">&#39;region&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="n">region</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># Default region is sim box</span>
      <span class="k">if</span> <span class="s1">&#39;cylinder&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
        <span class="n">region</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;cylinder&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;cylinder&#39;</span><span class="p">])</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">region</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;block&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">])</span>
        
      <span class="n">region</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="mi">0</span><span class="p">]])</span>
      <span class="n">args</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">region</span>

    <span class="c1"># I think this is for creating tuples of lists, corresponding to many regions</span>
    <span class="c1"># This is prolly for inserting many species at the same time in different regions</span>
    <span class="c1"># UPDATE: inserting multiple species not supported anyway in PyGran! ??? So will</span>
    <span class="c1"># comment the lines below</span>
    <span class="c1">#if isinstance(region[1], tuple):</span>
    <span class="c1">#  targs = list(region[1])</span>
    <span class="c1">#  targs.insert(0, region[0])</span>

    <span class="c1">#  tmp = region[1]</span>
    <span class="c1">#  for i in range(len(tmp)):</span>
    <span class="c1">#    targs[i+1] = tmp[i]</span>

    <span class="c1">#  region = tuple(targs)</span>

    <span class="k">def</span> <span class="nf">insert_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">vel_type</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">mech</span><span class="p">,</span> <span class="o">**</span><span class="n">ss</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; For multi-component system, this function can cause REAL *trouble*. For now, make sure components</span>
<span class="sd">      are inserted consecutively or all at once.</span>

<span class="sd">      TODO: let the user override volume_limit</span>
<span class="sd">      &quot;&quot;&quot;</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Inserting particles for species </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

      <span class="n">seed</span> <span class="o">=</span> <span class="mi">32452843</span>
      <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">)</span>

      <span class="n">randName</span> <span class="o">=</span> <span class="s1">&#39;insert&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;region </span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">region</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">region</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;units box volume_limit 1e-20&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="s1">&#39;args&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dictToTuple</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span>
      <span class="c1"># otherwise, ss[&#39;args&#39;] must be a tuple of strings, or maybe just a string ... so leave it.</span>

      <span class="k">if</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;once&#39;</span>

      <span class="k">if</span> <span class="s1">&#39;all_in&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;all_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>

      <span class="k">if</span> <span class="s1">&#39;insert&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;insert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;by_pack&#39;</span>

      <span class="k">if</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;insert&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;by_rate&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mech</span><span class="p">:</span>
          <span class="n">mech</span> <span class="o">=</span> <span class="s1">&#39;nparticles&#39;</span>

        <span class="k">if</span> <span class="n">mech</span> <span class="ow">is</span> <span class="s1">&#39;nparticles&#39;</span><span class="p">:</span>
          <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">{}</span><span class="s1"> group</span><span class="si">{}</span><span class="s1"> insert/rate/region seed 123481 distributiontemplate </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span> <span class="n">mech</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">+</span> \
          <span class="s1">&#39; particlerate </span><span class="si">{rate}</span><span class="s1"> insert_every </span><span class="si">{freq}</span><span class="s1"> overlapcheck yes all_in </span><span class="si">{all_in}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; vel </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel_type</span><span class="p">)</span> \
          <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">vel</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; region </span><span class="si">{}</span><span class="s1"> ntry_mc 10000&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">)</span>
      <span class="k">elif</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;insert&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;by_pack&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mech</span><span class="p">:</span>
          <span class="n">mech</span> <span class="o">=</span> <span class="s1">&#39;particles_in_region&#39;</span>

        <span class="k">if</span> <span class="n">mech</span> <span class="ow">is</span> <span class="s1">&#39;particles_in_region&#39;</span><span class="p">:</span>
          <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">{}</span><span class="s1"> group</span><span class="si">{}</span><span class="s1"> insert/pack seed </span><span class="si">{}</span><span class="s1"> distributiontemplate </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">[</span><span class="nb">id</span><span class="p">])</span> <span class="o">+</span> \
          <span class="s1">&#39; insert_every </span><span class="si">{freq}</span><span class="s1"> overlapcheck yes all_in </span><span class="si">{all_in}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; vel </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel_type</span><span class="p">)</span> \
          <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">vel</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> region </span><span class="si">{}</span><span class="s1"> ntry_mc 10000&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mech</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: Insertion mechanism </span><span class="si">{insert}</span><span class="s1"> not found. Assuming insertion by rate ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mech</span> <span class="ow">is</span> <span class="s1">&#39;nparticles&#39;</span><span class="p">:</span>
          <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

        <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">{}</span><span class="s1"> group</span><span class="si">{}</span><span class="s1"> insert/rate/region seed 123481 distributiontemplate </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span> <span class="n">mech</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">+</span> \
          <span class="s1">&#39; </span><span class="si">{rate_type}</span><span class="s1"> </span><span class="si">{rate}</span><span class="s1"> insert_every </span><span class="si">{freq}</span><span class="s1"> overlapcheck yes all_in </span><span class="si">{all_in}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; vel </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel_type</span><span class="p">)</span> \
          <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">vel</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; region </span><span class="si">{}</span><span class="s1"> ntry_mc 10000&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

      <span class="k">return</span> <span class="n">randName</span>

    <span class="k">if</span> <span class="n">species</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>

      <span class="n">species</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>

      <span class="k">if</span> <span class="s1">&#39;vel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

      <span class="k">if</span> <span class="s1">&#39;vel_type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;vel_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;constant&#39;</span>

      <span class="k">if</span> <span class="s1">&#39;mech&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mech&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

      <span class="n">randName</span> <span class="o">=</span> <span class="n">insert_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Insertion species </span><span class="si">{}</span><span class="s1"> not supported in PyGran.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">species</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">randName</span></div>

<div class="viewcode-block" id="DEMPy.run"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.run">[docs]</a>  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Runs a simulation for number of steps specified by the user</span>
<span class="sd">     @itype = sphere (rotational motion on) or rigid_sphere (rotational motion off)</span>
<span class="sd">     @dt = timestep&quot;&quot;&quot;</span>
    
    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupIntegrate</span><span class="p">(</span><span class="n">itype</span><span class="o">=</span><span class="n">itype</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dt</span><span class="p">:</span>
      <span class="k">if</span> <span class="s1">&#39;dt&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not find dt in user-supplied dictionary. Aborting ...&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

    <span class="c1"># See if any variables were set to be monitered by the user</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_monitor</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">vname</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_monitor</span><span class="p">:</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vname</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">name</span></div>

<div class="viewcode-block" id="DEMPy.moveMesh"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.moveMesh">[docs]</a>  <span class="k">def</span> <span class="nf">moveMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Control how a mesh (specified by name) moves in time</span>

<span class="sd">    @name: string specifying mesh ID/name</span>
<span class="sd">    @args: keywords specific to LIGGGHTS&#39;s move/mesh command: https://www.cfdem.com/media/DEM/docu/fix_move_mesh.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">randName</span> <span class="o">=</span> <span class="s1">&#39;moveMesh&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">))</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">dictToTuple</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">{}</span><span class="s1"> all move/mesh mesh </span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">randName</span></div>

<div class="viewcode-block" id="DEMPy.importMeshes"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.importMeshes">[docs]</a>  <span class="k">def</span> <span class="nf">importMeshes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Imports all meshes and sets them up as walls. Can import only one mesh specified by the &#39;name&#39; keyword.</span>
<span class="sd">    @file: mesh filename</span>
<span class="sd">    @mtype: mesh type</span>
<span class="sd">    @args: additional args</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wallIsMesh</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="s1">&#39;mesh&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

        <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
              <span class="k">if</span> <span class="n">mesh</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">importMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;mtype&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">])</span>  
                <span class="n">wallIsMesh</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="s1">&#39;import&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]:</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">importMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;mtype&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">importMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;mtype&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>

                <span class="n">wallIsMesh</span> <span class="o">=</span> <span class="kc">True</span>

      <span class="k">if</span> <span class="n">wallIsMesh</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupWall</span><span class="p">(</span><span class="n">wtype</span><span class="o">=</span><span class="s1">&#39;mesh&#39;</span><span class="p">)</span></div>
    

<div class="viewcode-block" id="DEMPy.importMesh"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.importMesh">[docs]</a>  <span class="k">def</span> <span class="nf">importMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Imports a specific surface mesh requested by the user</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">dictToTuple</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Importing mesh from </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">{}</span><span class="s1"> all </span><span class="si">{}</span><span class="s1"> file </span><span class="si">{}</span><span class="s1"> type </span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span></div>

<div class="viewcode-block" id="DEMPy.setupWall"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.setupWall">[docs]</a>  <span class="k">def</span> <span class="nf">setupWall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wtype</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">plane</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">peq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a wall</span>
<span class="sd">    @ wtype: type of the wall (primitive or mesh)</span>
<span class="sd">    @ plane: x, y, or z plane for primitive walls</span>
<span class="sd">    @ peq: plane equation for primitive walls</span>

<span class="sd">    This function can be called only ONCE for setting up all mesh walls (restriction from LIGGGHTS)</span>

<span class="sd">    TODO: support additional keywords (shear, etc.) for primitive walls</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gran</span> <span class="o">=</span> <span class="s1">&#39;gran&#39;</span> <span class="c1"># VERY HACKISH</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">modelExtra</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;model-args&#39;</span><span class="p">]:</span>
      <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;cohesion&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;tangential &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;rolling_friction&#39;</span><span class="p">):</span>
        <span class="n">modelExtra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="c1"># Replace any user-specified model args for all mesh walls</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">wtype</span> <span class="o">==</span> <span class="s1">&#39;mesh&#39;</span><span class="p">:</span>
        <span class="n">kname</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]:</span>
          <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">kname</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span> <span class="c1"># make sure this is an actual mesh keyword, not a mesh defined with a keyname same as a mesh arg!</span>
            <span class="n">modelExtra</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">kname</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">kname</span><span class="p">]</span>

    <span class="n">model</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">modelExtra</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">)</span>

    <span class="c1"># Can we take model args into account for walls???</span>
    <span class="k">if</span> <span class="n">wtype</span> <span class="o">==</span> <span class="s1">&#39;mesh&#39;</span><span class="p">:</span>
      <span class="n">meshName</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">mname</span> <span class="k">for</span> <span class="n">mname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mname</span><span class="p">]])</span>
      <span class="n">nMeshes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">meshName</span><span class="p">)</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix walls all wall/</span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gran</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">model</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">modelExtra</span><span class="p">)</span> <span class="o">+</span> \
      <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> n_meshes </span><span class="si">{}</span><span class="s1"> meshes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wtype</span><span class="p">,</span> <span class="n">nMeshes</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="n">nMeshes</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">meshName</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">wtype</span> <span class="o">==</span> <span class="s1">&#39;primitive&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">{}</span><span class="s1"> all wall/</span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">gran</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">model</span><span class="p">)</span> <span class="o">+</span>  <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">modelExtra</span><span class="p">)</span> <span class="o">+</span> \
        <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> type </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wtype</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">peq</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Wall type can be either primitive or mesh&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">name</span></div>

<div class="viewcode-block" id="DEMPy.remove"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.remove">[docs]</a>  <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes a specified fix. If the fix is for a mesh, we must unfix it and re-import all meshes again and setup them</span>
<span class="sd">    up as walls. Very tedious!</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Remove any DUMP-IDS 1st in case the user wants to move a mesh</span>
    <span class="k">if</span> <span class="s1">&#39;mesh&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]:</span>
        <span class="c1"># must delete all meshes / dumps in order to re-import remaining meshes</span>
        <span class="k">for</span> <span class="n">dump</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;undump </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dump</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;unfix walls&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;unfix </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mesh</span><span class="p">))</span>

        <span class="k">if</span> <span class="s1">&#39;mfile&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]:</span>
          <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;mfile cannot be a list. Something is not setup correctly.&#39;</span><span class="p">)</span>
          <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]:</span> <span class="c1"># the user has requested all mesh(es) be written as one file</span>
            <span class="k">pass</span>
          <span class="k">else</span><span class="p">:</span> <span class="c1"># self.pargs[&#39;traj&#39;][&#39;mfile&#39;] had better be None</span>
            <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># Re-import any remaining meshes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">importMeshes</span><span class="p">()</span>

        <span class="c1"># Create new dump setups, leaving particle dumps intact</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeSetup</span><span class="p">(</span><span class="n">only_mesh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="c1"># Otherwise, we are just unfixing a non-mesh fix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;unfix </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="DEMPy.createGroup"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.createGroup">[docs]</a>  <span class="k">def</span> <span class="nf">createGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">group</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create groups of atoms. If group is empty, groups{i} are created for every i species.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating atom group </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">idSS</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;idSS&#39;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;group group</span><span class="si">{}</span><span class="s1"> type </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idSS</span><span class="p">,</span> <span class="n">idSS</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;group &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">group</span><span class="p">))</span></div>

<div class="viewcode-block" id="DEMPy.createParticles"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.createParticles">[docs]</a>  <span class="k">def</span> <span class="nf">createParticles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates particles of type &#39;type&#39; (1,2, ...) using style &#39;style&#39; (box or region or single or random)</span>
<span class="sd">    @[args]: &#39;basis&#39; or &#39;remap&#39; or &#39;units&#39; or &#39;all_in&#39; </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating particles </span><span class="si">{}</span><span class="s1"> with args&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

    <span class="c1"># my code: self.lmp.command(&#39;create_atoms {} {}&#39;.format(type, style) +  (&#39; {}&#39; * len(args)).format(*args))</span>
    <span class="c1"># new code below: ~ should be the same. Double check this.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">createParticles</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span></div>

<div class="viewcode-block" id="DEMPy.set"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.set">[docs]</a>  <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Set group/atom attributes &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;set &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span></div>

<div class="viewcode-block" id="DEMPy.setupNeighbor"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.setupNeighbor">[docs]</a>  <span class="k">def</span> <span class="nf">setupNeighbor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up NNS list parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up nearest neighbor searching parameters&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;nns_freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;nns_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">if</span> <span class="s1">&#39;nns_skin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
      <span class="n">radius</span> <span class="o">=</span> <span class="mi">0</span>

      <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s1">&#39;radius&#39;</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
          <span class="n">radius</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;nns_skin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;neighbor </span><span class="si">{nns_skin}</span><span class="s1"> </span><span class="si">{nns_type}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;neigh_modify delay 0 every </span><span class="si">{nns_freq}</span><span class="s1"> check yes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span></div>

<div class="viewcode-block" id="DEMPy.createProperty"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.createProperty">[docs]</a>  <span class="k">def</span> <span class="nf">createProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Material and interaction properties required</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating property </span><span class="si">{}</span><span class="s1"> with args&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">{}</span><span class="s1"> all property/global&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span></div>

<div class="viewcode-block" id="DEMPy.setupPhysics"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.setupPhysics">[docs]</a>  <span class="k">def</span> <span class="nf">setupPhysics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify the interation forces</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up interaction parameters&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;model-args&#39;</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;pair_style &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;pair_coeff * *&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DEMPy.velocity"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.velocity">[docs]</a>  <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assigns velocity to selected particles.</span>
<span class="sd">    :param args: group-ID style args keyword value</span>
<span class="sd">    :type args: tuple</span>

<span class="sd">    :note: See `link &lt;https://www.cfdem.com/media/DEM/docu/velocity.html&gt;`_ </span>
<span class="sd">           for info on keywords and their associated values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;velocity&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span></div>

<div class="viewcode-block" id="DEMPy.setupGravity"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.setupGravity">[docs]</a>  <span class="k">def</span> <span class="nf">setupGravity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify in which direction the gravitational force acts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;gravity&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix myGravity all gravity </span><span class="si">{}</span><span class="s1"> vector </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;gravity&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="DEMPy.initialize"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.initialize">[docs]</a>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;restart </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># create dummy restart tuple to pass below</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;read_data&#39;</span><span class="p">]:</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">createDomain</span><span class="p">()</span>
      <span class="c1">#self.createGroup()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupPhysics</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupNeighbor</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupParticles</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupGravity</span><span class="p">()</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;read_data&#39;</span><span class="p">]:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">createDomain</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">readData</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupPhysics</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupNeighbor</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupParticles</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupGravity</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">resume</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupPhysics</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupNeighbor</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupParticles</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupGravity</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">setupIntegrate</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">importMeshes</span><span class="p">()</span>
    
    <span class="c1"># Write output to trajectory by default unless the user specifies otherwise</span>
    <span class="k">if</span> <span class="s1">&#39;dump&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dump&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeSetup</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">writeSetup</span><span class="p">()</span></div>

<div class="viewcode-block" id="DEMPy.setupIntegrate"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.setupIntegrate">[docs]</a>  <span class="k">def</span> <span class="nf">setupIntegrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify how Newton&#39;s eqs are integrated in time. MUST BE EXECUTED ONLY ONCE.</span>
<span class="sd">    TODO: extend this to SQ particles</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up integration scheme parameters&#39;</span><span class="p">)</span>

    <span class="n">spheres</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="p">:</span>

      <span class="c1"># check timestep ~ do this only ONCE</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix ts_check all check/timestep/gran 1000 0.5 0.5&#39;</span><span class="p">)</span>

      <span class="c1"># Find which components (types) are spheres, multi-spheres, QS, etc.</span>
      <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">ss</span> <span class="ow">and</span> <span class="s1">&#39;wall&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span> <span class="c1"># dont count mesh wall(s)</span>
          <span class="k">if</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sphere&#39;</span><span class="p">:</span>
            <span class="n">spheres</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
          <span class="k">elif</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;multisphere&#39;</span><span class="p">:</span>
            <span class="n">multi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spheres</span><span class="p">):</span>
        <span class="c1">#self.createGroup(*(&#39;spheres type&#39;, (&#39; {}&#39; * len(spheres)).format(*spheres)))</span>

        <span class="k">for</span> <span class="n">sphere</span> <span class="ow">in</span> <span class="n">spheres</span><span class="p">:</span>
          <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;sphere_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="n">itype</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">{}</span><span class="s1"> group</span><span class="si">{}</span><span class="s1"> nve/sphere&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sphere</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">{}</span><span class="s1"> group</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sphere</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">itype</span><span class="p">))</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

      <span class="c1"># LIGGGHTS does not permit more than one multisphere group to exist / integrated</span>
      <span class="c1"># So we will reject any MS groups beyond the 1st</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;LIGGGHTS (3.x) does not currently support more than one multisphere group.&quot;</span><span class="p">)</span>
      <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi</span><span class="p">):</span> <span class="c1"># must be of length 1</span>

        <span class="c1"># When LIGGGHTS supports multiple multisphere groups, I should uncomment this</span>
        <span class="c1">#self.createGroup(*(&#39;multi type&#39;, (&#39; {}&#39; * len(multi)).format(*multi)))</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">integ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">integ</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;multisphere&#39;</span><span class="p">):</span>
            <span class="n">ms</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">ms</span><span class="p">:</span>
          <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;multisphere_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">{}</span><span class="s1"> group</span><span class="si">{}</span><span class="s1"> multisphere&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">multi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span></div>

<div class="viewcode-block" id="DEMPy.integrate"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.integrate">[docs]</a>  <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run simulation in time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Integrating the system for </span><span class="si">{}</span><span class="s1"> steps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">steps</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitorList</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;compute </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;timestep </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;run </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">steps</span><span class="p">))</span></div>

<div class="viewcode-block" id="DEMPy.printSetup"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.printSetup">[docs]</a>  <span class="k">def</span> <span class="nf">printSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify which variables to write to file, and their format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up printing options&#39;</span><span class="p">)</span>

    <span class="n">freq</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;thermo_style custom&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;thermo </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;thermo_modify norm no lost ignore&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DEMPy.writeSetup"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.writeSetup">[docs]</a>  <span class="k">def</span> <span class="nf">writeSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_mesh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This creates dumps for particles and meshes in the system. In LIGGGHTS, all meshes must be declared once, so if a mesh is removed during</span>
<span class="sd">    the simulation, this function has to be called again, usually with only_mesh=True to keep the particle dump intact.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up trajectory i/o&#39;</span><span class="p">)</span>

    <span class="c1"># Make sure the user did not request no particles be saved to a traj file, or we&#39;re not just re-initializing the meshes</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">only_mesh</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;pfile&#39;</span><span class="p">]:</span>

      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dump&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;undump dump&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dump&#39;</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump </span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="si">{sel}</span><span class="s1"> </span><span class="si">{style}</span><span class="s1"> </span><span class="si">{freq}</span><span class="s1"> </span><span class="si">{dir}</span><span class="s1">/</span><span class="si">{pfile}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump_modify </span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span>  <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dump_modify&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dump_modify&#39;</span><span class="p">]))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Make sure meshes are defined so we can dump them if requested (or not)</span>
    <span class="k">if</span> <span class="s1">&#39;mesh&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dump&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">:</span>
          <span class="k">for</span> <span class="n">dname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;undump &#39;</span> <span class="o">+</span> <span class="n">dname</span><span class="p">)</span>

      <span class="k">if</span> <span class="s1">&#39;mfile&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

          <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
          <span class="c1"># Make sure only mehs keywords supplied with files are counter, otherwise, they&#39;re args to the mesh wall!</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]:</span>
              <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
              <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span> <span class="o">+</span> <span class="s1">&#39;-*.vtk&#39;</span>
              <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span>
              <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dump&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">))</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

              <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump &#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; all mesh/vtk </span><span class="si">{freq}</span><span class="s1"> </span><span class="si">{dir}</span><span class="s1">/</span><span class="si">{mfile}</span><span class="s1"> id stress stresscomponents vel </span><span class="si">{mName}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">))</span>
      <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]:</span>
          <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

          <span class="c1"># see if we have many meshes to dump if the name of one mfile is supplied by the user</span>
          <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]:</span>
                <span class="n">name</span> <span class="o">+=</span> <span class="n">mesh</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>

          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># remove last space to avoid fake (empty) mesh IDs</span>

            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            
            <span class="n">dname</span> <span class="o">=</span> <span class="s1">&#39;dump&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dname</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump &#39;</span> <span class="o">+</span> <span class="n">dname</span> <span class="o">+</span> <span class="s1">&#39; all mesh/vtk </span><span class="si">{freq}</span><span class="s1"> </span><span class="si">{dir}</span><span class="s1">/</span><span class="si">{mfile}</span><span class="s1"> id stress stresscomponents vel &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dump</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">name</span></div>

<div class="viewcode-block" id="DEMPy.extractCoords"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.extractCoords">[docs]</a>  <span class="k">def</span> <span class="nf">extractCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts atomic positions from a certian frame and adds it to coords</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Extracting atomic poitions&#39;</span><span class="p">)</span>

    <span class="c1"># Extract coordinates from liggghts</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable x atom x&#39;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Rxn</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_variable</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable y atom y&#39;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Rxn</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_variable</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable z atom z&#39;</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Rxn</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_variable</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">(),</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()):</span>
      <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable x delete&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable y delete&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable z delete&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">coords</span></div>

<div class="viewcode-block" id="DEMPy.monitor"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.monitor">[docs]</a>  <span class="k">def</span> <span class="nf">monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes time-averaged quantities of a global vector.</span>
<span class="sd">    @species:</span>
<span class="sd">    @name:</span>
<span class="sd">    @var:</span>
<span class="sd">    @[nevery: 1 </span>
<span class="sd">    @[nrepeat: 1</span>
<span class="sd">    @[nfreq]: 1</span>

<span class="sd">    returns the mean variable as a scalar</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;nevery&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="n">args</span><span class="p">[</span><span class="s1">&#39;nevery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="s1">&#39;nrepeat&#39;</span> <span class="ow">not</span> <span class="ow">in</span>  <span class="n">args</span><span class="p">:</span>
      <span class="n">args</span><span class="p">[</span><span class="s1">&#39;nrepeat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="s1">&#39;nfreq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="n">args</span><span class="p">[</span><span class="s1">&#39;nfreq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="n">args</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;compute </span><span class="si">{name}</span><span class="s1"> </span><span class="si">{species}</span><span class="s1"> </span><span class="si">{var}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix my</span><span class="si">{name}</span><span class="s1"> </span><span class="si">{species}</span><span class="s1"> ave/time </span><span class="si">{nevery}</span><span class="s1"> </span><span class="si">{nrepeat}</span><span class="s1"> </span><span class="si">{nfreq}</span><span class="s1"> c_</span><span class="si">{name}</span><span class="s1"> file </span><span class="si">{file}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">))</span>

    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;my</span><span class="si">{name}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">),</span> <span class="p">[])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_monitor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="s1">&#39;my</span><span class="si">{name}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">),</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])</span> <span class="p">)</span>

    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;my</span><span class="si">{name}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">))</span></div>

<div class="viewcode-block" id="DEMPy.addViscous"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.addViscous">[docs]</a>  <span class="k">def</span> <span class="nf">addViscous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adds a viscous damping force :math:`F` proportional</span>
<span class="sd">    to each particle&#39;s velocity :math:`v`:</span>
<span class="sd">    </span>
<span class="sd">    :math:`F = - \\gamma v`</span>

<span class="sd">    :param species: species index (0, 1, ...)</span>
<span class="sd">    :type species: int</span>
<span class="sd">    :param gamma: viscosity coefficient (:math:`\\gamma`)</span>
<span class="sd">    :type gamma: positive float</span>
<span class="sd">    :param scale: (species, ratio) tuple to scale gamma with</span>
<span class="sd">    :type scale: tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;scale&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="n">args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;species&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;group&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Species must be specified (1,2,..., or &quot;all&quot;) for which the viscous force applies.&#39;</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="si">{species}</span><span class="s1"> viscous </span><span class="si">{gamma}</span><span class="s1"> scale &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">])</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">name</span></div>

<div class="viewcode-block" id="DEMPy.plot"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.plot">[docs]</a>  <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="c1">#plt.rc(&#39;text&#39;, usetex=True)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">xscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
          <span class="n">time</span> <span class="o">*=</span> <span class="n">xscale</span>

          <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xlabel</span><span class="p">))</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
      <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="DEMPy.saveas"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.saveas">[docs]</a>  <span class="k">def</span> <span class="nf">saveas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>

      <span class="k">try</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
      <span class="k">except</span><span class="p">:</span>
         <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="DEMPy.command"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.command">[docs]</a>  <span class="k">def</span> <span class="nf">command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Passes a specific command to LIGGGHTS</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="DEMPy.resume"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.resume">[docs]</a>  <span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rdir</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
      <span class="n">rfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">rfile</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="n">rdir</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;read_restart </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rfile</span><span class="p">))</span></div>

<div class="viewcode-block" id="DEMPy.readData"><a class="viewcode-back" href="../../../_autosummary/simulation.PyGranSim.engine_liggghts.html#simulation.PyGranSim.engine_liggghts.DEMPy.readData">[docs]</a>  <span class="k">def</span> <span class="nf">readData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;read_data&#39;</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;read_dump &#39;</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span></div>

  <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Destructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>
</pre></div>

          </div>
          <footer>
  

  <div role="contentinfo">
		<p class="centered">© 2014 drove.io is a <b>connectical</b> project. <span class="nnlogo"></span></p>
  </div>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>