

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>analysis.PyGranAnalysis.core &mdash; PyGran 1.2.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  <link rel="stylesheet" href="../../../static/css/main.css" type="text/css" />

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="PyGran 1.2.0 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../../index.html" class="fa fa-home"> PyGran</a>
        
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">PyGran’s documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">What is PyGran?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#brief-summary-of-dem">Brief summary of DEM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#installation">Installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../simulation.html">Simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../simulation.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../simulation.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../simulation.html#numerical-analysis">Numerical analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../simulation.html#dem-simulation">DEM simulation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../analysis.html">Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis.html#systems-subsystems">Systems &amp; SubSystems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../zreferences.html">Bibliography</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">PyGran</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>analysis.PyGranAnalysis.core</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for analysis.PyGranAnalysis.core</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">A submodule that provides the fundamental classes used in the analysis module</span>

<span class="sd">Created on July 10, 2016</span>

<span class="sd">Author: Andrew Abi-Mansour</span>

<span class="sd">This is the::</span>

<span class="sd">	██████╗ ██╗   ██╗ ██████╗ ██████╗  █████╗ ███╗   ██╗</span>
<span class="sd">	██╔══██╗╚██╗ ██╔╝██╔════╝ ██╔══██╗██╔══██╗████╗  ██║</span>
<span class="sd">	██████╔╝ ╚████╔╝ ██║  ███╗██████╔╝███████║██╔██╗ ██║</span>
<span class="sd">	██╔═══╝   ╚██╔╝  ██║   ██║██╔══██╗██╔══██║██║╚██╗██║</span>
<span class="sd">	██║        ██║   ╚██████╔╝██║  ██║██║  ██║██║ ╚████║</span>
<span class="sd">	╚═╝        ╚═╝    ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═══╝</span>

<span class="sd">DEM simulation and analysis toolkit</span>
<span class="sd">http://www.pygran.org, support@pygran.org</span>

<span class="sd">Core developer and main author:</span>
<span class="sd">Andrew Abi-Mansour, andrew.abi.mansour@pygran.org</span>

<span class="sd">PyGran is open-source, distributed under the terms of the GNU Public</span>
<span class="sd">License, version 2 or later. It is distributed in the hope that it will</span>
<span class="sd">be useful, but WITHOUT ANY WARRANTY; without even the implied warranty</span>
<span class="sd">of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. You should have</span>
<span class="sd">received a copy of the GNU General Public License along with PyGran.</span>
<span class="sd">If not, see http://www.gnu.org/licenses . See also top-level README</span>
<span class="sd">and LICENSE files.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="k">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="k">import</span> <span class="n">ascii_uppercase</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="k">try</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">vtk</span>
	<span class="kn">from</span> <span class="nn">vtk.util.numpy_support</span> <span class="k">import</span> <span class="n">vtk_to_numpy</span>
<span class="k">except</span><span class="p">:</span>
	<span class="k">pass</span>

<span class="kn">from</span> <span class="nn">.tools</span> <span class="k">import</span> <span class="n">convert</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">binned_statistic</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">numbers</span>

<div class="viewcode-block" id="SubSystem"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.SubSystem">[docs]</a><span class="k">class</span> <span class="nc">SubSystem</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot; The SubSystem is an abstract class the implementation of which stores all DEM object properties and the methods that operate on \</span>
<span class="sd">these properties. This class is iterable but NOT an iterator. </span>

<span class="sd">	:param units: unit system</span>
<span class="sd">	:type units: string </span>

<span class="sd">	:note: See `code &lt;https://github.com/Andrew-AbiMansour/PyGranAnalysis/blob/master/PyGranAnalysis/tools.py&gt;`_ for available unit systems</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_initilize</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

<div class="viewcode-block" id="SubSystem._initialize"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.SubSystem._initialize">[docs]</a>	<span class="k">def</span> <span class="nf">_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; This function exists mostly for convenience. It does everything expected from __init__ and is used by other methods </span>
<span class="sd">		such as _resetSubSystem &quot;&quot;&quot;</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="s1">&#39;si&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_fname</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="n">args</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_iargs</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># used for re-initializing system</span>

		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>

			<span class="c1"># copy constructor</span>
			<span class="c1"># delete data if it exists</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
				<span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

			<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">],</span> <span class="s1">&#39;data&#39;</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;data attribute not found in </span><span class="si">{}</span><span class="s1"> object&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

			<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">],</span> <span class="s1">&#39;_units&#39;</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span><span class="o">.</span><span class="n">_units</span>

			<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">],</span> <span class="s1">&#39;__module__&#39;</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span><span class="o">.</span><span class="vm">__module__</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">_constructAttributes</span><span class="p">()</span>

		<span class="k">else</span><span class="p">:</span> <span class="c1"># otherwise, we&#39;re instantiating a new object</span>
			<span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>

			<span class="k">if</span> <span class="s1">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

				<span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;units must be supplied when creating SubSystem from a data dictionary.&#39;</span><span class="p">)</span>

				<span class="c1"># update unit system</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">)</span>

			<span class="k">if</span> <span class="s1">&#39;fname&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_fname</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span>

		<span class="k">if</span> <span class="s1">&#39;__module__&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;__module__&#39;</span><span class="p">]</span>

		<span class="c1"># If data is already copied from Particles, do nothing</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span> <span class="c1"># an ordered dict that contains either arrays</span></div>
			<span class="c1">#(for storing pos, vels, forces, etc.), scalars (natoms, ) or tuples (box size).</span>
			<span class="c1"># ONLY arrays can be slices based on user selection.</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Returns all stored attribute keynames &quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">):</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="SubSystem._metaget"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.SubSystem._metaget">[docs]</a>	<span class="k">def</span> <span class="nf">_metaget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;A meta function for returning dynamic class attributes treated as lists (for easy slicing)</span>
<span class="sd">		and return as numpy arrays for numerical computations / manipulations&quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>

<div class="viewcode-block" id="SubSystem._resetSubSystem"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.SubSystem._resetSubSystem">[docs]</a>	<span class="k">def</span> <span class="nf">_resetSubSystem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Mainly used by System for rewinding traj back to frame 0 &quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_constructAttributes</span><span class="p">()</span>
		<span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="SubSystem._constructAttributes"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.SubSystem._constructAttributes">[docs]</a>	<span class="k">def</span> <span class="nf">_constructAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Constructs dynamic functions (getters) for all keys found in the trajectory &quot;&quot;&quot;</span>

		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

			<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
				<span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>

				<span class="k">if</span> <span class="n">sel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">True</span>
					
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">sel</span><span class="p">]</span>

					<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

		<span class="c1"># Checks if the trajectory file supports reduction in key getters</span>
		<span class="c1"># It&#39;s important to construct a (lambda) function for each attribute individually</span>
		<span class="c1"># so that each dynamically created (property) function would have its own unique</span>
		<span class="c1"># key. For instance, placing the for loop below in  _constructAttributes would make</span>
		<span class="c1"># all property functions return the same (last) key variable.</span>


			<span class="c1"># We cannot know the information for any property function until that property is created,</span>
			<span class="c1"># so we define either define metaget function and particularize it only later with a</span>
			<span class="c1"># lambda function, thus, permanently updating the SubSystem class, or update the attributes</span>
			<span class="c1"># of this particular instance of SubSystem, which is the approach adopted here.</span>

			<span class="k">if</span> <span class="n">mesh</span><span class="p">:</span>
				<span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
					<span class="n">obj</span><span class="p">,</span> <span class="n">newkey</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
						<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>

					<span class="nb">setattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">),</span> <span class="n">newkey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metaget</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

			<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metaget</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
			
			<span class="c1">#Factory.addprop(self, key, lambda x: self.data[key])</span>
			<span class="c1">#Why do we need this?</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">)</span></div>

	<span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
			<span class="c1"># Make sure variable is not internal</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
				<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> property is read-only&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

		<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

	<span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sel</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; SubSystem can be sliced with this function &quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__module__&#39;</span><span class="p">):</span>
			<span class="c1"># Could not find cName, search for it in cwd (if it is user-defined)</span>
			<span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c1"># Get the type of the class (not necessarily SubSystem for derived classes)</span>
			<span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

		<span class="n">cName</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">cName</span><span class="p">(</span><span class="n">sel</span><span class="o">=</span><span class="n">sel</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

	<span class="k">def</span> <span class="nf">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Boolean logical operator on particles &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SubSystem.copy"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.SubSystem.copy">[docs]</a>	<span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Returns a hard copy of the SubSystem &quot;&quot;&quot;</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
				<span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

		<span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)(</span><span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubSystem.conversion"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.SubSystem.conversion">[docs]</a>	<span class="k">def</span> <span class="nf">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factors</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Convesion factors from S.I., micro, cgs, or nano, and vice versa </span>

<span class="sd">		.. todo:: support all possible variables (is this possible???) &quot;&quot;&quot;</span>

		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

			<span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;z&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;radius&#39;</span><span class="p">:</span>

				<span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">True</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factors</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

				<span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

			<span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;vx&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;vy&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;vz&#39;</span><span class="p">:</span>

				<span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">True</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factors</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">factors</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

				<span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

			<span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;omegax&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;omegay&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;omegaz&#39;</span><span class="p">:</span>

				<span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">True</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">/=</span> <span class="n">factors</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
				
				<span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

			<span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;fx&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;fy&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;fz&#39;</span><span class="p">:</span>

				<span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">True</span>
				
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factors</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">factors</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">factors</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mf">2.0</span>
				
				<span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">pass</span></div>

<div class="viewcode-block" id="SubSystem.units"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.SubSystem.units">[docs]</a>	<span class="k">def</span> <span class="nf">units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Change unit system to units ore return units if None</span>
<span class="sd">		units:  si, micro, cgs, or nano &quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="n">units</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">,</span> <span class="n">units</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">units</span></div>

	<span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Adds attributes of obj to current SubSystem &quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
					<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>

		<span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

		<span class="k">return</span> <span class="bp">self</span>

	<span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Adds two classes together, or operates scalars/vectors on particle radii/positions</span>
<span class="sd">		.. todo:: get this working with meshes.&quot;&quot;&quot;</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>

		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>

				<span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
					<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
						<span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
					<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
						<span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="c1"># what to do with tuples / lists such as box size ???</span>
						<span class="k">pass</span>

			<span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
			<span class="n">cName</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

			<span class="k">return</span> <span class="n">cName</span><span class="p">(</span><span class="n">sel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Cannot add two objects of different types: </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

	<span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Subtracts scalars/vectors from particle radii/positions</span>
<span class="sd">		.. todo:: get this working with meshes &quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
			<span class="n">obj</span><span class="p">,</span> <span class="n">att</span> <span class="o">=</span> <span class="n">obj</span>
			<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
					<span class="k">pass</span>
				<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># gotta make sure both classes being subtracted have the same number of elements</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">-=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">att</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Two subsystems with different number of elements cannot be subtracted.&#39;</span><span class="p">)</span>

		<span class="k">return</span> <span class="bp">self</span>

	<span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Multiplies scalars/vectors from particle radii/positions</span>
<span class="sd">		.. todo:: get this working with meshes &quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Two subsystems with different types cannot be multiplied.&#39;</span><span class="p">)</span>
		
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># gotta make sure both classes being multiplied have the same number of elements</span>
			<span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Two subsystems with different number of elements cannot be multiplied.&#39;</span><span class="p">)</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>

		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>

			<span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
				<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
					<span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="c1"># what to do with tuples / lists such as box size ???</span>
					<span class="k">pass</span>

		<span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
		<span class="n">cName</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">cName</span><span class="p">(</span><span class="n">sel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Divides scalars/vectors from particle radii/positions</span>
<span class="sd">		.. todo:: get this working with meshes &quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
			<span class="n">obj</span><span class="p">,</span> <span class="n">att</span> <span class="o">=</span> <span class="n">obj</span>
			<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
					<span class="k">pass</span>
				<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># gotta make sure both classes being divided have the same number of elements</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">/=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">att</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Two subsystems with different number of elements cannot be divided.&#39;</span><span class="p">)</span>

		<span class="k">return</span> <span class="bp">self</span>

	<span class="k">def</span> <span class="nf">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Returns a (temporary) new subsystem with only a single attribute. the user can of course make this not *temporary* but</span>
<span class="sd">		that is not what should be used for. In principle, the modulus is a reductionist operator that serves as a temporary metastate</span>
<span class="sd">		for binary operations. &quot;&quot;&quot;</span>

		<span class="c1"># Make a hard copy of the class to make sure we preserve its state</span>
		<span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span>

		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">att</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;natoms&#39;</span><span class="p">:</span>
				<span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

		<span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)(</span><span class="kc">None</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_units</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
			<span class="k">yield</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<div class="viewcode-block" id="SubSystem.scale"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.SubSystem.scale">[docs]</a>	<span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">)):</span>
		<span class="sd">&quot;&quot;&quot; Scales all ss elements by a float or int &#39;value&#39;</span>

<span class="sd">		@[attr]: attribute to scale (positions by default)</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">attr</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">at</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>

				<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">])</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">True</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">]</span> <span class="o">*=</span> <span class="n">value</span>

				<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">])</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_constructAttributes</span><span class="p">()</span></div>

<div class="viewcode-block" id="SubSystem.translate"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.SubSystem.translate">[docs]</a>	<span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">)):</span>
		<span class="sd">&quot;&quot;&quot; Translates all ss elements by a tuple of integers or floats</span>

<span class="sd">		@value: tuple of float or int by which to translate the system</span>
<span class="sd">		@[attr]: tuple of attributes to translate system by (positions by default)</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The length of values must be equal to that of attributes.&#39;</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">at</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">at</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>

				<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">True</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

				<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_constructAttributes</span><span class="p">()</span></div>

<div class="viewcode-block" id="SubSystem.noise"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.SubSystem.noise">[docs]</a>	<span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">)):</span>
		<span class="sd">&quot;&quot;&quot; Adds white noise of standard deviation &#39;sigma&#39; to all elements with attribute &#39;attr&#39;.</span>

<span class="sd">		@sigma: standard deviation of the Gaussian (white) noise</span>
<span class="sd">		@[attr]: attribute to perturb (positions by default)</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="n">sigma</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Standard deviation must be positive.&#39;</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">attr</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">at</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>

				<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">])</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">True</span>

					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">])))</span>

					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">at</span><span class="p">]</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">True</span>


		<span class="bp">self</span><span class="o">.</span><span class="n">_constructAttributes</span><span class="p">()</span></div>

	<span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Returns the number of elements (e.g. particles or nodes) in a SubSystem &quot;&quot;&quot;</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
				<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

		<span class="c1"># Assume we&#39;re dealing with single particle object</span>
		<span class="k">return</span> <span class="mi">1</span>

	<span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">pass</span></div>

<div class="viewcode-block" id="Mesh"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Mesh">[docs]</a><span class="k">class</span> <span class="nc">Mesh</span><span class="p">(</span><span class="n">SubSystem</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;  The Mesh class stores a list of meshes and their associated attributes / methods.</span>
<span class="sd">	This class is iterable but NOT an iterator.</span>

<span class="sd">	:param fname: mesh filename</span>
<span class="sd">	:type fname: str</span>

<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

<div class="viewcode-block" id="Mesh._initialize"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Mesh._initialize">[docs]</a>	<span class="k">def</span> <span class="nf">_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>

		<span class="k">if</span> <span class="s1">&#39;fname&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_fname</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span>

		<span class="k">if</span> <span class="s1">&#39;vtk_type&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_vtk</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;vtk_type&#39;</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_vtk</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vtk</span> <span class="o">==</span> <span class="s1">&#39;poly&#39;</span><span class="p">:</span>
			<span class="c1"># Try polydata otherwise unstructured reader ... need to make this better</span>
			<span class="c1"># The try-except control makes self._vtk kinda useless, right?</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_reader</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataReader</span><span class="p">()</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_reader</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkUnstructuredGridReader</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_reader</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkUnstructuredGridReader</span><span class="p">()</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_reader</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkUnstructuredGridReader</span><span class="p">()</span>

		<span class="nb">super</span><span class="p">(</span><span class="n">Mesh</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

		<span class="k">if</span> <span class="s1">&#39;avgCellData&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
			<span class="n">args</span><span class="p">[</span><span class="s1">&#39;avgCellData&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

		<span class="c1"># Assert mesh input filname is VTK</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_mesh&#39;</span><span class="p">):</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">:</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;vtk&#39;</span><span class="p">:</span>
					<span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Input mesh must be of VTK type.&#39;</span><span class="p">)</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">_fname</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">numericalSort</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mesh</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">ReadAllVectorsOn</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">ReadAllScalarsOn</span><span class="p">()</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span> <span class="c1"># Needed if we need to call GetScalarRange</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">()</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetPoints</span><span class="p">()</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="n">points</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetCells</span><span class="p">()</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetCellData</span><span class="p">()</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="n">cells</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="k">if</span> <span class="n">points</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">points</span><span class="o">.</span><span class="n">GetName</span><span class="p">()]</span> <span class="o">=</span> <span class="n">vtk_to_numpy</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">cells</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Cells&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vtk_to_numpy</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">pass</span>

		<span class="k">if</span> <span class="n">points</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">cells</span><span class="p">:</span>

				<span class="n">np_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nCells</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetCell</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetPoints</span><span class="p">()</span><span class="o">.</span><span class="n">GetNumberOfPoints</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">points</span><span class="o">.</span><span class="n">GetName</span><span class="p">()]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

				<span class="c1"># Area/volume computation for elements is deprecated in VTK (only support for tetrahedra), so we do the computation ourselves here for rectangular elements.</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetCell</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetNumberOfFaces</span><span class="p">()</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span> <span class="c1"># we&#39;re dealing with a rectangular element</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CellVol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nCells</span><span class="p">())</span>
				<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetCell</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetNumberOfFaces</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># 2D mesh</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CellArea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nCells</span><span class="p">())</span>

				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nCells</span><span class="p">()):</span>
					<span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetCell</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetPoints</span><span class="p">()</span>
					<span class="n">np_pts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vtk_to_numpy</span><span class="p">(</span><span class="n">pts</span><span class="o">.</span><span class="n">GetData</span><span class="p">())</span>

				<span class="c1"># Find the axis of alignment for all cells using 1 (arbitrary) node</span>
				<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np_pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="o">==</span> <span class="o">.</span><span class="mi">0</span><span class="p">:</span>
					<span class="n">indices</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
				<span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np_pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="o">==</span> <span class="o">.</span><span class="mi">0</span><span class="p">:</span>
					<span class="n">indices</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">2</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">indices</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span>

				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nCells</span><span class="p">()):</span>
					<span class="k">if</span> <span class="s1">&#39;CellVol&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
						<span class="c1"># Need to update this to compoute correct the cell volume (assumed here to be a box)</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CellVol&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np_pts</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">np_pts</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">*</span> <span class="p">(</span><span class="n">np_pts</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">np_pts</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">*</span> <span class="p">(</span><span class="n">np_pts</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">np_pts</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

					<span class="k">if</span> <span class="s1">&#39;CellArea&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
						<span class="c1"># Shoelace  algorithm for computing areas of polygons</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CellArea&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np_pts</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np_pts</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np_pts</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span> <span class="n">np_pts</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="mi">1</span><span class="p">))</span> <span class="p">)</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CellsPos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np_pts</span>

		<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
			<span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetCellData</span><span class="p">()</span><span class="o">.</span><span class="n">GetArrayName</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">key</span><span class="p">:</span>

				<span class="n">newkey</span> <span class="o">=</span> <span class="s1">&#39;cells.&#39;</span> <span class="o">+</span> <span class="n">key</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">newkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">vtk_to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetCellData</span><span class="p">()</span><span class="o">.</span><span class="n">GetArray</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

				<span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;avgCellData&#39;</span><span class="p">]:</span>
					<span class="k">if</span> <span class="s1">&#39;CellArea&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">newkey</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CellArea&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">newkey</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CellArea&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

					<span class="k">elif</span> <span class="s1">&#39;CellVol&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">newkey</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CellVol&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">newkey</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CellVol&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

				<span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">break</span>

		<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
			<span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetArrayName</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">key</span><span class="p">:</span>
				<span class="n">newkey</span> <span class="o">=</span> <span class="s1">&#39;points.&#39;</span> <span class="o">+</span> <span class="n">key</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">newkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">vtk_to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetArray</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
				<span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">break</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_constructAttributes</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mesh._updateSystem"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Mesh._updateSystem">[docs]</a>	<span class="k">def</span> <span class="nf">_updateSystem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Class function for updating the state of a Mesh &quot;&quot;&quot;</span>
		<span class="c1"># Must make sure fname is passed in case we&#39;re looping over a trajectory</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mesh</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">[</span><span class="s1">&#39;vtk_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vtk</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fname</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">)</span> <span class="c1"># it&#39;s imp to pass args so that any subsystem-specific args are</span>
		<span class="c1"># passed along to the next frame (e.g. vtk_type, etc.)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_constructAttributes</span><span class="p">()</span></div>

	<span class="k">def</span> <span class="nf">nCells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetNumberOfCells</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">nPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetNumberOfPoints</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">_goto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iframe</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">frame</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">):</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input frame exceeds max number of frames&#39;</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">frame</span> <span class="o">==</span> <span class="n">iframe</span><span class="p">:</span>
					<span class="k">pass</span>
				<span class="k">elif</span> <span class="n">frame</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
					<span class="n">frame</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span>

		<span class="k">return</span> <span class="n">frame</span>

<div class="viewcode-block" id="Mesh._readFile"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Mesh._readFile">[docs]</a>	<span class="k">def</span> <span class="nf">_readFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Reads a mesh file &quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="s1">&#39;skip&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">:</span>
			<span class="n">skip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">[</span><span class="s1">&#39;skip&#39;</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">skip</span> <span class="o">=</span> <span class="mi">0</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">[</span><span class="n">frame</span> <span class="o">+</span> <span class="n">frame</span> <span class="o">*</span> <span class="n">skip</span><span class="p">]</span>

		<span class="k">return</span> <span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Mesh._resetSubSystem"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Mesh._resetSubSystem">[docs]</a>	<span class="k">def</span> <span class="nf">_resetSubSystem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_iargs</span><span class="p">)</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">Mesh</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_resetSubSystem</span><span class="p">()</span>

		<span class="k">return</span> <span class="mi">0</span></div>

	<span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">SubSystem</span><span class="o">.</span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Particles"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles">[docs]</a><span class="k">class</span> <span class="nc">Particles</span><span class="p">(</span><span class="n">SubSystem</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot; The Particle class stores all particle properties and the methods that operate on</span>
<span class="sd">	these properties. This class is iterable but NOT an iterator. &quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

<div class="viewcode-block" id="Particles._initialize"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles._initialize">[docs]</a>	<span class="k">def</span> <span class="nf">_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>

		<span class="k">if</span> <span class="s1">&#39;sel&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
			<span class="n">sel</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;sel&#39;</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">sel</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="nb">super</span><span class="p">(</span><span class="n">Particles</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_fp&#39;</span><span class="p">):</span> <span class="c1"># Make sure a file is already not open</span>
			<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_fname&#39;</span><span class="p">):</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">_ftype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ftype</span> <span class="o">==</span> <span class="s1">&#39;dump&#39;</span><span class="p">:</span> <span class="c1"># need a better way to figure out this is a LIGGGHTS/LAMMPS file</span>

						<span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">:</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">numericalSort</span><span class="p">)</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

						<span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="kc">None</span>

						<span class="c1"># Do some checking here on the traj extension to make sure</span>
						<span class="c1"># it&#39;s supported</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

						<span class="c1"># Read 1st frame</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">_readFile</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

					<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ftype</span> <span class="o">==</span> <span class="s1">&#39;vtk&#39;</span><span class="p">:</span>
						<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">numericalSort</span><span class="p">)</span>

							<span class="k">for</span> <span class="n">filen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">:</span>
								<span class="k">if</span> <span class="s1">&#39;boundingBox&#39;</span> <span class="ow">in</span> <span class="n">filen</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filen</span><span class="p">)</span>

							<span class="bp">self</span><span class="o">.</span><span class="n">_fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">_fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Input trajectory must be a valid LAMMPS/LIGGGHTS (dump) or vtk file.&#39;</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_constructAttributes</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;natoms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

		<span class="c1"># Make sure natoms is updated ~ DUH</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_constructAttributes</span><span class="p">()</span>

		<span class="c1"># see if multi-spheres are present</span>
		<span class="c1"># TODO: support polydisperse multisphere</span>
		<span class="k">if</span> <span class="s1">&#39;mol&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
			<span class="n">nmols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
			<span class="n">nspheres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">natoms</span> <span class="o">/</span> <span class="n">nmols</span>

			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;mol&#39;</span><span class="p">:</span> <span class="c1"># elminate recursive call (we dont need mol anyway)</span>
					<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
						<span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nmols</span><span class="p">)</span>

						<span class="k">for</span> <span class="n">atom</span><span class="p">,</span> <span class="n">prop</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
							<span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">prop</span>

						<span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">/=</span> <span class="n">nspheres</span>
						<span class="c1"># we average all atomic properties and assign them to the molecules ~ makes no sense to atomic IDs?</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="c1"># must be natoms</span>

			<span class="n">data</span><span class="p">[</span><span class="s1">&#39;natoms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nmols</span>

			<span class="c1"># Compute length of multispheres</span>
			<span class="n">dim</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># ~ HACKISH!</span>
			<span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nmols</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

			<span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">natoms</span><span class="p">):</span>
				<span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">atom</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
				<span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">atom</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
				<span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">atom</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

				<span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">atom</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
				<span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">atom</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
				<span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">atom</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

			<span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nmols</span><span class="p">)</span>

			<span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
				<span class="n">tmp</span> <span class="o">+=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">][:,</span><span class="n">dim</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">][:,</span><span class="n">dim</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>

			<span class="n">data</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

			<span class="c1"># Make sure molecules can be updated if reading a trajectory, so we delete it</span>
			<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;molecules&#39;</span><span class="p">):</span>
				<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecules</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">molecules</span> <span class="o">=</span> <span class="n">Particles</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="Particles._updateSystem"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles._updateSystem">[docs]</a>	<span class="k">def</span> <span class="nf">_updateSystem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Class function for updating the state of Particles &quot;&quot;&quot;</span>
		<span class="c1"># Must make sure fname is passed in case we&#39;re looping over a trajectory</span>

		<span class="c1"># If we are updating (looping over traj) we wanna keep the id (ref) of the class constant</span>
		<span class="c1"># (soft copy)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="n">sel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_constructAttributes</span><span class="p">()</span></div>

<div class="viewcode-block" id="Particles._resetSubSystem"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles._resetSubSystem">[docs]</a>	<span class="k">def</span> <span class="nf">_resetSubSystem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Get Particles back to initial state</span>
<span class="sd">		 &quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">)</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">Particles</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_resetSubSystem</span><span class="p">()</span>
		<span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Particles.computeROG"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles.computeROG">[docs]</a>	<span class="k">def</span> <span class="nf">computeROG</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Computes the radius of gyration (ROG) for an N-particle system:</span>
<span class="sd">		ROG = &lt;\sqrt(\sum_i (r_i - rm)^2)&gt; where rm is the mean position of all</span>
<span class="sd">		particles, and &lt;...&gt; is the ensemble average. Alternatively, one can</span>
<span class="sd">		compute ROG as \sum_i &lt;r_i^T r_i&gt; - rm ^T rm</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
		<span class="n">rm</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>

		<span class="n">dr</span> <span class="o">=</span> <span class="n">positions</span> <span class="o">-</span> <span class="n">rm</span>
		<span class="n">rog</span> <span class="o">=</span> <span class="o">.</span><span class="mi">0</span>

		<span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">dr</span><span class="p">:</span>
			<span class="n">rog</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rog</span><span class="o">/</span><span class="n">N</span><span class="p">)</span></div>

<div class="viewcode-block" id="Particles.computeCOM"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles.computeCOM">[docs]</a>	<span class="k">def</span> <span class="nf">computeCOM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Returns center of mass &quot;&quot;&quot;</span>
		<span class="n">vol</span> <span class="o">=</span> <span class="mf">4.0</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="o">**</span><span class="mi">3</span>

		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">vol</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">vol</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">vol</span><span class="p">)])</span> <span class="o">/</span> <span class="n">vol</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></div>

<div class="viewcode-block" id="Particles.computeGCOM"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles.computeGCOM">[docs]</a>	<span class="k">def</span> <span class="nf">computeGCOM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Returns the geometric center of mass &quot;&quot;&quot;</span>
		<span class="n">vol</span> <span class="o">=</span> <span class="mf">4.0</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="o">**</span><span class="mi">3</span>
		<span class="n">r</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">vol</span><span class="p">)</span><span class="o">**</span><span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">vol</span><span class="p">)</span><span class="o">**</span><span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">vol</span><span class="p">)</span><span class="o">**</span><span class="n">r</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">vol</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></div>


<div class="viewcode-block" id="Particles.computeRadius"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles.computeRadius">[docs]</a>	<span class="k">def</span> <span class="nf">computeRadius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Computes the maximum radius of an N-particle (spherical) system</span>
<span class="sd">		by sorting the radial components and returning the average of the sqrt</span>
<span class="sd">		of the radius of the first N max data points.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
		<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
		<span class="n">rm</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

		<span class="n">r</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">rm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">rm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">rm</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
		<span class="n">r</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="n">N</span><span class="p">:])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span></div>

<div class="viewcode-block" id="Particles.computeRDF"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles.computeRDF">[docs]</a>	<span class="k">def</span> <span class="nf">computeRDF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">center</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">rMax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Computes the three-dimensional radial distribution function for a set of</span>
<span class="sd">		spherical particles contained in a cube with side length S.  This simple</span>
<span class="sd">		function finds reference particles such that a sphere of radius rMax drawn</span>
<span class="sd">		around the particle will fit entirely within the cube, eliminating the need</span>
<span class="sd">		to compensate for edge effects.  If no such particles exist, an error is</span>
<span class="sd">		returned.  Try a smaller rMax...or write some code to handle edge effects! ;)</span>

<span class="sd">		:param dr: increment for increasing radius of spherical shell</span>
<span class="sd">		:type dr: float</span>

<span class="sd">		:param rMax: outer diameter of largest spherical shell</span>
<span class="sd">		:type rMax: float</span>

<span class="sd">		:return: (rdf as numpy array, radii of spherical shells as numpy array, indices of particles)</span>
<span class="sd">		:rtype: tuple</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">natoms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
			<span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;No Particles found.&#39;</span><span class="p">)</span>

		<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

		<span class="c1"># center positions around 0</span>
		<span class="k">if</span> <span class="n">center</span><span class="p">:</span>
			<span class="n">x</span> <span class="o">-=</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
			<span class="n">y</span> <span class="o">-=</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
			<span class="n">z</span> <span class="o">-=</span> <span class="n">z</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

		<span class="n">S</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">z</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

		<span class="k">if</span> <span class="n">rMax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">rMax</span> <span class="o">=</span> <span class="n">S</span> <span class="o">/</span> <span class="mf">2.0</span>

		<span class="k">if</span> <span class="n">dr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">dr</span> <span class="o">=</span> <span class="n">rMax</span> <span class="o">/</span> <span class="mi">100</span>

		<span class="c1"># Find particles which are close enough to the cube center that a sphere of radius</span>
		<span class="c1"># rMax will not cross any face of the cube</span>

		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Constructing a cube of length </span><span class="si">{}</span><span class="s1"> and a circumscribed sphere of radius </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">S</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">rMax</span><span class="p">))</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resolution chosen is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dr</span><span class="p">))</span>

		<span class="n">bools1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">rMax</span> <span class="o">-</span> <span class="n">S</span>
		<span class="n">bools2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">S</span> <span class="o">-</span> <span class="n">rMax</span><span class="p">)</span>
		<span class="n">bools3</span> <span class="o">=</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="n">rMax</span> <span class="o">-</span> <span class="n">S</span>
		<span class="n">bools4</span> <span class="o">=</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">S</span> <span class="o">-</span> <span class="n">rMax</span><span class="p">)</span>
		<span class="n">bools5</span> <span class="o">=</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="n">rMax</span> <span class="o">-</span> <span class="n">S</span>
		<span class="n">bools6</span> <span class="o">=</span> <span class="n">z</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">S</span> <span class="o">-</span> <span class="n">rMax</span><span class="p">)</span>

		<span class="n">interior_indices</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bools1</span> <span class="o">*</span> <span class="n">bools2</span> <span class="o">*</span> <span class="n">bools3</span> <span class="o">*</span> <span class="n">bools4</span> <span class="o">*</span> <span class="n">bools5</span> <span class="o">*</span> <span class="n">bools6</span><span class="p">)</span>
		<span class="n">num_interior_particles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">interior_indices</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">num_interior_particles</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">raise</span>  <span class="ne">RuntimeError</span> <span class="p">(</span><span class="s2">&quot;No particles found for which a sphere of radius rMax will lie entirely within a cube of side length S.  Decrease rMax or increase the size of the cube.&quot;</span><span class="p">)</span>

		<span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">rMax</span> <span class="o">+</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="n">dr</span><span class="p">,</span> <span class="n">dr</span><span class="p">)</span>
		<span class="n">num_increments</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
		<span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">num_interior_particles</span><span class="p">,</span> <span class="n">num_increments</span><span class="p">])</span>
		<span class="n">radii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_increments</span><span class="p">)</span>
		<span class="n">numberDensity</span> <span class="o">=</span> <span class="n">num_interior_particles</span> <span class="o">/</span> <span class="n">S</span><span class="o">**</span><span class="mi">3</span>

		<span class="c1"># Compute pairwise correlation for each interior particle</span>
		<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_interior_particles</span><span class="p">):</span>
			<span class="n">index</span> <span class="o">=</span> <span class="n">interior_indices</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
			<span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
			<span class="n">d</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rMax</span>
			<span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
			<span class="n">g</span><span class="p">[</span><span class="n">p</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">result</span>

		<span class="c1"># Average g(r) for all interior particles and compute radii</span>
		<span class="n">g_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_increments</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_increments</span><span class="p">):</span>
			<span class="n">radii</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span>
			<span class="n">rOuter</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
			<span class="n">rInner</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="n">g_average</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">g</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">rOuter</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">rInner</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>

		<span class="k">return</span> <span class="p">(</span><span class="n">g_average</span> <span class="o">/</span> <span class="n">numberDensity</span><span class="p">,</span> <span class="n">radii</span><span class="p">,</span> <span class="n">interior_indices</span><span class="p">)</span></div>
		<span class="c1"># Number of particles in shell/total number of particles/volume of shell/number density</span>
		<span class="c1"># shell volume = 4/3*pi(r_outer**3-r_inner**3)</span>

<div class="viewcode-block" id="Particles.computeAngleRepose"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles.computeAngleRepose">[docs]</a>	<span class="k">def</span> <span class="nf">computeAngleRepose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Computes the angle of repos theta = arctan(h_max/L)</span>
<span class="sd">		in a sim box defined by [-Lx, Lx] x [-Ly, Ly] x [0, Lz]</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
		<span class="n">dL</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">+</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
		<span class="n">z_max</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">z</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">z_max</span> <span class="o">/</span> <span class="n">dL</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span></div>
		
<div class="viewcode-block" id="Particles.computeMass"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles.computeMass">[docs]</a>	<span class="k">def</span> <span class="nf">computeMass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tdensity</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Computes the mass of all particles </span>

<span class="sd">		@tdensity: true density of the powder</span>
<span class="sd">		returns the summation of the mass of all particles &quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">natoms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

			<span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>
			<span class="n">mass</span> <span class="o">=</span> <span class="n">tdensity</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">radius</span><span class="o">**</span><span class="mf">3.0</span><span class="p">)</span>

			<span class="k">return</span> <span class="n">mass</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Particles.computeIntensitySegregation"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles.computeIntensitySegregation">[docs]</a>	<span class="k">def</span> <span class="nf">computeIntensitySegregation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Computes the intensity of segregation for binary mixture</span>
<span class="sd">		as defined by Danckwerts:</span>

<span class="sd">		I = sigma_a**2 / (mean_a (1 - mean_a))</span>

<span class="sd">		@[resol]: bin size for grid construction (default 3 * diameter)</span>
<span class="sd">		returns scalar intensity </span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="n">resol</span><span class="p">:</span>
			<span class="n">resol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">*</span> <span class="mi">3</span>

		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Intensity of segergation can be computed only for a binary system.&quot;</span><span class="p">)</span>
			<span class="c1"># should I support tertiary systems or more ???</span>

		<span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="n">resol</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="n">ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="n">resol</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="n">nz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="n">resol</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

		<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">sn</span><span class="p">,</span> <span class="n">ctype</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)):</span>

			<span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">==</span><span class="n">ctype</span><span class="p">]</span>

			<span class="n">parts</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">parts</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="o">-</span><span class="n">parts</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="o">-</span><span class="n">parts</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">attr</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">))</span>

			<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parts</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">resol</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>
			<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parts</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">resol</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>
			<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parts</span><span class="o">.</span><span class="n">z</span> <span class="o">/</span> <span class="n">resol</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>

			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parts</span><span class="o">.</span><span class="n">natoms</span><span class="p">):</span>
				<span class="n">indices</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">parts</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span>

			<span class="k">if</span> <span class="n">sn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">indices_a</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

		<span class="n">indices_a</span><span class="p">[</span><span class="n">indices</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/=</span> <span class="n">indices</span><span class="p">[</span><span class="n">indices</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
		<span class="n">aMean</span> <span class="o">=</span> <span class="n">indices_a</span><span class="p">[</span><span class="n">indices</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
		<span class="n">aStd</span> <span class="o">=</span> <span class="n">indices_a</span><span class="p">[</span><span class="n">indices</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

		<span class="k">return</span> <span class="n">aStd</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">aMean</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">aMean</span><span class="p">)),</span> <span class="n">indices_a</span><span class="p">,</span> <span class="n">indices</span></div>

<div class="viewcode-block" id="Particles.computeScaleSegregation"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles.computeScaleSegregation">[docs]</a>	<span class="k">def</span> <span class="nf">computeScaleSegregation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nTrials</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">resol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Npts</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">maxDist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Computes the correlation coefficient as defined by Danckwerts:</span>
<span class="sd">		R(r) = a * b / std(a)**2</span>

<span class="sd">		This is done via a Monte Carlo simulation.</span>

<span class="sd">		@[resol]: bin size for grid construction (default min radius)</span>
<span class="sd">		@[nTrials]: number of Monte Carlo trials (sample size)</span>
<span class="sd">		@[Npts]: number of bins for histogram construction</span>
<span class="sd">		@[maxDist]: maximum distance (in units of grid size) to sample</span>

<span class="sd">		Returns the coefficient of correlation R(r) and separation distance (r)</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="n">resol</span><span class="p">:</span>
			<span class="n">resol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

		<span class="n">_</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensitySegregation</span><span class="p">(</span><span class="n">resol</span><span class="p">)</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="n">maxDist</span><span class="p">:</span>
			<span class="n">maxDim</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
			<span class="n">maxDist</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">maxDim</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>

		<span class="n">volMean</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
		<span class="n">volVar</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span>

		<span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nTrials</span><span class="p">)</span>
		<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nTrials</span><span class="p">)</span>
		<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

		<span class="c1"># Begin Monte Carlo simulation</span>
		<span class="k">while</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">nTrials</span><span class="p">:</span>

			<span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
			<span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
			<span class="n">k1</span><span class="p">,</span> <span class="n">k2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

			<span class="c1"># Make sure we are sampling non-void spatial points</span>
			<span class="k">if</span> <span class="n">total</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">k1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">total</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">k2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

				<span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">i2</span> <span class="o">-</span> <span class="n">i1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j2</span> <span class="o">-</span> <span class="n">j1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

				<span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;=</span> <span class="n">maxDist</span><span class="p">:</span>

					<span class="n">corr</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">k1</span><span class="p">]</span> <span class="o">-</span> <span class="n">volMean</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">k2</span><span class="p">]</span> <span class="o">-</span> <span class="n">volMean</span><span class="p">))</span> <span class="o">/</span> <span class="n">volVar</span>
					<span class="n">dist</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span>
					<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

		<span class="n">corrfunc</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">corr</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">Npts</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">corrfunc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">corrfunc</span><span class="p">))],</span> <span class="n">distance</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">corrfunc</span><span class="p">))]</span> <span class="o">*</span> <span class="n">resol</span></div>

<div class="viewcode-block" id="Particles.computeDensity"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles.computeDensity">[docs]</a>	<span class="k">def</span> <span class="nf">computeDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tdensity</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Computes the bulk density for a selection of particles from their *true* density.</span>
<span class="sd">		The volume is determined approximately by constructing a box/cylinder/cone</span>
<span class="sd">		embedding the particles. Particles are assumed to be spherical in shape.</span>

<span class="sd">		@tdensity: true powder density</span>
<span class="sd">		@[shape]: box, cylinder-x, cylinder-y, or cylinder-z</span>

<span class="sd">		&quot;&quot;&quot;</span>

		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeMass</span><span class="p">(</span><span class="n">tdensity</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeVolume</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span></div>

<div class="viewcode-block" id="Particles.computeDensityLocal"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles.computeDensityLocal">[docs]</a>	<span class="k">def</span> <span class="nf">computeDensityLocal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bdensity</span><span class="p">,</span> <span class="n">dr</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;&quot; Computes a localized density at a series of discretized regions of thickness &#39;dr&#39;</span>
<span class="sd">		along an axis specified by the user &quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span>
			<span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
		<span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
			<span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
		<span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span>
			<span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Axis can be only x, y, or z.&quot;</span><span class="p">)</span>

		<span class="n">thick</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">dr</span><span class="p">)</span>
		<span class="n">odensity</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thick</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
			<span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">thick</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>

			<span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span>
				<span class="n">denLoc</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="n">parts</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">thick</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">bdensity</span><span class="p">)</span>
			<span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
				<span class="n">denLoc</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="n">parts</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">thick</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">bdensity</span><span class="p">)</span>
			<span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span>
				<span class="n">denLoc</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="n">parts</span><span class="o">.</span><span class="n">z</span> <span class="o">&gt;=</span> <span class="n">thick</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">bdensity</span><span class="p">)</span>

			<span class="n">odensity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">denLoc</span> <span class="p">)</span>

		<span class="k">return</span> <span class="n">thick</span><span class="p">,</span> <span class="n">odensity</span></div>

<div class="viewcode-block" id="Particles.computeVolume"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles.computeVolume">[docs]</a>	<span class="k">def</span> <span class="nf">computeVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="s1">&#39;box&#39;</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Computes the volume of a granular system based on a simple geometry </span>
<span class="sd">		@[shape]: box, cylinder-x, cylinder-y, or cylinder-z&quot;&quot;&quot;</span>

		<span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">natoms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>

			<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
			<span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
			<span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
			<span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

			<span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
				<span class="n">volume</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">)</span>

			<span class="k">elif</span> <span class="n">shape</span> <span class="o">==</span> <span class="s1">&#39;cylinder-z&#39;</span><span class="p">:</span>
				<span class="n">height</span> <span class="o">=</span> <span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span>
				<span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span> <span class="o">+</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span>
				<span class="n">volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">radius</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">height</span>

			<span class="k">elif</span> <span class="n">shape</span> <span class="o">==</span> <span class="s1">&#39;cylinder-y&#39;</span><span class="p">:</span>
				<span class="n">height</span> <span class="o">=</span> <span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span>
				<span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span> <span class="o">+</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span>
				<span class="n">volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">radius</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">height</span>

			<span class="k">elif</span> <span class="n">shape</span> <span class="o">==</span> <span class="s1">&#39;cylinder-x&#39;</span><span class="p">:</span>
				<span class="n">height</span> <span class="o">=</span> <span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span>
				<span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span> <span class="o">+</span> <span class="p">(</span><span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span>
				<span class="n">volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">radius</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">height</span>

			<span class="k">return</span> <span class="n">volume</span>

		<span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Particles._goto"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles._goto">[docs]</a>	<span class="k">def</span> <span class="nf">_goto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_frame</span><span class="p">,</span> <span class="n">go_frame</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; This function assumes we&#39;re reading a non-const N trajectory.</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="c1"># find the right frame number</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_singleFile</span><span class="p">:</span>
			<span class="c1"># We must be reading a single particle trajectory file (i.e. not a mesh)</span>
			<span class="k">while</span> <span class="n">current_frame</span> <span class="o">&lt;</span> <span class="n">go_frame</span> <span class="ow">or</span> <span class="n">go_frame</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>

				<span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

				<span class="k">if</span> <span class="ow">not</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">go_frame</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
					<span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">(</span><span class="s1">&#39;End of file reached.&#39;</span><span class="p">)</span>
				<span class="k">elif</span> <span class="ow">not</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">go_frame</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
					<span class="k">break</span>

				<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;TIMESTEP&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
					<span class="n">frame</span> <span class="o">+=</span> <span class="mi">1</span>

			<span class="c1"># assert self.frame == frame else something&#39;s wrong</span>
			<span class="c1"># or the user wants to go to the last frame</span>
			<span class="k">if</span> <span class="n">frame</span> <span class="o">==</span> <span class="n">go_frame</span><span class="p">:</span>

				<span class="c1">#ts = int(self._fp.readline())</span>
				<span class="c1">#self.data[&#39;timestep&#39;] = ts</span>
				<span class="c1">#self._constructAttributes()</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">_readFile</span><span class="p">(</span><span class="n">go_frame</span><span class="p">)</span>

			<span class="k">elif</span> <span class="n">go_frame</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
				<span class="n">tmp</span> <span class="o">=</span> <span class="n">frame</span>
				<span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>

				<span class="c1"># why delete _fp? it creates problems in lines 1288 del self._fp</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_readFile</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_goto</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span> <span class="c1"># why do this?!</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot find frame </span><span class="si">{}</span><span class="s1"> in current trajectory&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">frame</span><span class="p">))</span>

		<span class="k">else</span><span class="p">:</span> <span class="c1"># no need to find the input frame, just select the right file if available</span>

			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">go_frame</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">):</span>
					<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input frame exceeds max number of frames&#39;</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="n">go_frame</span><span class="p">:</span>
						<span class="n">frame</span> <span class="o">=</span> <span class="n">current_frame</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">go_frame</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
							<span class="n">frame</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">frame</span> <span class="o">=</span> <span class="n">go_frame</span>

						<span class="bp">self</span><span class="o">.</span><span class="n">_readFile</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">frame</span></div>

<div class="viewcode-block" id="Particles._readDumpFile"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles._readDumpFile">[docs]</a>	<span class="k">def</span> <span class="nf">_readDumpFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Reads a single dump file&quot;&quot;&quot;</span>
		<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">ts</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
			<span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

			<span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">StopIteration</span>

			<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;TIMESTEP&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">ts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span>

			<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;NUMBER OF ATOMS&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">natoms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;natoms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">natoms</span>

			<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;BOX&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">boxX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
				<span class="n">boxY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
				<span class="n">boxZ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

				<span class="n">boxX</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">boxX</span><span class="p">]</span>
				<span class="n">boxY</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">boxY</span><span class="p">]</span>
				<span class="n">boxZ</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">boxZ</span><span class="p">]</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">boxX</span><span class="p">,</span> <span class="n">boxY</span><span class="p">,</span> <span class="n">boxZ</span><span class="p">)</span>
				<span class="k">break</span>

			<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

		<span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">StopIteration</span>

		<span class="n">keys</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span> <span class="c1"># remove ITEM: and ATOMS keywords</span>

		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">natoms</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;natoms&#39;</span><span class="p">]):</span>
			<span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

		<span class="n">count</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;natoms&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

		<span class="k">return</span> <span class="n">ts</span></div>

<div class="viewcode-block" id="Particles.write"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles.write">[docs]</a>	<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Write a single output file &quot;&quot;&quot;</span>
		<span class="n">ftype</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">ftype</span> <span class="o">==</span> <span class="s1">&#39;dump&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_writeDumpFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="Particles._writeDumpFile"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles._writeDumpFile">[docs]</a>	<span class="k">def</span> <span class="nf">_writeDumpFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Writes a single dump file&quot;&quot;&quot;</span>
		<span class="k">with</span>  <span class="nb">open</span><span class="p">(</span><span class="n">filename</span> <span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>

			<span class="k">if</span> <span class="s1">&#39;timestep&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

			<span class="k">if</span> <span class="s1">&#39;box&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
				<span class="n">maxR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">maxR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">maxR</span><span class="p">],</span> \
									<span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">maxR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">maxR</span><span class="p">],</span> \
									<span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">maxR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">maxR</span><span class="p">],</span> \
									<span class="p">)</span>

			<span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ITEM: TIMESTEP</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">]))</span>
			<span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ITEM: NUMBER OF ATOMS</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;natoms&#39;</span><span class="p">]))</span>
			<span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ITEM: BOX BOUNDS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]:</span>
				<span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

			<span class="n">var</span> <span class="o">=</span> <span class="s1">&#39;ITEM: ATOMS &#39;</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;timestep&#39;</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;natoms&#39;</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
					<span class="n">var</span> <span class="o">=</span> <span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

			<span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
			<span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;natoms&#39;</span><span class="p">]):</span>
				<span class="n">var</span> <span class="o">=</span> <span class="p">()</span>
				<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
					<span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;timestep&#39;</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;natoms&#39;</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span>
							<span class="n">var</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]),)</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">var</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">],)</span>

				<span class="n">nVars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
				<span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="n">nVars</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">var</span><span class="p">))</span>
				<span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Particles._readFile"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Particles._readFile">[docs]</a>	<span class="k">def</span> <span class="nf">_readFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Read a particle trajectory file </span>

<span class="sd">		TODO: Support skip for single dump file</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="s1">&#39;skip&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">:</span>
			<span class="n">skip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">[</span><span class="s1">&#39;skip&#39;</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">skip</span> <span class="o">=</span> <span class="mi">0</span>

		<span class="c1"># This means we are opening the traj file for the 1st time</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_fp&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_singleFile&#39;</span><span class="p">):</span>

			<span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_singleFile</span> <span class="o">=</span> <span class="kc">False</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_singleFile</span> <span class="o">=</span> <span class="kc">True</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_singleFile</span><span class="p">:</span> <span class="c1"># must support skip</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ftype</span> <span class="o">==</span> <span class="s1">&#39;dump&#39;</span><span class="p">:</span> 
				<span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readDumpFile</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_constructAttributes</span><span class="p">()</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> format is not a supported trajectory file.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ftype</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ftype</span> <span class="o">==</span> <span class="s1">&#39;dump&#39;</span><span class="p">:</span>

				<span class="k">if</span> <span class="n">frame</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
					<span class="k">raise</span> <span class="ne">StopIteration</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">[</span><span class="n">frame</span> <span class="o">+</span> <span class="n">skip</span> <span class="o">*</span> <span class="n">frame</span><span class="p">]</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
				<span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readDumpFile</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_constructAttributes</span><span class="p">()</span>

			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ftype</span> <span class="o">==</span> <span class="s1">&#39;vtk&#39;</span><span class="p">:</span>

				<span class="k">if</span> <span class="n">frame</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
					<span class="k">raise</span> <span class="ne">StopIteration</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">[</span><span class="n">frame</span> <span class="o">+</span> <span class="n">skip</span> <span class="o">*</span> <span class="n">frame</span><span class="p">]</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">_reader</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataReader</span><span class="p">()</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fname</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span> <span class="c1"># Needed if we need to call GetScalarRange</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">()</span>

				<span class="n">pos</span> <span class="o">=</span> <span class="n">vtk_to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetPoints</span><span class="p">()</span><span class="o">.</span><span class="n">GetData</span><span class="p">())</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>

				<span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>

				<span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>

				<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
					<span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetCellData</span><span class="p">()</span><span class="o">.</span><span class="n">GetArrayName</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
					<span class="k">if</span> <span class="n">key</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">vtk_to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetCellData</span><span class="p">()</span><span class="o">.</span><span class="n">GetArray</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
						<span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">break</span>

				<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
					<span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetArrayName</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
					<span class="k">if</span> <span class="n">key</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">vtk_to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetArray</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
						<span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">break</span>

				<span class="c1"># This doesnot work for 2D / 1D systems</span>
				<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
					<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
						<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
							<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
								<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
								<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span>
								<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span>

								<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">_constructAttributes</span><span class="p">()</span>

		<span class="k">return</span> <span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span></div></div>

<div class="viewcode-block" id="Factory"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Factory">[docs]</a><span class="k">class</span> <span class="nc">Factory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;A factory for system class. It creates subclasses of SubSystems. Its only two methods</span>
<span class="sd">	are static, thus no need to instantiate this class.</span>

<span class="sd">	@SubSystem: filename (or list of filenames) for the subsystem trajectory</span>
<span class="sd">	@[units](si): unit system can be either &#39;si&#39; or &#39;micro&#39;</span>
<span class="sd">	&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Factory.factory"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.Factory.factory">[docs]</a>	<span class="k">def</span> <span class="nf">factory</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Returns a list of Subsystems </span>

<span class="sd">		System(Obj1=[(value11, args11), (value12, args12), ... (value1N, args1N)], ...)</span>

<span class="sd">		args11, args12, etc. are dictionaries of keywords args for objects of type obj1.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">obj</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="k">if</span> <span class="s1">&#39;module&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
			<span class="n">module</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">module</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>

			<span class="n">sclass</span> <span class="o">=</span> <span class="n">Factory</span><span class="o">.</span><span class="n">_str_to_class</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">)</span>

			<span class="k">if</span> <span class="ow">not</span> <span class="n">sclass</span><span class="p">:</span>
				<span class="c1"># make sure selected class definition exists, otherwise, this had better be a list</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;System takes only keywords of classes that are defined. Class type </span><span class="si">{}</span><span class="s1"> not found.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">ss</span><span class="p">]))</span>

			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span> <span class="c1"># we need to create a list of objects</span>

				<span class="n">objs</span> <span class="o">=</span> <span class="p">[]</span>

				<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="n">ss</span><span class="p">]:</span>

					<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span> <span class="c1"># we must pass additional args</span>

						<span class="k">try</span><span class="p">:</span>
							<span class="n">obj_fname</span><span class="p">,</span> <span class="n">obj_args</span> <span class="o">=</span> <span class="n">item</span>
						<span class="k">except</span><span class="p">:</span>
							<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;SubSystem arguments must be passed as a dictionary, i.e. System(SubSystem=[(path1, arg1), ...]) &#39;</span><span class="p">)</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sclass</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">obj_fname</span><span class="p">,</span> <span class="o">**</span><span class="n">obj_args</span><span class="p">))</span>

					<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
						<span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sclass</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">item</span><span class="p">))</span>
					<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">sclass</span><span class="p">):</span>
						<span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrect keyarg supplied to System: </span><span class="si">{}</span><span class="s1"> when creating </span><span class="si">{}</span><span class="s1"> SubSystem&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ss</span><span class="p">))</span>

				<span class="k">if</span> <span class="n">objs</span><span class="p">:</span>
					<span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ss</span><span class="p">,</span> <span class="n">objs</span><span class="p">])</span>

			<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>

				<span class="n">fname</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span>
				<span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ss</span><span class="p">,</span> <span class="n">sclass</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">)])</span>

			<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>

				<span class="n">obj_fname</span><span class="p">,</span> <span class="n">obj_args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span>
				<span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ss</span><span class="p">,</span> <span class="n">sclass</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">obj_fname</span><span class="p">,</span> <span class="o">**</span><span class="n">obj_args</span><span class="p">)])</span>

			<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="n">sclass</span><span class="p">):</span>
				<span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ss</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="n">ss</span><span class="p">]])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrect keyarg supplied to System: </span><span class="si">{}</span><span class="s1"> when creating </span><span class="si">{}</span><span class="s1"> SubSystem&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="n">ss</span><span class="p">))</span>
			
		<span class="k">return</span> <span class="n">obj</span></div>

	<span class="k">def</span> <span class="nf">_str_to_class</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

		<span class="c1"># See if the object exists within the current module</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">module</span><span class="p">:</span>
				<span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
				<span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span> <span class="n">string</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span> <span class="c1"># string has no class definition in the specified module</span>

	<span class="k">def</span> <span class="nf">addprop</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>

		<span class="bp">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;__perinstance&#39;</span><span class="p">):</span>
			<span class="bp">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,),</span> <span class="p">{})</span>
			<span class="bp">cls</span><span class="o">.</span><span class="n">__perinstance</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="n">inst</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="bp">cls</span>

		<span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">property</span><span class="p">(</span><span class="n">method</span><span class="p">))</span>

	<span class="n">factory</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">factory</span><span class="p">)</span>
	<span class="n">addprop</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">addprop</span><span class="p">)</span>

	<span class="n">_str_to_class</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">_str_to_class</span><span class="p">)</span></div>


<div class="viewcode-block" id="System"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.System">[docs]</a><span class="k">class</span> <span class="nc">System</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;A System contains all the information describing a DEM system.</span>
<span class="sd">	A meaningful system always requires at least one trajectory file to read. A trajectory is a (time)</span>
<span class="sd">	series corresponding to the coordinates of all particles/meshes/objects in the system.</span>
<span class="sd">	System handles the time frame and controls i/o operations. It contains one or more SubSystem</span>
<span class="sd">	derivatives (e.g. &#39;Particles&#39;, &#39;Mesh&#39;) which store all the particle and mesh attributes</span>
<span class="sd">	read from the trajectory file (variables such as positions, momenta, angular velocities,</span>
<span class="sd">	forces, stresses, radii, etc.). Objects that can be created by this class must be of the </span>
<span class="sd">	&#39;Particles&#39; or &#39;Mesh&#39; type. Multiple objects can be created by this class if a list of </span>
<span class="sd">	filenames are passed to its constructors.</span>

<span class="sd">	:param SubSystem: SubSystem (or its subclass) definition e.g. Particles or Mesh</span>
<span class="sd">	:type SubSystem: str / list[str]</span>

<span class="sd">	:param units: unit system can be either &#39;si&#39; or &#39;micro&#39;</span>
<span class="sd">	:type units: str</span>

<span class="sd">	:param module: for user-defined dervied SubSystems, module specifies the name of </span>
<span class="sd">	the module in which the user-defined class is defined.</span>
<span class="sd">	:type module: str</span>

<span class="sd">	:param units: unit system specification for input data, defaults to &#39;si&#39;</span>
<span class="sd">	:type units: str</span>

<span class="sd">	.. note:: This class is an iterator that enables time stepping: when looping over System (storing a traj file), </span>
<span class="sd">	the frame is controlled only by System through methods defined in a SubSystem sublass (read/write functions).</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

		<span class="c1"># SubSystem cannot handle any units</span>
		<span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
			<span class="k">del</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>

		<span class="n">objs</span> <span class="o">=</span> <span class="n">Factory</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">ss</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

		<span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">(</span><span class="s1">&#39;si&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">rewind</span><span class="p">()</span>
		<span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="System.units"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.System.units">[docs]</a>	<span class="k">def</span> <span class="nf">units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iunits</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Change unit system to units or return units if None</span>
<span class="sd">		units:  si, micro, cgs, or nano &quot;&quot;&quot;</span>

		<span class="kn">from</span> <span class="nn">.tools</span> <span class="k">import</span> <span class="n">conversion</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="n">iunits</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>

		<span class="k">if</span> <span class="n">iunits</span> <span class="ow">in</span> <span class="n">conversion</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
				<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="s1">&#39;units&#39;</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">(</span><span class="n">iunits</span><span class="p">)</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">iunits</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unit system </span><span class="si">{}</span><span class="s1"> not supported&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">iunits</span><span class="p">))</span></div>

<div class="viewcode-block" id="System.goto"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.System.goto">[docs]</a>	<span class="k">def</span> <span class="nf">goto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Go to a specific frame in the trajectory. If frame is -1</span>
<span class="sd">		then this function will read the last frame &quot;&quot;&quot;</span>

		<span class="c1"># nothing to do</span>
		<span class="k">if</span> <span class="n">frame</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">frame</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">newFrame</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="c1"># rewind if necessary (better than reading file backwards?)</span>
		<span class="k">if</span> <span class="n">frame</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="ow">and</span> <span class="n">frame</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewind</span><span class="p">()</span>
			<span class="n">newFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># rewind</span>
			<span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
				<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
					<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">]:</span>
						<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;_resetSubSystem&#39;</span><span class="p">):</span>
							<span class="n">newFrame</span>  <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">_resetSubSystem</span><span class="p">()</span>

				<span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="s1">&#39;_resetSubSystem&#39;</span><span class="p">):</span>
					<span class="n">newFrame</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="o">.</span><span class="n">_resetSubSystem</span><span class="p">()</span>

		<span class="k">else</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
				<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
					<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">]:</span>
						<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;_goto&#39;</span><span class="p">):</span>
							<span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">_goto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

				<span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="s1">&#39;_goto&#39;</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="o">.</span><span class="n">_goto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

			<span class="c1"># Rewind already updates the system, so we call _updateSystem only if</span>
			<span class="c1"># the frame is moving forward</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_updateSystem</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">newFrame</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">newFrame</span>

		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span></div>

<div class="viewcode-block" id="System.skip"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.System.skip">[docs]</a>	<span class="k">def</span> <span class="nf">skip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Skips all empty frames i.e. moves the trajectory to the 1st frame containing</span>
<span class="sd">		non-zero elements &quot;&quot;&quot;</span>
		<span class="n">forward</span> <span class="o">=</span> <span class="kc">True</span>

		<span class="k">while</span> <span class="n">forward</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span> 
				<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
					<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">]:</span>
						<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;_constructAttributes&#39;</span><span class="p">):</span>
							<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
								<span class="n">forward</span> <span class="o">=</span> <span class="kc">False</span>
				<span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="s1">&#39;_constructAttributes&#39;</span><span class="p">):</span>
					<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">]):</span>
						<span class="n">forward</span> <span class="o">=</span> <span class="kc">False</span>

			<span class="k">if</span> <span class="ow">not</span> <span class="n">forward</span><span class="p">:</span>
				<span class="k">break</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">()</span></div>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; returns the key objects found in the trajctory files &quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<div class="viewcode-block" id="System.rewind"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.System.rewind">[docs]</a>	<span class="k">def</span> <span class="nf">rewind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Read trajectory from the beginning&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

	<span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Forward one step to next frame when using the next builtin function.&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

<div class="viewcode-block" id="System.next"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.System.next">[docs]</a>	<span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; This method updates the system attributes. &quot;&quot;&quot;</span>
		<span class="n">update_frame</span> <span class="o">=</span> <span class="kc">False</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>

				<span class="k">if</span> <span class="s1">&#39;module&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
					<span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">module</span> <span class="o">=</span> <span class="kc">None</span>

				<span class="k">if</span> <span class="n">Factory</span><span class="o">.</span><span class="n">_str_to_class</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
					<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>

						<span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">]:</span>
							<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_readFile&#39;</span><span class="p">):</span>
								<span class="n">obj</span><span class="o">.</span><span class="n">_readFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
								<span class="n">update_frame</span> <span class="o">=</span> <span class="kc">True</span>

					<span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="s1">&#39;_readFile&#39;</span><span class="p">):</span>
						<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="o">.</span><span class="n">_readFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
						<span class="n">update_frame</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">rewind</span><span class="p">()</span>
			<span class="k">raise</span> <span class="ne">StopIteration</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c1"># we update the fame only after _readFile is called. If the latter</span>
			<span class="c1"># fails, the frame is not updated (due to raise), which is exactly</span>
			<span class="c1"># the behavior we want. Ding!</span>
			<span class="k">if</span> <span class="n">update_frame</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+=</span> <span class="mi">1</span> 
				<span class="bp">self</span><span class="o">.</span><span class="n">_updateSystem</span><span class="p">()</span>

		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span></div>

<div class="viewcode-block" id="System._updateSystem"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.System._updateSystem">[docs]</a>	<span class="k">def</span> <span class="nf">_updateSystem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Makes sure the system is aware of any update in its attributes caused by</span>
<span class="sd">		a frame change. &quot;&quot;&quot;</span>

		<span class="c1"># A generic way of invoking _updateSystem</span>

		<span class="k">if</span> <span class="s1">&#39;module&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
			<span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">module</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">Factory</span><span class="o">.</span><span class="n">_str_to_class</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span> <span class="c1"># Make sure the obj exists</span>
				<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
					<span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">]:</span>
						<span class="c1"># Make sure this is a list of defined SubSystems</span>
						<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_updateSystem&#39;</span><span class="p">):</span>
							<span class="n">obj</span><span class="o">.</span><span class="n">_updateSystem</span><span class="p">()</span>

				<span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span> <span class="s1">&#39;_updateSystem&#39;</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="o">.</span><span class="n">_updateSystem</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="numericalSort"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.numericalSort">[docs]</a><span class="k">def</span> <span class="nf">numericalSort</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot; A sorting function by numerical numbers for glob.glob &quot;&quot;&quot;</span>

	<span class="n">numbers</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)&#39;</span><span class="p">)</span>
	<span class="n">parts</span> <span class="o">=</span> <span class="n">numbers</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
	<span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
	<span class="k">return</span> <span class="n">parts</span></div>

<div class="viewcode-block" id="select"><a class="viewcode-back" href="../../../autosummary/analysis.PyGranAnalysis.core.html#analysis.PyGranAnalysis.core.select">[docs]</a><span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">region</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Create a selection of particles based on a region-defined subsystem.</span>
<span class="sd">	:param data: input data</span>
<span class="sd">	:type data:  dict</span>

<span class="sd">	:param region: defines the region in the form: (xmin, xmax, ymin, ymax, zmin, zmax). </span>
<span class="sd">	:type region: tuple</span>

<span class="sd">	:return: indices of selected atoms</span>
<span class="sd">	:rtype: list</span>
<span class="sd">	</span>
<span class="sd">	.. todo:: Make this function more generic and compliant with the rest of this module</span>

<span class="sd">	.. note:: When region is not supplied, all particle indices are returned</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">region</span><span class="p">):</span>
			<span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;NATOMS&#39;</span><span class="p">])]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">region</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Length of region must be 6: (xmin, xmax, ymin, ymax, zmin, zmax)&#39;</span><span class="p">)</span>
				<span class="k">raise</span>

		<span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">region</span>

		<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>

		<span class="c1"># This is so hackish!</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

			<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">xmin</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">xmax</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">ymin</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">)</span>
			<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">ymax</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">)</span>

			<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">z</span> <span class="o">&gt;</span> <span class="n">zmin</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">)</span>
			<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">z</span> <span class="o">&lt;</span> <span class="n">zmax</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">)</span>

		<span class="k">else</span><span class="p">:</span>
			<span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="k">return</span> <span class="n">indices</span>

	<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
		<span class="k">raise</span></div>
</pre></div>

          </div>
          <footer>
  

  <div role="contentinfo">
		<p class="centered">© 2019 PyGran is a <b>connectical</b> project. <span class="nnlogo"></span></p>
  </div>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../static/jquery.js"></script>
      <script type="text/javascript" src="../../../static/underscore.js"></script>
      <script type="text/javascript" src="../../../static/doctools.js"></script>
      <script type="text/javascript" src="../../../static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../../static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>