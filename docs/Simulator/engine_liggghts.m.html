<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>PyGran.Simulator.engine_liggghts API documentation</title>
    <meta name="description" content="Created on March 30, 2016
@author: Andrew Abi-Mansour" />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#PyGran.Simulator.engine_liggghts.DEMPy">DEMPy</a></span>
        
          
  <ul>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.__init__">__init__</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.add_viscous">add_viscous</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.command">command</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.createDomain">createDomain</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.createGroup">createGroup</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.createParticles">createParticles</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.createProperty">createProperty</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.dumpSetup">dumpSetup</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.extractCoords">extractCoords</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.extract_compute">extract_compute</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.extract_global">extract_global</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.gather_atoms">gather_atoms</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.get_natoms">get_natoms</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.importMesh">importMesh</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.importMeshes">importMeshes</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.initialize">initialize</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.insert">insert</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.integrate">integrate</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.monitor">monitor</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.moveMesh">moveMesh</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.plot">plot</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.printSetup">printSetup</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.readData">readData</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.remove">remove</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.resume">resume</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.run">run</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.saveas">saveas</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.scatter_atoms">scatter_atoms</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.set">set</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.setupGravity">setupGravity</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.setupIntegrate">setupIntegrate</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.setupNeighbor">setupNeighbor</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.setupParticles">setupParticles</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.setupPhysics">setupPhysics</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.setupWall">setupWall</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.DEMPy.velocity">velocity</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#PyGran.Simulator.engine_liggghts.liggghts">liggghts</a></span>
        
          
  <ul>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.liggghts.__init__">__init__</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.liggghts.close">close</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.liggghts.command">command</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.liggghts.extract_atom">extract_atom</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.liggghts.extract_compute">extract_compute</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.liggghts.extract_fix">extract_fix</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.liggghts.extract_global">extract_global</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.liggghts.extract_variable">extract_variable</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.liggghts.file">file</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.liggghts.gather_atoms">gather_atoms</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.liggghts.get_natoms">get_natoms</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.liggghts.scatter_atoms">scatter_atoms</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.liggghts.set_variable">set_variable</a></li>
    <li class="mono"><a href="#PyGran.Simulator.engine_liggghts.liggghts.version">version</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">PyGran.Simulator.engine_liggghts</span> module</h1>
  <p>Created on March 30, 2016
@author: Andrew Abi-Mansour</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts" class="source">
    <div class="codehilite"><pre><span></span><span class="c1"># !/usr/bin/python</span>
<span class="c1"># -*- coding: utf8 -*-</span>
<span class="c1">#</span>
<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#   Python wrapper for LIGGGHTS library via ctypes</span>
<span class="c1">#</span>
<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#   Modified from  LAMMPS source code</span>
<span class="c1">#   LAMMPS - Large-scale Atomic/Molecular Massively Parallel Simulator</span>
<span class="c1">#   http://lammps.sandia.gov, Sandia National Laboratories</span>
<span class="c1">#   Steve Plimpton, sjplimp@sandia.gov</span>
<span class="c1">#</span>
<span class="c1">#   Copyright (2003) Sandia Corporation.  Under the terms of Contract</span>
<span class="c1">#   DE-AC04-94AL85000 with Sandia Corporation, the U.S. Government retains</span>
<span class="c1">#   certain rights in this software.  This software is distributed under</span>
<span class="c1">#   the GNU General Public License.</span>
<span class="c1">#</span>
<span class="c1">#   See the README file in the top-level LAMMPS directory.</span>
<span class="c1"># -----------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#   This program is free software: you can redistribute it and/or modify</span>
<span class="c1">#   it under the terms of the GNU General Public License as published by</span>
<span class="c1">#   the Free Software Foundation, either version 2 of the License, or</span>
<span class="c1">#   (at your option) any later version.</span>

<span class="c1">#   This program is distributed in the hope that it will be useful,</span>
<span class="c1">#   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">#   GNU General Public License for more details.</span>

<span class="c1">#   You should have received a copy of the GNU General Public License</span>
<span class="c1">#   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="c1"># -------------------------------------------------------------------------</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Created on March 30, 2016</span>
<span class="sd">@author: Andrew Abi-Mansour</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">traceback</span><span class="o">,</span><span class="nn">types</span>
<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">abspath</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getsourcefile</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">spatial</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">import_module</span>

<span class="k">class</span> <span class="nc">liggghts</span><span class="p">:</span>
  <span class="c1"># detect if Python is using version of mpi4py that can pass a communicator</span>

  <span class="n">has_mpi4py_v2</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
    <span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">mpi4py_version</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">mpi4py_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">has_mpi4py_v2</span> <span class="o">=</span> <span class="bp">True</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

  <span class="c1"># create instance of LIGGGHTS</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">library</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;spherical&#39;</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;si&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cmdargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">ptr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">comm</span><span class="p">:</span>
      <span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>

    <span class="k">if</span> <span class="n">library</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Using &quot;</span> <span class="o">+</span> <span class="n">library</span> <span class="o">+</span> <span class="s2">&quot; as a shared library for DEM computations&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Make sure &quot;</span> <span class="o">+</span> <span class="n">library</span> <span class="o">+</span> <span class="s2">&quot; is properly installed on your system&quot;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Catastrophic FAILURE: library {} detected by one processor but not found by another&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">library</span><span class="p">))</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="n">library</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">RTLD_GLOBAL</span><span class="p">)</span>

    <span class="c1"># if no ptr provided, create an instance of LIGGGHTS</span>
    <span class="c1">#   don&#39;t know how to pass an MPI communicator from PyPar</span>
    <span class="c1">#   but we can pass an MPI communicator from mpi4py v2.0.0 and later</span>
    <span class="c1">#   no_mpi call lets LIGGGHTS use MPI_COMM_WORLD</span>
    <span class="c1">#   cargs = array of C strings from args</span>
    <span class="c1"># if ptr, then are embedding Python in LIGGGHTS input script</span>
    <span class="c1">#   ptr is the desired instance of LIGGGHTS</span>
    <span class="c1">#   just convert it to ctypes ptr and store in self.lmp</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ptr</span><span class="p">:</span>
      <span class="c1"># with mpi4py v2, can pass MPI communicator to LIGGGHTS</span>
      <span class="c1"># need to adjust for type of MPI communicator object</span>
      <span class="c1"># allow for int (like MPICH) or void* (like OpenMPI)</span>

      <span class="k">if</span> <span class="n">liggghts</span><span class="o">.</span><span class="n">has_mpi4py_v2</span> <span class="ow">and</span> <span class="n">comm</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">liggghts</span><span class="o">.</span><span class="n">MPI</span><span class="o">.</span><span class="n">_sizeof</span><span class="p">(</span><span class="n">liggghts</span><span class="o">.</span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm</span><span class="p">)</span> <span class="o">==</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">sizeof</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">):</span>
          <span class="n">MPI_Comm</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">MPI_Comm</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>

        <span class="n">narg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cargs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">cmdargs</span><span class="p">:</span>
          <span class="n">cmdargs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;liggghts.py&quot;</span><span class="p">)</span>
          <span class="n">narg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmdargs</span><span class="p">)</span>
          <span class="n">cargs</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="o">*</span><span class="n">narg</span><span class="p">)(</span><span class="o">*</span><span class="n">cmdargs</span><span class="p">)</span>
          <span class="c1">#self.lib.lammps_open.argtypes = [ctypes.c_int, ctypes.c_char_p*narg, \</span>
                                           <span class="c1">#MPI_Comm, ctypes.c_void_p()]</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> \
                                           <span class="n">MPI_Comm</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()]</span>

        <span class="c1">#self.lib.lammps_open.restype = None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()</span>
        <span class="n">comm_ptr</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">_addressof</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
        <span class="n">comm_val</span> <span class="o">=</span> <span class="n">MPI_Comm</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="n">comm_ptr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open</span><span class="p">(</span><span class="n">narg</span><span class="p">,</span><span class="n">cargs</span><span class="p">,</span><span class="n">comm_val</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">))</span>
        
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">cmdargs</span><span class="p">:</span>
          <span class="n">cmdargs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;liggghts.py&quot;</span><span class="p">)</span>
          <span class="n">narg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmdargs</span><span class="p">)</span>
          <span class="n">cargs</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="o">*</span><span class="n">narg</span><span class="p">)(</span><span class="o">*</span><span class="n">cmdargs</span><span class="p">)</span>
          
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open_no_mpi</span><span class="p">(</span><span class="n">narg</span><span class="p">,</span><span class="n">cargs</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open_no_mpi</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">fbyref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">))</span>
          <span class="c1"># could use just this if LIGGGHTS lib interface supported it</span>
          <span class="c1"># self.lmp = self.lib.lammps_open_no_mpi(0,None)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="c1"># magic to convert ptr to ctypes ptr</span>
      <span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCObject_AsVoidPtr</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>
      <span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCObject_AsVoidPtr</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">py_object</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">(</span><span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCObject_AsVoidPtr</span><span class="p">(</span><span class="n">ptr</span><span class="p">))</span>

  <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;lmp&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">opened</span><span class="p">:</span> 
      <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opened</span><span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">file</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">file</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cmd</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">cmd</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">extract_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">extract_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ptr</span>

  <span class="k">def</span> <span class="nf">extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">style</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">ptr</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">ptr</span>
    <span class="k">return</span> <span class="bp">None</span>

  <span class="c1"># in case of global datum, free memory for 1 double via lammps_free()</span>
  <span class="c1"># double was allocated by library interface function</span>

  <span class="k">def</span> <span class="nf">extract_fix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_free</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">result</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">style</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">style</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">ptr</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">None</span>

  <span class="c1"># free memory for 1 double or 1 vector of doubles via lammps_free()</span>
  <span class="c1"># for vector, must copy nlocal returned values to local c_double vector</span>
  <span class="c1"># memory was allocated by library interface function</span>

  <span class="k">def</span> <span class="nf">extract_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">group</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">group</span><span class="p">)</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_free</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">result</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)</span>
      <span class="n">nlocalptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="s2">&quot;nlocal&quot;</span><span class="p">)</span>
      <span class="n">nlocal</span> <span class="o">=</span> <span class="n">nlocalptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="o">*</span><span class="n">nlocal</span><span class="p">)()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">group</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nlocal</span><span class="p">):</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_free</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="bp">None</span>

  <span class="c1"># set variable value</span>
  <span class="c1"># value is converted to string</span>
  <span class="c1"># returns 0 for success, -1 if failed</span>

  <span class="k">def</span> <span class="nf">set_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_set_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
  <span class="c1"># return total number of atoms in system</span>

  <span class="k">def</span> <span class="nf">get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>

  <span class="c1"># return vector of atom properties gathered across procs, ordered by atom ID</span>

  <span class="k">def</span> <span class="nf">gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">):</span>
    <span class="n">natoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">data</span> <span class="o">=</span> <span class="p">((</span><span class="n">count</span><span class="o">*</span><span class="n">natoms</span><span class="p">)</span><span class="o">*</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">data</span> <span class="o">=</span> <span class="p">((</span><span class="n">count</span><span class="o">*</span><span class="n">natoms</span><span class="p">)</span><span class="o">*</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">data</span>

  <span class="c1"># scatter vector of atom properties across procs, ordered by atom ID</span>
  <span class="c1"># assume vector is of correct type and length, as created by gather_atoms()</span>

  <span class="k">def</span> <span class="nf">scatter_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_scatter_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">DEMPy</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;A class that implements a python interface for DEM computations&quot;&quot;&quot;</span>
  <span class="c1"># TODO: This class should be generic (not specific to liggghts), must</span>
  <span class="c1"># handle all I/O, garbage collection, etc. and then moved to DEM.py</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">library</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="o">**</span><span class="n">pargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Initialize some settings and specifications</span>
<span class="sd">    @ units: unit system (si, cgs, etc.)</span>
<span class="sd">    @ dim: dimensions of the problem (2 or 3)</span>
<span class="sd">    # style: granular, atom, or ...</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s1">&#39;print&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pargs</span><span class="p">:</span>
      <span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;dt&#39;</span><span class="p">,</span> <span class="s1">&#39;atoms&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">split</span> <span class="o">=</span> <span class="n">split</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span> <span class="o">=</span> <span class="n">pargs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">monitorList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nSS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="k">global</span> <span class="n">logging</span>

      <span class="n">logging</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;logging&#39;</span><span class="p">)</span>

      <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;dem.log&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1">:</span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Working in {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating i/o directories&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dir&#39;</span><span class="p">]):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dir&#39;</span><span class="p">])</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
          <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Instantiating LIGGGHTS object&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">liggghts</span><span class="p">(</span><span class="n">comm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">,</span> <span class="n">library</span><span class="o">=</span><span class="n">library</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">cmdargs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-log&#39;</span><span class="p">,</span> <span class="s1">&#39;liggghts.log&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up problem dimensions and boundaries&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;units {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;hard_particles yes&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dimension {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;atom_style {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;atom_modify map array&#39;</span><span class="p">)</span> <span class="c1"># array is faster than hash in looking up atomic IDs, but the former takes more memory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;boundary &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;boundary&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;boundary&#39;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;newton off&#39;</span><span class="p">)</span> <span class="c1"># turn off newton&#39;s 3rd law ~ should lead to better scalability</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;communicate single vel yes&#39;</span><span class="p">)</span> <span class="c1"># have no idea what this does, but it&#39;s imp for ghost atoms</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;processors * * *&#39;</span><span class="p">)</span> <span class="c1"># let LIGGGHTS handle DD</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>
      <span class="n">scriptFile</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Backing up {} file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scriptFile</span><span class="p">))</span>
      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cp {}/../{} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">scriptFile</span><span class="p">,</span> <span class="n">scriptFile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-bk.py&#39;</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">scatter_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">scatter_atoms</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">gather_atoms</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">extract_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_global</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_compute</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">createParticles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">createParticles</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">createDomain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Define the domain of the simulation</span>
<span class="sd">    @ nsys: number of subsystems</span>
<span class="sd">    @ pos: 6 x 1 tuple that defines the boundaries of the box</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating domain&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;box&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;region domain block &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; units box volume_limit 1e-20&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;cylinder&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;region domain cylinder &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;cylinder&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;cylinder&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; units box volume_limit 1e-20&#39;</span><span class="p">)</span> 

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;create_box {} domain&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;nSS&#39;</span><span class="p">]))</span>

  <span class="k">def</span> <span class="nf">setupParticles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Setup particle for insertion if requested by the user</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]:</span>

      <span class="c1"># Make sure we are setting up particles, not walls (so we check for id existence)</span>
      <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">ss</span> <span class="ow">and</span> <span class="s1">&#39;wall&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
          <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up particles for group{id}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">))</span>

        <span class="n">randName</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">pddName</span> <span class="o">=</span> <span class="s1">&#39;pdd&#39;</span> <span class="o">+</span> <span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">))</span>

        <span class="k">if</span> <span class="s1">&#39;vol_lim&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
          <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;vol_lim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-20</span>

        <span class="nb">id</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;group group{} type {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="s1">&#39;args&#39;</span><span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
          <span class="n">args</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">args</span> <span class="o">=</span> <span class="p">()</span>

        <span class="k">if</span> <span class="s1">&#39;radius&#39;</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
          <span class="n">radius</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;group{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; particletemplate/{style} 15485867 volume_limit {vol_lim} atom_type {id} density constant {density} radius&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">radius</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">radius</span><span class="p">)</span> \
          <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;group{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; particletemplate/{style} 15485867 volume_limit {vol_lim} atom_type {id} density constant {density}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pddName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;group{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; particledistribution/discrete 67867967 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; {} 1.0&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;multisphere&#39;</span><span class="p">:</span>
          <span class="n">itype</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">itype</span> <span class="o">=</span> <span class="s1">&#39;nve/{style}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span>

        <span class="c1">#Do NOT unfix randName! Will cause a memory corruption error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pddName</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function inserts particles, and assigns particle velocities if requested by the user. If species is &#39;all&#39;,</span>
<span class="sd">    all components specified in SS are inserted. Otherwise, species must be the id of the component to be inserted.</span>

<span class="sd">    region: tuple of the form (&#39;shape&#39;, (xmin, xmax, ymin, ymax, zmin, zmax)) or (&#39;shape&#39;, xmin, xmax, ymin, ymax, zmin, zmax)</span>

<span class="sd">    TODO: support insertion of all or multiple species at the same time for multiple regions. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Probability distribution not set for particle insertion. Exiting ...&#39;</span><span class="p">)</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="k">if</span> <span class="s1">&#39;region&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="n">region</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># Default region is sim box</span>
      <span class="k">if</span> <span class="s1">&#39;cylinder&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
        <span class="n">region</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;cylinder&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;cylinder&#39;</span><span class="p">])</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">region</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;block&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">])</span>
        
      <span class="n">region</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="mi">0</span><span class="p">]])</span>
      <span class="n">args</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">region</span>

    <span class="c1"># I think this is for creating tuples of lists, corresponding to many regions</span>
    <span class="c1"># This is prolly for inserting many species at the same time in different regions</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
      <span class="n">targs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">targs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

      <span class="n">tmp</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)):</span>
        <span class="n">targs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

      <span class="n">region</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">targs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">vel_type</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">mech</span><span class="p">,</span> <span class="o">**</span><span class="n">ss</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; For multi-component system, this function can cause REAL *trouble*. For now, make sure components</span>
<span class="sd">      are inserted consecutively or all at once.</span>

<span class="sd">      TODO: let the user override volume_limit</span>
<span class="sd">      &quot;&quot;&quot;</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Inserting particles for species {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

      <span class="n">seed</span> <span class="o">=</span> <span class="mi">32452843</span>
      <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">)</span>

      <span class="n">randName</span> <span class="o">=</span> <span class="s1">&#39;insert&#39;</span> <span class="o">+</span> <span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;region {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">region</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">region</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;units box volume_limit 1e-20&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="s1">&#39;args&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>

      <span class="k">if</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;once&#39;</span>

      <span class="k">if</span> <span class="s1">&#39;all_in&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;all_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>

      <span class="k">if</span> <span class="s1">&#39;insert&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;insert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;by_pack&#39;</span>

      <span class="k">if</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;insert&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;by_rate&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mech</span><span class="p">:</span>
          <span class="n">mech</span> <span class="o">=</span> <span class="s1">&#39;nparticles&#39;</span>

        <span class="k">if</span> <span class="n">mech</span> <span class="ow">is</span> <span class="s1">&#39;nparticles&#39;</span><span class="p">:</span>
          <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} insert/rate/region seed 123481 distributiontemplate {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span> <span class="n">mech</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">+</span> \
          <span class="s1">&#39; particlerate {rate} insert_every {freq} overlapcheck yes all_in {all_in}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; vel {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel_type</span><span class="p">)</span> \
          <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">vel</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; region {} ntry_mc 10000&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">)</span>
      <span class="k">elif</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;insert&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;by_pack&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mech</span><span class="p">:</span>
          <span class="n">mech</span> <span class="o">=</span> <span class="s1">&#39;particles_in_region&#39;</span>

        <span class="k">if</span> <span class="n">mech</span> <span class="ow">is</span> <span class="s1">&#39;particles_in_region&#39;</span><span class="p">:</span>
          <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} insert/pack seed {} distributiontemplate {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">[</span><span class="nb">id</span><span class="p">])</span> <span class="o">+</span> \
          <span class="s1">&#39; insert_every {freq} overlapcheck yes all_in {all_in}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; vel {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel_type</span><span class="p">)</span> \
          <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">vel</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; {} {} region {} ntry_mc 10000&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mech</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;WARNING: Insertion mechanism {insert} not found. Assuming insertion by rate ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mech</span> <span class="ow">is</span> <span class="s1">&#39;nparticles&#39;</span><span class="p">:</span>
          <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

        <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} insert/rate/region seed 123481 distributiontemplate {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span> <span class="n">mech</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">+</span> \
          <span class="s1">&#39; {rate_type} {rate} insert_every {freq} overlapcheck yes all_in {all_in}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; vel {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel_type</span><span class="p">)</span> \
          <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">vel</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; region {} ntry_mc 10000&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

      <span class="k">return</span> <span class="n">randName</span>

    <span class="k">if</span> <span class="n">species</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>

      <span class="n">species</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>

      <span class="n">ss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">][</span><span class="n">species</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

      <span class="k">if</span> <span class="s1">&#39;vel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

      <span class="k">if</span> <span class="s1">&#39;vel_type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;vel_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;constant&#39;</span>

      <span class="k">if</span> <span class="s1">&#39;mech&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mech&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

      <span class="n">randName</span> <span class="o">=</span> <span class="n">insert_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Insertion species {} not supported in PyGran.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">species</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">randName</span>

  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Runs a simulation for number of steps specified by the user</span>
<span class="sd">     @itype = sphere (rotational motion on) or rigid_sphere (rotational motion off)</span>
<span class="sd">     @dt = timestep&quot;&quot;&quot;</span>
    
    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupIntegrate</span><span class="p">(</span><span class="n">itype</span><span class="o">=</span><span class="n">itype</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dt</span><span class="p">:</span>
      <span class="k">if</span> <span class="s1">&#39;dt&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
          <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Could not find dt in user-supplied dictionary. Aborting ...&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">name</span>

  <span class="k">def</span> <span class="nf">moveMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    
    <span class="n">randName</span> <span class="o">=</span> <span class="s1">&#39;moveMesh&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} all move/mesh mesh {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">randName</span>

  <span class="k">def</span> <span class="nf">importMeshes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Imports all meshes and sets them up as walls. Can import only one mesh specified by the &#39;name&#39; keyword.</span>
<span class="sd">    @file: mesh filename</span>
<span class="sd">    @mtype: mesh type</span>
<span class="sd">    @args: additional args</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wall</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="s1">&#39;mesh&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

        <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
              <span class="k">if</span> <span class="n">mesh</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">importMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;mtype&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">])</span>  
                <span class="n">wall</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">elif</span> <span class="s1">&#39;import&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">importMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;mtype&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">])</span>  
                <span class="n">wall</span> <span class="o">=</span> <span class="bp">True</span>
              
      <span class="k">if</span> <span class="n">wall</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupWall</span><span class="p">(</span><span class="n">wtype</span><span class="o">=</span><span class="s1">&#39;mesh&#39;</span><span class="p">)</span>
    

  <span class="k">def</span> <span class="nf">importMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Imports a specific surface mesh requested by the user</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/../&#39;</span> <span class="o">+</span> <span class="nb">file</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Importing mesh from {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} all {} file {} type {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">setupWall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wtype</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">plane</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">peq</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a wall</span>
<span class="sd">    @ name: name of the variable defining a wall or a mesh</span>
<span class="sd">    @ wtype: type of the wall (primitive or mesh)</span>
<span class="sd">    @ plane: x, y, or z plane for primitive walls</span>
<span class="sd">    @ peq: plane equation for primitive walls</span>

<span class="sd">    This function can be called only ONCE for setting up all walls (restriction from LIGGGHTS)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gran</span> <span class="o">=</span> <span class="s1">&#39;gran&#39;</span> <span class="c1"># VERY HACKISH</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">modelExtra</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;model-args&#39;</span><span class="p">]:</span>
      <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;cohesion&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;tangential &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;rolling_friction&#39;</span><span class="p">):</span>
        <span class="n">modelExtra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="c1"># Replace any user-specified model args for all mesh walls</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">wtype</span> <span class="o">==</span> <span class="s1">&#39;mesh&#39;</span><span class="p">:</span>
        <span class="n">kname</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]:</span>
          <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">kname</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span> <span class="c1"># make sure this is an actual mesh keyword, not a mesh defined with a keyname same as a mesh arg!</span>
            <span class="n">modelExtra</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">kname</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">kname</span><span class="p">]</span>

    <span class="n">model</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">modelExtra</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">)</span>

    <span class="c1"># Can we take model args into account for walls???</span>

    <span class="k">if</span> <span class="n">wtype</span> <span class="o">==</span> <span class="s1">&#39;mesh&#39;</span><span class="p">:</span>
      <span class="n">meshName</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">mname</span> <span class="k">for</span> <span class="n">mname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mname</span><span class="p">]])</span>
      <span class="n">nMeshes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">meshName</span><span class="p">)</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix walls all wall/{} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gran</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">model</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">modelExtra</span><span class="p">)</span> <span class="o">+</span> \
      <span class="s1">&#39;{} n_meshes {} meshes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wtype</span><span class="p">,</span> <span class="n">nMeshes</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {} &#39;</span> <span class="o">*</span> <span class="n">nMeshes</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">meshName</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">wtype</span> <span class="o">==</span> <span class="s1">&#39;primitive&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} all wall/{} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">gran</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">model</span><span class="p">)</span> <span class="o">+</span>  <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">modelExtra</span><span class="p">)</span> <span class="o">+</span> \
        <span class="s1">&#39;{} type {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wtype</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">peq</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Wall type can be either primitive or mesh&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">name</span>

  <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes a specified fix. If the fix is for a mesh, we must unfix it and re-import all meshes again and setup them</span>
<span class="sd">    up as walls. Very tedious!</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Remove any DUMP-IDS 1st in case the user wants to move a mesh</span>
    <span class="k">if</span> <span class="s1">&#39;mesh&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]:</span>
        <span class="c1"># must delete all meshes / dumps in order to re-import remaining meshes</span>
        <span class="k">for</span> <span class="n">dump</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;undump {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dump</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;unfix walls&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;unfix {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mesh</span><span class="p">))</span>

        <span class="k">if</span> <span class="s1">&#39;mfile&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]:</span>
          <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;mfile cannot be a list. Something is not setup correctly.&#39;</span><span class="p">)</span>
          <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]:</span> <span class="c1"># the user has requested all mesh(es) be written as one file</span>
            <span class="k">pass</span>
          <span class="k">else</span><span class="p">:</span> <span class="c1"># self.pargs[&#39;traj&#39;][&#39;mfile&#39;] had better be None</span>
            <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># Re-import any remaining meshes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">importMeshes</span><span class="p">()</span>

        <span class="c1"># Create new dump setups, leaving particle dumps intact</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dumpSetup</span><span class="p">(</span><span class="n">only_mesh</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="c1"># Otherwise, we are just unfixing a non-mesh fix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;unfix {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">createGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">group</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create groups of atoms. If group is empty, groups{i} are created for every i species.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating atom group {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">idSS</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;idSS&#39;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;group group{} type {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idSS</span><span class="p">,</span> <span class="n">idSS</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;group &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">group</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">createParticles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates particles of type &#39;type&#39; (1,2, ...) using style &#39;style&#39; (box or region or single or random)</span>
<span class="sd">    @[args]: &#39;basis&#39; or &#39;remap&#39; or &#39;units&#39; or &#39;all_in&#39; </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating particles {} with args&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;create_atoms {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span> <span class="o">+</span>  <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Set group/atom attributes &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;set &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">setupNeighbor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up NNS list parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up nearest neighbor searching parameters&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;nns_freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;nns_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">if</span> <span class="s1">&#39;nns_skin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
      <span class="n">radius</span> <span class="o">=</span> <span class="mi">0</span>

      <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;secies&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s1">&#39;radius&#39;</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
          <span class="n">radius</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;nns_skin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;neighbor {nns_skin} {nns_type}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;neigh_modify delay 0 every {nns_freq} check yes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">createProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Material and interaction properties required</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating property {} with args&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} all property/global&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">setupPhysics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify the interation forces</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up interaction parameters&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;model-args&#39;</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;pair_style &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;pair_coeff * *&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assigns velocity to selected particles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;velocity&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">setupGravity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify in which direction the gravitational force acts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;gravity&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix myGravity all gravity {} vector {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;gravity&#39;</span><span class="p">]))</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;restart {} {}/{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># create dummy restart tuple to pass below</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;read_data&#39;</span><span class="p">]:</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">createDomain</span><span class="p">()</span>
      <span class="c1">#self.createGroup()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupPhysics</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupNeighbor</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupParticles</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupGravity</span><span class="p">()</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;read_data&#39;</span><span class="p">]:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">createDomain</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">readData</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupPhysics</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupNeighbor</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupParticles</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupGravity</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">resume</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupPhysics</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupNeighbor</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupParticles</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupGravity</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">setupIntegrate</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">importMeshes</span><span class="p">()</span>
    
    <span class="c1"># Write output to trajectory by default unless the user specifies otherwise</span>
    <span class="k">if</span> <span class="s1">&#39;dump&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dump&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dumpSetup</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dumpSetup</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">setupIntegrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify how Newton&#39;s eqs are integrated in time. MUST BE EXECUTED ONLY ONCE.</span>
<span class="sd">    TODO: extend this to SQ particles</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up integration scheme parameters&#39;</span><span class="p">)</span>

    <span class="n">spheres</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="p">:</span>

      <span class="c1"># check timestep ~ do this only ONCE</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix ts_check all check/timestep/gran 1000 0.5 0.5&#39;</span><span class="p">)</span>

      <span class="c1"># Find which components (types) are spheres, multi-spheres, QS, etc.</span>
      <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">ss</span> <span class="ow">and</span> <span class="s1">&#39;wall&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span> <span class="c1"># dont count mesh wall(s)</span>
          <span class="k">if</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sphere&#39;</span><span class="p">:</span>
            <span class="n">spheres</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
          <span class="k">elif</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;multisphere&#39;</span><span class="p">:</span>
            <span class="n">multi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spheres</span><span class="p">):</span>
        <span class="c1">#self.createGroup(*(&#39;spheres type&#39;, (&#39; {}&#39; * len(spheres)).format(*spheres)))</span>

        <span class="k">for</span> <span class="n">sphere</span> <span class="ow">in</span> <span class="n">spheres</span><span class="p">:</span>
          <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;sphere_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="n">itype</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} nve/sphere&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sphere</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sphere</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">itype</span><span class="p">))</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

      <span class="c1"># LIGGGHTS does not permit more than one multisphere group to exist / integrated</span>
      <span class="c1"># So we will reject any MS groups beyond the 1st</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;LIGGGHTS (3.x) does not currently support more than one multisphere group.&quot;</span><span class="p">)</span>
      <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi</span><span class="p">):</span> <span class="c1"># must be of length 1</span>

        <span class="c1"># When LIGGGHTS supports multiple multisphere groups, I should uncomment this</span>
        <span class="c1">#self.createGroup(*(&#39;multi type&#39;, (&#39; {}&#39; * len(multi)).format(*multi)))</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">integ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">integ</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;multisphere&#39;</span><span class="p">):</span>
            <span class="n">ms</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">ms</span><span class="p">:</span>
          <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;multisphere_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} multisphere&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">multi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span>

  <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run simulation in time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Integrating the system for {} steps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">steps</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitorList</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;compute {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;timestep {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;run {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">steps</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">printSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify which variables to write to file, and their format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up printing options&#39;</span><span class="p">)</span>

    <span class="n">freq</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;thermo_style custom&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;thermo {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;thermo_modify norm no lost ignore&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">dumpSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_mesh</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This creates dumps for particles and meshes in the system. In LIGGGHTS, all meshes must be declared once, so if a mesh is removed during</span>
<span class="sd">    the simulation, this function has to be called again, usually with only_mesh=True to keep the particle dump intact.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up trajectory i/o&#39;</span><span class="p">)</span>

    <span class="c1"># Make sure the user did not request no particles be saved to a traj file, or we&#39;re not just re-initializing the meshes</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">only_mesh</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;pfile&#39;</span><span class="p">]:</span>

      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dump&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;undump dump&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dump&#39;</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; {sel} {style} {freq} {dir}/{pfile}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump_modify {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span>  <span class="p">(</span><span class="s1">&#39; {} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dump_modify&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dump_modify&#39;</span><span class="p">]))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Make sure meshes are defined so we can dump them if requested (or not)</span>
    <span class="k">if</span> <span class="s1">&#39;mesh&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dump&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">:</span>
          <span class="k">for</span> <span class="n">dname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;undump &#39;</span> <span class="o">+</span> <span class="n">dname</span><span class="p">)</span>

      <span class="k">if</span> <span class="s1">&#39;mfile&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

          <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
          <span class="c1"># Make sure only mehs keywords supplied with files are counter, otherwise, they&#39;re args to the mesh wall!</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]:</span>
              <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
              <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span> <span class="o">+</span> <span class="s1">&#39;-*.vtk&#39;</span>
              <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span>
              <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dump&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">))</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

              <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump &#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; all mesh/vtk {freq} {dir}/{mfile} id stress stresscomponents vel {mName}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">))</span>
      <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]:</span>
          <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

          <span class="c1"># see if we have many meshes to dump if the name of one mfile supplied by the user</span>
          <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]:</span>
                <span class="n">name</span> <span class="o">+=</span> <span class="n">mesh</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>

          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># remove last space to avoid fake (empty) mesh IDs</span>

            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            
            <span class="n">dname</span> <span class="o">=</span> <span class="s1">&#39;dump&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dname</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump &#39;</span> <span class="o">+</span> <span class="n">dname</span> <span class="o">+</span> <span class="s1">&#39; all mesh/vtk {freq} {dir}/{mfile} id stress stresscomponents vel &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dump</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">name</span>

  <span class="k">def</span> <span class="nf">extractCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts atomic positions from a certian frame and adds it to coords</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Extract coordinates from liggghts</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable x atom x&#39;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Rxn</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_variable</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable y atom y&#39;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Rxn</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_variable</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable z atom z&#39;</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Rxn</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_variable</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">(),</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()):</span>
      <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable x delete&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable y delete&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable z delete&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">coords</span>

  <span class="k">def</span> <span class="nf">monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;compute {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix my{} {} ave/time 1 1 1 c_{} file {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="nb">file</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">add_viscous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adds a viscous damping force: F = - gamma * v for each particle</span>
<span class="sd">    @species = 1,2, ... or all</span>
<span class="sd">    @gamma: real number (viscosity coefficient)</span>
<span class="sd">    @[scale]: tuple (species, ratio) to scale gamma with</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;scale&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="n">args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;species&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;group&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Species must be specified (1,2,..., or &quot;all&quot;) for which the viscous force applies.&#39;</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; {species} viscous {gamma} scale &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">])</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">name</span>

  <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="c1">#plt.rc(&#39;text&#39;, usetex=True)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">xscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
          <span class="n">time</span> <span class="o">*=</span> <span class="n">xscale</span>

          <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xlabel</span><span class="p">))</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
      <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span><span class="p">(</span><span class="s2">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">saveas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>

      <span class="k">try</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
      <span class="k">except</span><span class="p">:</span>
         <span class="k">raise</span><span class="p">(</span><span class="s2">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Passes a specific command to LIGGGHTS</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rdir</span> <span class="o">=</span> <span class="s1">&#39;{}/*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
      <span class="n">rfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">rfile</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="n">rdir</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;read_restart {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rfile</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">readData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;read_data&#39;</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;read_dump &#39;</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

  <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Destructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">


    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="PyGran.Simulator.engine_liggghts.DEMPy" class="name">class <span class="ident">DEMPy</span></p>
      
  
    <div class="desc"><p>A class that implements a python interface for DEM computations</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">DEMPy</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;A class that implements a python interface for DEM computations&quot;&quot;&quot;</span>
  <span class="c1"># TODO: This class should be generic (not specific to liggghts), must</span>
  <span class="c1"># handle all I/O, garbage collection, etc. and then moved to DEM.py</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">library</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="o">**</span><span class="n">pargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Initialize some settings and specifications</span>
<span class="sd">    @ units: unit system (si, cgs, etc.)</span>
<span class="sd">    @ dim: dimensions of the problem (2 or 3)</span>
<span class="sd">    # style: granular, atom, or ...</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s1">&#39;print&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pargs</span><span class="p">:</span>
      <span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;dt&#39;</span><span class="p">,</span> <span class="s1">&#39;atoms&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">split</span> <span class="o">=</span> <span class="n">split</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span> <span class="o">=</span> <span class="n">pargs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">monitorList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nSS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="k">global</span> <span class="n">logging</span>

      <span class="n">logging</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;logging&#39;</span><span class="p">)</span>

      <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;dem.log&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1">:</span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Working in {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating i/o directories&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dir&#39;</span><span class="p">]):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dir&#39;</span><span class="p">])</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
          <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Instantiating LIGGGHTS object&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">liggghts</span><span class="p">(</span><span class="n">comm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">,</span> <span class="n">library</span><span class="o">=</span><span class="n">library</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">cmdargs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-log&#39;</span><span class="p">,</span> <span class="s1">&#39;liggghts.log&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up problem dimensions and boundaries&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;units {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;hard_particles yes&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dimension {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;atom_style {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;atom_modify map array&#39;</span><span class="p">)</span> <span class="c1"># array is faster than hash in looking up atomic IDs, but the former takes more memory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;boundary &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;boundary&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;boundary&#39;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;newton off&#39;</span><span class="p">)</span> <span class="c1"># turn off newton&#39;s 3rd law ~ should lead to better scalability</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;communicate single vel yes&#39;</span><span class="p">)</span> <span class="c1"># have no idea what this does, but it&#39;s imp for ghost atoms</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;processors * * *&#39;</span><span class="p">)</span> <span class="c1"># let LIGGGHTS handle DD</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>
      <span class="n">scriptFile</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Backing up {} file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scriptFile</span><span class="p">))</span>
      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cp {}/../{} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">scriptFile</span><span class="p">,</span> <span class="n">scriptFile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-bk.py&#39;</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">scatter_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">scatter_atoms</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">gather_atoms</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">extract_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_global</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_compute</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">createParticles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">createParticles</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">createDomain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Define the domain of the simulation</span>
<span class="sd">    @ nsys: number of subsystems</span>
<span class="sd">    @ pos: 6 x 1 tuple that defines the boundaries of the box</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating domain&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;box&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;region domain block &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; units box volume_limit 1e-20&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;cylinder&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;region domain cylinder &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;cylinder&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;cylinder&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; units box volume_limit 1e-20&#39;</span><span class="p">)</span> 

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;create_box {} domain&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;nSS&#39;</span><span class="p">]))</span>

  <span class="k">def</span> <span class="nf">setupParticles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Setup particle for insertion if requested by the user</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]:</span>

      <span class="c1"># Make sure we are setting up particles, not walls (so we check for id existence)</span>
      <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">ss</span> <span class="ow">and</span> <span class="s1">&#39;wall&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
          <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up particles for group{id}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">))</span>

        <span class="n">randName</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">pddName</span> <span class="o">=</span> <span class="s1">&#39;pdd&#39;</span> <span class="o">+</span> <span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">))</span>

        <span class="k">if</span> <span class="s1">&#39;vol_lim&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
          <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;vol_lim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-20</span>

        <span class="nb">id</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;group group{} type {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="s1">&#39;args&#39;</span><span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
          <span class="n">args</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">args</span> <span class="o">=</span> <span class="p">()</span>

        <span class="k">if</span> <span class="s1">&#39;radius&#39;</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
          <span class="n">radius</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;group{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; particletemplate/{style} 15485867 volume_limit {vol_lim} atom_type {id} density constant {density} radius&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">radius</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">radius</span><span class="p">)</span> \
          <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;group{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; particletemplate/{style} 15485867 volume_limit {vol_lim} atom_type {id} density constant {density}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pddName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;group{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; particledistribution/discrete 67867967 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; {} 1.0&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;multisphere&#39;</span><span class="p">:</span>
          <span class="n">itype</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">itype</span> <span class="o">=</span> <span class="s1">&#39;nve/{style}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span>

        <span class="c1">#Do NOT unfix randName! Will cause a memory corruption error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pddName</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function inserts particles, and assigns particle velocities if requested by the user. If species is &#39;all&#39;,</span>
<span class="sd">    all components specified in SS are inserted. Otherwise, species must be the id of the component to be inserted.</span>

<span class="sd">    region: tuple of the form (&#39;shape&#39;, (xmin, xmax, ymin, ymax, zmin, zmax)) or (&#39;shape&#39;, xmin, xmax, ymin, ymax, zmin, zmax)</span>

<span class="sd">    TODO: support insertion of all or multiple species at the same time for multiple regions. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Probability distribution not set for particle insertion. Exiting ...&#39;</span><span class="p">)</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="k">if</span> <span class="s1">&#39;region&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="n">region</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># Default region is sim box</span>
      <span class="k">if</span> <span class="s1">&#39;cylinder&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
        <span class="n">region</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;cylinder&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;cylinder&#39;</span><span class="p">])</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">region</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;block&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">])</span>
        
      <span class="n">region</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="mi">0</span><span class="p">]])</span>
      <span class="n">args</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">region</span>

    <span class="c1"># I think this is for creating tuples of lists, corresponding to many regions</span>
    <span class="c1"># This is prolly for inserting many species at the same time in different regions</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
      <span class="n">targs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">targs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

      <span class="n">tmp</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)):</span>
        <span class="n">targs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

      <span class="n">region</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">targs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">vel_type</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">mech</span><span class="p">,</span> <span class="o">**</span><span class="n">ss</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; For multi-component system, this function can cause REAL *trouble*. For now, make sure components</span>
<span class="sd">      are inserted consecutively or all at once.</span>

<span class="sd">      TODO: let the user override volume_limit</span>
<span class="sd">      &quot;&quot;&quot;</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Inserting particles for species {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

      <span class="n">seed</span> <span class="o">=</span> <span class="mi">32452843</span>
      <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">)</span>

      <span class="n">randName</span> <span class="o">=</span> <span class="s1">&#39;insert&#39;</span> <span class="o">+</span> <span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;region {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">region</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">region</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;units box volume_limit 1e-20&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="s1">&#39;args&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>

      <span class="k">if</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;once&#39;</span>

      <span class="k">if</span> <span class="s1">&#39;all_in&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;all_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>

      <span class="k">if</span> <span class="s1">&#39;insert&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;insert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;by_pack&#39;</span>

      <span class="k">if</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;insert&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;by_rate&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mech</span><span class="p">:</span>
          <span class="n">mech</span> <span class="o">=</span> <span class="s1">&#39;nparticles&#39;</span>

        <span class="k">if</span> <span class="n">mech</span> <span class="ow">is</span> <span class="s1">&#39;nparticles&#39;</span><span class="p">:</span>
          <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} insert/rate/region seed 123481 distributiontemplate {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span> <span class="n">mech</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">+</span> \
          <span class="s1">&#39; particlerate {rate} insert_every {freq} overlapcheck yes all_in {all_in}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; vel {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel_type</span><span class="p">)</span> \
          <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">vel</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; region {} ntry_mc 10000&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">)</span>
      <span class="k">elif</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;insert&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;by_pack&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mech</span><span class="p">:</span>
          <span class="n">mech</span> <span class="o">=</span> <span class="s1">&#39;particles_in_region&#39;</span>

        <span class="k">if</span> <span class="n">mech</span> <span class="ow">is</span> <span class="s1">&#39;particles_in_region&#39;</span><span class="p">:</span>
          <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} insert/pack seed {} distributiontemplate {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">[</span><span class="nb">id</span><span class="p">])</span> <span class="o">+</span> \
          <span class="s1">&#39; insert_every {freq} overlapcheck yes all_in {all_in}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; vel {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel_type</span><span class="p">)</span> \
          <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">vel</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; {} {} region {} ntry_mc 10000&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mech</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;WARNING: Insertion mechanism {insert} not found. Assuming insertion by rate ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mech</span> <span class="ow">is</span> <span class="s1">&#39;nparticles&#39;</span><span class="p">:</span>
          <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

        <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} insert/rate/region seed 123481 distributiontemplate {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span> <span class="n">mech</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">+</span> \
          <span class="s1">&#39; {rate_type} {rate} insert_every {freq} overlapcheck yes all_in {all_in}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; vel {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel_type</span><span class="p">)</span> \
          <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">vel</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; region {} ntry_mc 10000&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

      <span class="k">return</span> <span class="n">randName</span>

    <span class="k">if</span> <span class="n">species</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>

      <span class="n">species</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>

      <span class="n">ss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">][</span><span class="n">species</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

      <span class="k">if</span> <span class="s1">&#39;vel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

      <span class="k">if</span> <span class="s1">&#39;vel_type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;vel_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;constant&#39;</span>

      <span class="k">if</span> <span class="s1">&#39;mech&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mech&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

      <span class="n">randName</span> <span class="o">=</span> <span class="n">insert_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Insertion species {} not supported in PyGran.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">species</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">randName</span>

  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Runs a simulation for number of steps specified by the user</span>
<span class="sd">     @itype = sphere (rotational motion on) or rigid_sphere (rotational motion off)</span>
<span class="sd">     @dt = timestep&quot;&quot;&quot;</span>
    
    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupIntegrate</span><span class="p">(</span><span class="n">itype</span><span class="o">=</span><span class="n">itype</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dt</span><span class="p">:</span>
      <span class="k">if</span> <span class="s1">&#39;dt&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
          <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Could not find dt in user-supplied dictionary. Aborting ...&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">name</span>

  <span class="k">def</span> <span class="nf">moveMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    
    <span class="n">randName</span> <span class="o">=</span> <span class="s1">&#39;moveMesh&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} all move/mesh mesh {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">randName</span>

  <span class="k">def</span> <span class="nf">importMeshes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Imports all meshes and sets them up as walls. Can import only one mesh specified by the &#39;name&#39; keyword.</span>
<span class="sd">    @file: mesh filename</span>
<span class="sd">    @mtype: mesh type</span>
<span class="sd">    @args: additional args</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wall</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="s1">&#39;mesh&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

        <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
              <span class="k">if</span> <span class="n">mesh</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">importMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;mtype&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">])</span>  
                <span class="n">wall</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">elif</span> <span class="s1">&#39;import&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">importMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;mtype&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">])</span>  
                <span class="n">wall</span> <span class="o">=</span> <span class="bp">True</span>
              
      <span class="k">if</span> <span class="n">wall</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupWall</span><span class="p">(</span><span class="n">wtype</span><span class="o">=</span><span class="s1">&#39;mesh&#39;</span><span class="p">)</span>
    

  <span class="k">def</span> <span class="nf">importMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Imports a specific surface mesh requested by the user</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/../&#39;</span> <span class="o">+</span> <span class="nb">file</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Importing mesh from {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} all {} file {} type {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">setupWall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wtype</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">plane</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">peq</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a wall</span>
<span class="sd">    @ name: name of the variable defining a wall or a mesh</span>
<span class="sd">    @ wtype: type of the wall (primitive or mesh)</span>
<span class="sd">    @ plane: x, y, or z plane for primitive walls</span>
<span class="sd">    @ peq: plane equation for primitive walls</span>

<span class="sd">    This function can be called only ONCE for setting up all walls (restriction from LIGGGHTS)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gran</span> <span class="o">=</span> <span class="s1">&#39;gran&#39;</span> <span class="c1"># VERY HACKISH</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">modelExtra</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;model-args&#39;</span><span class="p">]:</span>
      <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;cohesion&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;tangential &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;rolling_friction&#39;</span><span class="p">):</span>
        <span class="n">modelExtra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="c1"># Replace any user-specified model args for all mesh walls</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">wtype</span> <span class="o">==</span> <span class="s1">&#39;mesh&#39;</span><span class="p">:</span>
        <span class="n">kname</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]:</span>
          <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">kname</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span> <span class="c1"># make sure this is an actual mesh keyword, not a mesh defined with a keyname same as a mesh arg!</span>
            <span class="n">modelExtra</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">kname</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">kname</span><span class="p">]</span>

    <span class="n">model</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">modelExtra</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">)</span>

    <span class="c1"># Can we take model args into account for walls???</span>

    <span class="k">if</span> <span class="n">wtype</span> <span class="o">==</span> <span class="s1">&#39;mesh&#39;</span><span class="p">:</span>
      <span class="n">meshName</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">mname</span> <span class="k">for</span> <span class="n">mname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mname</span><span class="p">]])</span>
      <span class="n">nMeshes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">meshName</span><span class="p">)</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix walls all wall/{} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gran</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">model</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">modelExtra</span><span class="p">)</span> <span class="o">+</span> \
      <span class="s1">&#39;{} n_meshes {} meshes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wtype</span><span class="p">,</span> <span class="n">nMeshes</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {} &#39;</span> <span class="o">*</span> <span class="n">nMeshes</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">meshName</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">wtype</span> <span class="o">==</span> <span class="s1">&#39;primitive&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} all wall/{} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">gran</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">model</span><span class="p">)</span> <span class="o">+</span>  <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">modelExtra</span><span class="p">)</span> <span class="o">+</span> \
        <span class="s1">&#39;{} type {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wtype</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">peq</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Wall type can be either primitive or mesh&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">name</span>

  <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes a specified fix. If the fix is for a mesh, we must unfix it and re-import all meshes again and setup them</span>
<span class="sd">    up as walls. Very tedious!</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Remove any DUMP-IDS 1st in case the user wants to move a mesh</span>
    <span class="k">if</span> <span class="s1">&#39;mesh&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]:</span>
        <span class="c1"># must delete all meshes / dumps in order to re-import remaining meshes</span>
        <span class="k">for</span> <span class="n">dump</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;undump {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dump</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;unfix walls&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;unfix {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mesh</span><span class="p">))</span>

        <span class="k">if</span> <span class="s1">&#39;mfile&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]:</span>
          <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;mfile cannot be a list. Something is not setup correctly.&#39;</span><span class="p">)</span>
          <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]:</span> <span class="c1"># the user has requested all mesh(es) be written as one file</span>
            <span class="k">pass</span>
          <span class="k">else</span><span class="p">:</span> <span class="c1"># self.pargs[&#39;traj&#39;][&#39;mfile&#39;] had better be None</span>
            <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># Re-import any remaining meshes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">importMeshes</span><span class="p">()</span>

        <span class="c1"># Create new dump setups, leaving particle dumps intact</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dumpSetup</span><span class="p">(</span><span class="n">only_mesh</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="c1"># Otherwise, we are just unfixing a non-mesh fix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;unfix {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">createGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">group</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create groups of atoms. If group is empty, groups{i} are created for every i species.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating atom group {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">idSS</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;idSS&#39;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;group group{} type {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idSS</span><span class="p">,</span> <span class="n">idSS</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;group &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">group</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">createParticles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates particles of type &#39;type&#39; (1,2, ...) using style &#39;style&#39; (box or region or single or random)</span>
<span class="sd">    @[args]: &#39;basis&#39; or &#39;remap&#39; or &#39;units&#39; or &#39;all_in&#39; </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating particles {} with args&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;create_atoms {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span> <span class="o">+</span>  <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Set group/atom attributes &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;set &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">setupNeighbor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up NNS list parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up nearest neighbor searching parameters&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;nns_freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;nns_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">if</span> <span class="s1">&#39;nns_skin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
      <span class="n">radius</span> <span class="o">=</span> <span class="mi">0</span>

      <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;secies&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s1">&#39;radius&#39;</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
          <span class="n">radius</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;nns_skin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;neighbor {nns_skin} {nns_type}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;neigh_modify delay 0 every {nns_freq} check yes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">createProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Material and interaction properties required</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating property {} with args&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} all property/global&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">setupPhysics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify the interation forces</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up interaction parameters&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;model-args&#39;</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;pair_style &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;pair_coeff * *&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assigns velocity to selected particles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;velocity&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">setupGravity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify in which direction the gravitational force acts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;gravity&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix myGravity all gravity {} vector {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;gravity&#39;</span><span class="p">]))</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;restart {} {}/{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># create dummy restart tuple to pass below</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;read_data&#39;</span><span class="p">]:</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">createDomain</span><span class="p">()</span>
      <span class="c1">#self.createGroup()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupPhysics</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupNeighbor</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupParticles</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupGravity</span><span class="p">()</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;read_data&#39;</span><span class="p">]:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">createDomain</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">readData</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupPhysics</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupNeighbor</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupParticles</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupGravity</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">resume</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupPhysics</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupNeighbor</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupParticles</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupGravity</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">setupIntegrate</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">importMeshes</span><span class="p">()</span>
    
    <span class="c1"># Write output to trajectory by default unless the user specifies otherwise</span>
    <span class="k">if</span> <span class="s1">&#39;dump&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dump&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dumpSetup</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dumpSetup</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">setupIntegrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify how Newton&#39;s eqs are integrated in time. MUST BE EXECUTED ONLY ONCE.</span>
<span class="sd">    TODO: extend this to SQ particles</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up integration scheme parameters&#39;</span><span class="p">)</span>

    <span class="n">spheres</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="p">:</span>

      <span class="c1"># check timestep ~ do this only ONCE</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix ts_check all check/timestep/gran 1000 0.5 0.5&#39;</span><span class="p">)</span>

      <span class="c1"># Find which components (types) are spheres, multi-spheres, QS, etc.</span>
      <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">ss</span> <span class="ow">and</span> <span class="s1">&#39;wall&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span> <span class="c1"># dont count mesh wall(s)</span>
          <span class="k">if</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sphere&#39;</span><span class="p">:</span>
            <span class="n">spheres</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
          <span class="k">elif</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;multisphere&#39;</span><span class="p">:</span>
            <span class="n">multi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spheres</span><span class="p">):</span>
        <span class="c1">#self.createGroup(*(&#39;spheres type&#39;, (&#39; {}&#39; * len(spheres)).format(*spheres)))</span>

        <span class="k">for</span> <span class="n">sphere</span> <span class="ow">in</span> <span class="n">spheres</span><span class="p">:</span>
          <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;sphere_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="n">itype</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} nve/sphere&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sphere</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sphere</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">itype</span><span class="p">))</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

      <span class="c1"># LIGGGHTS does not permit more than one multisphere group to exist / integrated</span>
      <span class="c1"># So we will reject any MS groups beyond the 1st</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;LIGGGHTS (3.x) does not currently support more than one multisphere group.&quot;</span><span class="p">)</span>
      <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi</span><span class="p">):</span> <span class="c1"># must be of length 1</span>

        <span class="c1"># When LIGGGHTS supports multiple multisphere groups, I should uncomment this</span>
        <span class="c1">#self.createGroup(*(&#39;multi type&#39;, (&#39; {}&#39; * len(multi)).format(*multi)))</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">integ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">integ</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;multisphere&#39;</span><span class="p">):</span>
            <span class="n">ms</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">ms</span><span class="p">:</span>
          <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;multisphere_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} multisphere&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">multi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span>

  <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run simulation in time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Integrating the system for {} steps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">steps</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitorList</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;compute {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;timestep {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;run {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">steps</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">printSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify which variables to write to file, and their format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up printing options&#39;</span><span class="p">)</span>

    <span class="n">freq</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;thermo_style custom&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;thermo {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;thermo_modify norm no lost ignore&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">dumpSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_mesh</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This creates dumps for particles and meshes in the system. In LIGGGHTS, all meshes must be declared once, so if a mesh is removed during</span>
<span class="sd">    the simulation, this function has to be called again, usually with only_mesh=True to keep the particle dump intact.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up trajectory i/o&#39;</span><span class="p">)</span>

    <span class="c1"># Make sure the user did not request no particles be saved to a traj file, or we&#39;re not just re-initializing the meshes</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">only_mesh</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;pfile&#39;</span><span class="p">]:</span>

      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dump&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;undump dump&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dump&#39;</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; {sel} {style} {freq} {dir}/{pfile}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump_modify {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span>  <span class="p">(</span><span class="s1">&#39; {} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dump_modify&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dump_modify&#39;</span><span class="p">]))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Make sure meshes are defined so we can dump them if requested (or not)</span>
    <span class="k">if</span> <span class="s1">&#39;mesh&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dump&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">:</span>
          <span class="k">for</span> <span class="n">dname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;undump &#39;</span> <span class="o">+</span> <span class="n">dname</span><span class="p">)</span>

      <span class="k">if</span> <span class="s1">&#39;mfile&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

          <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
          <span class="c1"># Make sure only mehs keywords supplied with files are counter, otherwise, they&#39;re args to the mesh wall!</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]:</span>
              <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
              <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span> <span class="o">+</span> <span class="s1">&#39;-*.vtk&#39;</span>
              <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span>
              <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dump&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">))</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

              <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump &#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; all mesh/vtk {freq} {dir}/{mfile} id stress stresscomponents vel {mName}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">))</span>
      <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]:</span>
          <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

          <span class="c1"># see if we have many meshes to dump if the name of one mfile supplied by the user</span>
          <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]:</span>
                <span class="n">name</span> <span class="o">+=</span> <span class="n">mesh</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>

          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># remove last space to avoid fake (empty) mesh IDs</span>

            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            
            <span class="n">dname</span> <span class="o">=</span> <span class="s1">&#39;dump&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dname</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump &#39;</span> <span class="o">+</span> <span class="n">dname</span> <span class="o">+</span> <span class="s1">&#39; all mesh/vtk {freq} {dir}/{mfile} id stress stresscomponents vel &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dump</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">name</span>

  <span class="k">def</span> <span class="nf">extractCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts atomic positions from a certian frame and adds it to coords</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Extract coordinates from liggghts</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable x atom x&#39;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Rxn</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_variable</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable y atom y&#39;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Rxn</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_variable</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable z atom z&#39;</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Rxn</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_variable</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">(),</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()):</span>
      <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable x delete&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable y delete&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable z delete&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">coords</span>

  <span class="k">def</span> <span class="nf">monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;compute {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix my{} {} ave/time 1 1 1 c_{} file {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="nb">file</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">add_viscous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adds a viscous damping force: F = - gamma * v for each particle</span>
<span class="sd">    @species = 1,2, ... or all</span>
<span class="sd">    @gamma: real number (viscosity coefficient)</span>
<span class="sd">    @[scale]: tuple (species, ratio) to scale gamma with</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;scale&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="n">args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;species&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;group&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Species must be specified (1,2,..., or &quot;all&quot;) for which the viscous force applies.&#39;</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; {species} viscous {gamma} scale &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">])</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">name</span>

  <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="c1">#plt.rc(&#39;text&#39;, usetex=True)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">xscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
          <span class="n">time</span> <span class="o">*=</span> <span class="n">xscale</span>

          <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xlabel</span><span class="p">))</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
      <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span><span class="p">(</span><span class="s2">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">saveas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>

      <span class="k">try</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
      <span class="k">except</span><span class="p">:</span>
         <span class="k">raise</span><span class="p">(</span><span class="s2">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Passes a specific command to LIGGGHTS</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rdir</span> <span class="o">=</span> <span class="s1">&#39;{}/*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
      <span class="n">rfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">rfile</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="n">rdir</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;read_restart {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rfile</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">readData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;read_data&#39;</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;read_dump &#39;</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

  <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Destructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#PyGran.Simulator.engine_liggghts.DEMPy">DEMPy</a></li>
          <li><a href="/builtins.object.ext">builtins.object</a></li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, sid, split, library, style, **pargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize some settings and specifications
@ units: unit system (si, cgs, etc.)
@ dim: dimensions of the problem (2 or 3)</p>
<h1>style: granular, atom, or ...</h1></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.__init__', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">library</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="o">**</span><span class="n">pargs</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Initialize some settings and specifications</span>
<span class="sd">  @ units: unit system (si, cgs, etc.)</span>
<span class="sd">  @ dim: dimensions of the problem (2 or 3)</span>
<span class="sd">  # style: granular, atom, or ...</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="s1">&#39;print&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pargs</span><span class="p">:</span>
    <span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;dt&#39;</span><span class="p">,</span> <span class="s1">&#39;atoms&#39;</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">split</span> <span class="o">=</span> <span class="n">split</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span> <span class="o">=</span> <span class="n">pargs</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">monitorList</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">nSS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">])</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">logging</span>
    <span class="n">logging</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;logging&#39;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;dem.log&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1">:</span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Working in {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating i/o directories&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dir&#39;</span><span class="p">]):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dir&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Instantiating LIGGGHTS object&#39;</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">liggghts</span><span class="p">(</span><span class="n">comm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">,</span> <span class="n">library</span><span class="o">=</span><span class="n">library</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">cmdargs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-log&#39;</span><span class="p">,</span> <span class="s1">&#39;liggghts.log&#39;</span><span class="p">])</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up problem dimensions and boundaries&#39;</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;units {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;hard_particles yes&#39;</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dimension {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">]))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;atom_style {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;atom_modify map array&#39;</span><span class="p">)</span> <span class="c1"># array is faster than hash in looking up atomic IDs, but the former takes more memory</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;boundary &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;boundary&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;boundary&#39;</span><span class="p">]))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;newton off&#39;</span><span class="p">)</span> <span class="c1"># turn off newton&#39;s 3rd law ~ should lead to better scalability</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;communicate single vel yes&#39;</span><span class="p">)</span> <span class="c1"># have no idea what this does, but it&#39;s imp for ghost atoms</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;processors * * *&#39;</span><span class="p">)</span> <span class="c1"># let LIGGGHTS handle DD</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>
    <span class="n">scriptFile</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Backing up {} file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scriptFile</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cp {}/../{} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">scriptFile</span><span class="p">,</span> <span class="n">scriptFile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-bk.py&#39;</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.add_viscous">
    <p>def <span class="ident">add_viscous</span>(</p><p>self, **args)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds a viscous damping force: F = - gamma * v for each particle
@species = 1,2, ... or all
@gamma: real number (viscosity coefficient)
@[scale]: tuple (species, ratio) to scale gamma with</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.add_viscous', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.add_viscous" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_viscous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Adds a viscous damping force: F = - gamma * v for each particle</span>
<span class="sd">  @species = 1,2, ... or all</span>
<span class="sd">  @gamma: real number (viscosity coefficient)</span>
<span class="sd">  @[scale]: tuple (species, ratio) to scale gamma with</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="s1">&#39;scale&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
    <span class="n">args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
  <span class="k">if</span> <span class="s1">&#39;species&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
      <span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;group&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Species must be specified (1,2,..., or &quot;all&quot;) for which the viscous force applies.&#39;</span><span class="p">)</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; {species} viscous {gamma} scale &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">])</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">name</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.command">
    <p>def <span class="ident">command</span>(</p><p>self, cmd)</p>
    </div>
    

    
  
    <div class="desc"><p>Passes a specific command to LIGGGHTS</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.command', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.command" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Passes a specific command to LIGGGHTS</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.createDomain">
    <p>def <span class="ident">createDomain</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Define the domain of the simulation
@ nsys: number of subsystems
@ pos: 6 x 1 tuple that defines the boundaries of the box</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.createDomain', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.createDomain" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">createDomain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Define the domain of the simulation</span>
<span class="sd">  @ nsys: number of subsystems</span>
<span class="sd">  @ pos: 6 x 1 tuple that defines the boundaries of the box</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating domain&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="s1">&#39;box&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;region domain block &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; units box volume_limit 1e-20&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="s1">&#39;cylinder&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;region domain cylinder &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;cylinder&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;cylinder&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; units box volume_limit 1e-20&#39;</span><span class="p">)</span> 
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;create_box {} domain&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;nSS&#39;</span><span class="p">]))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.createGroup">
    <p>def <span class="ident">createGroup</span>(</p><p>self, *group)</p>
    </div>
    

    
  
    <div class="desc"><p>Create groups of atoms. If group is empty, groups{i} are created for every i species.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.createGroup', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.createGroup" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">createGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">group</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Create groups of atoms. If group is empty, groups{i} are created for every i species.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating atom group {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">idSS</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;idSS&#39;</span><span class="p">]:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;group group{} type {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idSS</span><span class="p">,</span> <span class="n">idSS</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;group &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">group</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.createParticles">
    <p>def <span class="ident">createParticles</span>(</p><p>self, type, style, *args)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates particles of type 'type' (1,2, ...) using style 'style' (box or region or single or random)
@[args]: 'basis' or 'remap' or 'units' or 'all_in'</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.createParticles', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.createParticles" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">createParticles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Creates particles of type &#39;type&#39; (1,2, ...) using style &#39;style&#39; (box or region or single or random)</span>
<span class="sd">  @[args]: &#39;basis&#39; or &#39;remap&#39; or &#39;units&#39; or &#39;all_in&#39; </span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating particles {} with args&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;create_atoms {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span> <span class="o">+</span>  <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.createProperty">
    <p>def <span class="ident">createProperty</span>(</p><p>self, name, *args)</p>
    </div>
    

    
  
    <div class="desc"><p>Material and interaction properties required</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.createProperty', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.createProperty" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">createProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Material and interaction properties required</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating property {} with args&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} all property/global&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.dumpSetup">
    <p>def <span class="ident">dumpSetup</span>(</p><p>self, only_mesh=False, name=None)</p>
    </div>
    

    
  
    <div class="desc"><p>This creates dumps for particles and meshes in the system. In LIGGGHTS, all meshes must be declared once, so if a mesh is removed during
the simulation, this function has to be called again, usually with only_mesh=True to keep the particle dump intact.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.dumpSetup', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.dumpSetup" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dumpSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_mesh</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  This creates dumps for particles and meshes in the system. In LIGGGHTS, all meshes must be declared once, so if a mesh is removed during</span>
<span class="sd">  the simulation, this function has to be called again, usually with only_mesh=True to keep the particle dump intact.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up trajectory i/o&#39;</span><span class="p">)</span>
  <span class="c1"># Make sure the user did not request no particles be saved to a traj file, or we&#39;re not just re-initializing the meshes</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">only_mesh</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;pfile&#39;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dump&#39;</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;undump dump&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
      <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dump&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; {sel} {style} {freq} {dir}/{pfile}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump_modify {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span>  <span class="p">(</span><span class="s1">&#39; {} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dump_modify&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dump_modify&#39;</span><span class="p">]))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="c1"># Make sure meshes are defined so we can dump them if requested (or not)</span>
  <span class="k">if</span> <span class="s1">&#39;mesh&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dump&#39;</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;undump &#39;</span> <span class="o">+</span> <span class="n">dname</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;mfile&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]:</span>
      <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
        <span class="c1"># Make sure only mehs keywords supplied with files are counter, otherwise, they&#39;re args to the mesh wall!</span>
          <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span> <span class="o">+</span> <span class="s1">&#39;-*.vtk&#39;</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dump&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump &#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; all mesh/vtk {freq} {dir}/{mfile} id stress stresscomponents vel {mName}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">))</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># see if we have many meshes to dump if the name of one mfile supplied by the user</span>
        <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
          <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]:</span>
              <span class="n">name</span> <span class="o">+=</span> <span class="n">mesh</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
          <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># remove last space to avoid fake (empty) mesh IDs</span>
          <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
          <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span>
          <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
          
          <span class="n">dname</span> <span class="o">=</span> <span class="s1">&#39;dump&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">))</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dname</span><span class="p">]</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;dump &#39;</span> <span class="o">+</span> <span class="n">dname</span> <span class="o">+</span> <span class="s1">&#39; all mesh/vtk {freq} {dir}/{mfile} id stress stresscomponents vel &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">dump</span> <span class="o">=</span> <span class="bp">True</span>
  <span class="k">return</span> <span class="n">name</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.extractCoords">
    <p>def <span class="ident">extractCoords</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Extracts atomic positions from a certian frame and adds it to coords</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.extractCoords', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.extractCoords" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extractCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Extracts atomic positions from a certian frame and adds it to coords</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># Extract coordinates from liggghts</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable x atom x&#39;</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">Rxn</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_variable</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable y atom y&#39;</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">Rxn</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_variable</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable z atom z&#39;</span><span class="p">)</span>
  <span class="n">z</span> <span class="o">=</span> <span class="n">Rxn</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_variable</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">(),</span><span class="mi">3</span><span class="p">))</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()):</span>
    <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable x delete&#39;</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable y delete&#39;</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;variable z delete&#39;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">coords</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.extract_compute">
    <p>def <span class="ident">extract_compute</span>(</p><p>self, id, style, type)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.extract_compute', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.extract_compute" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_compute</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.extract_global">
    <p>def <span class="ident">extract_global</span>(</p><p>self, name, type)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.extract_global', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.extract_global" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extract_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">extract_global</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.gather_atoms">
    <p>def <span class="ident">gather_atoms</span>(</p><p>self, name, type, count)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.gather_atoms', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.gather_atoms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">):</span>
  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">gather_atoms</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.get_natoms">
    <p>def <span class="ident">get_natoms</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.get_natoms', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.get_natoms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.importMesh">
    <p>def <span class="ident">importMesh</span>(</p><p>self, name, file, mtype, material, *args)</p>
    </div>
    

    
  
    <div class="desc"><p>Imports a specific surface mesh requested by the user</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.importMesh', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.importMesh" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">importMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Imports a specific surface mesh requested by the user</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/../&#39;</span> <span class="o">+</span> <span class="nb">file</span>
  
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Importing mesh from {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} all {} file {} type {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.importMeshes">
    <p>def <span class="ident">importMeshes</span>(</p><p>self, name=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Imports all meshes and sets them up as walls. Can import only one mesh specified by the 'name' keyword.
@file: mesh filename
@mtype: mesh type
@args: additional args</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.importMeshes', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.importMeshes" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">importMeshes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Imports all meshes and sets them up as walls. Can import only one mesh specified by the &#39;name&#39; keyword.</span>
<span class="sd">  @file: mesh filename</span>
<span class="sd">  @mtype: mesh type</span>
<span class="sd">  @args: additional args</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">wall</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="k">if</span> <span class="s1">&#39;mesh&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
          <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mesh</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">importMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;mtype&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">])</span>  
              <span class="n">wall</span> <span class="o">=</span> <span class="bp">True</span>
          <span class="k">elif</span> <span class="s1">&#39;import&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;import&#39;</span><span class="p">]:</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">importMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;mtype&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mesh</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">])</span>  
              <span class="n">wall</span> <span class="o">=</span> <span class="bp">True</span>
            
    <span class="k">if</span> <span class="n">wall</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setupWall</span><span class="p">(</span><span class="n">wtype</span><span class="o">=</span><span class="s1">&#39;mesh&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.initialize">
    <p>def <span class="ident">initialize</span>(</p><p>self, **params)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.initialize', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.initialize" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;restart {} {}/{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="c1"># create dummy restart tuple to pass below</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;read_data&#39;</span><span class="p">]:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">createDomain</span><span class="p">()</span>
    <span class="c1">#self.createGroup()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupPhysics</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupNeighbor</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupParticles</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupGravity</span><span class="p">()</span>
  <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;read_data&#39;</span><span class="p">]:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">createDomain</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">readData</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupPhysics</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupNeighbor</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupParticles</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupGravity</span><span class="p">()</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resume</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupPhysics</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupNeighbor</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupParticles</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupGravity</span><span class="p">()</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">setupIntegrate</span><span class="p">()</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">importMeshes</span><span class="p">()</span>
  
  <span class="c1"># Write output to trajectory by default unless the user specifies otherwise</span>
  <span class="k">if</span> <span class="s1">&#39;dump&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dump&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dumpSetup</span><span class="p">()</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dumpSetup</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.insert">
    <p>def <span class="ident">insert</span>(</p><p>self, species, value, **args)</p>
    </div>
    

    
  
    <div class="desc"><p>This function inserts particles, and assigns particle velocities if requested by the user. If species is 'all',
all components specified in SS are inserted. Otherwise, species must be the id of the component to be inserted.</p>
<p>region: tuple of the form ('shape', (xmin, xmax, ymin, ymax, zmin, zmax)) or ('shape', xmin, xmax, ymin, ymax, zmin, zmax)</p>
<p>TODO: support insertion of all or multiple species at the same time for multiple regions.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.insert', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.insert" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  This function inserts particles, and assigns particle velocities if requested by the user. If species is &#39;all&#39;,</span>
<span class="sd">  all components specified in SS are inserted. Otherwise, species must be the id of the component to be inserted.</span>
<span class="sd">  region: tuple of the form (&#39;shape&#39;, (xmin, xmax, ymin, ymax, zmin, zmax)) or (&#39;shape&#39;, xmin, xmax, ymin, ymax, zmin, zmax)</span>
<span class="sd">  TODO: support insertion of all or multiple species at the same time for multiple regions. </span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Probability distribution not set for particle insertion. Exiting ...&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
  <span class="k">if</span> <span class="s1">&#39;region&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="c1"># Default region is sim box</span>
    <span class="k">if</span> <span class="s1">&#39;cylinder&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="n">region</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;cylinder&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;cylinder&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">region</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;block&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">])</span>
      
    <span class="n">region</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">args</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">region</span>
  <span class="c1"># I think this is for creating tuples of lists, corresponding to many regions</span>
  <span class="c1"># This is prolly for inserting many species at the same time in different regions</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
    <span class="n">targs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">targs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)):</span>
      <span class="n">targs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">region</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">targs</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">insert_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">vel_type</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">mech</span><span class="p">,</span> <span class="o">**</span><span class="n">ss</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; For multi-component system, this function can cause REAL *trouble*. For now, make sure components</span>
<span class="sd">    are inserted consecutively or all at once.</span>
<span class="sd">    TODO: let the user override volume_limit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Inserting particles for species {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="mi">32452843</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">)</span>
    <span class="n">randName</span> <span class="o">=</span> <span class="s1">&#39;insert&#39;</span> <span class="o">+</span> <span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;region {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">region</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">region</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;units box volume_limit 1e-20&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;args&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
      <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
      <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;once&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;all_in&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
      <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;all_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;insert&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
      <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;insert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;by_pack&#39;</span>
    <span class="k">if</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;insert&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;by_rate&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">mech</span><span class="p">:</span>
        <span class="n">mech</span> <span class="o">=</span> <span class="s1">&#39;nparticles&#39;</span>
      <span class="k">if</span> <span class="n">mech</span> <span class="ow">is</span> <span class="s1">&#39;nparticles&#39;</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} insert/rate/region seed 123481 distributiontemplate {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span> <span class="n">mech</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">+</span> \
        <span class="s1">&#39; particlerate {rate} insert_every {freq} overlapcheck yes all_in {all_in}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; vel {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel_type</span><span class="p">)</span> \
        <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">vel</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; region {} ntry_mc 10000&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">elif</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;insert&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;by_pack&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">mech</span><span class="p">:</span>
        <span class="n">mech</span> <span class="o">=</span> <span class="s1">&#39;particles_in_region&#39;</span>
      <span class="k">if</span> <span class="n">mech</span> <span class="ow">is</span> <span class="s1">&#39;particles_in_region&#39;</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} insert/pack seed {} distributiontemplate {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">[</span><span class="nb">id</span><span class="p">])</span> <span class="o">+</span> \
        <span class="s1">&#39; insert_every {freq} overlapcheck yes all_in {all_in}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; vel {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel_type</span><span class="p">)</span> \
        <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">vel</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; {} {} region {} ntry_mc 10000&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mech</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="s1">&#39;WARNING: Insertion mechanism {insert} not found. Assuming insertion by rate ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">mech</span> <span class="ow">is</span> <span class="s1">&#39;nparticles&#39;</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>
      <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">get_natoms</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} insert/rate/region seed 123481 distributiontemplate {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span> <span class="n">mech</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">+</span> \
        <span class="s1">&#39; {rate_type} {rate} insert_every {freq} overlapcheck yes all_in {all_in}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; vel {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel_type</span><span class="p">)</span> \
        <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">vel</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; region {} ntry_mc 10000&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">randName</span>
  <span class="k">if</span> <span class="n">species</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
    <span class="n">species</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
    <span class="n">ss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">][</span><span class="n">species</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;vel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="n">args</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;vel_type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="n">args</span><span class="p">[</span><span class="s1">&#39;vel_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;constant&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;mech&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mech&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">randName</span> <span class="o">=</span> <span class="n">insert_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Insertion species {} not supported in PyGran.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">species</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">randName</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.integrate">
    <p>def <span class="ident">integrate</span>(</p><p>self, steps, dt=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Run simulation in time</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.integrate', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.integrate" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Run simulation in time</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Integrating the system for {} steps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">steps</span><span class="p">))</span>
  <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitorList</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;compute {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;timestep {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;run {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">steps</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.monitor">
    <p>def <span class="ident">monitor</span>(</p><p>self, name, group, var, file, species=&#39;all&#39;)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.monitor', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.monitor" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;compute {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix my{} {} ave/time 1 1 1 c_{} file {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="nb">file</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.moveMesh">
    <p>def <span class="ident">moveMesh</span>(</p><p>self, name, *args)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.moveMesh', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.moveMesh" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">moveMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
  
  <span class="n">randName</span> <span class="o">=</span> <span class="s1">&#39;moveMesh&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} all move/mesh mesh {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">randName</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.plot">
    <p>def <span class="ident">plot</span>(</p><p>self, fname, xlabel, ylabel, output=None, xscale=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.plot', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.plot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="c1">#plt.rc(&#39;text&#39;, usetex=True)</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
      <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">xscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">*=</span> <span class="n">xscale</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xlabel</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="k">raise</span><span class="p">(</span><span class="s2">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.printSetup">
    <p>def <span class="ident">printSetup</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Specify which variables to write to file, and their format</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.printSetup', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.printSetup" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">printSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Specify which variables to write to file, and their format</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up printing options&#39;</span><span class="p">)</span>
  <span class="n">freq</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;thermo_style custom&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;thermo {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;thermo_modify norm no lost ignore&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.readData">
    <p>def <span class="ident">readData</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.readData', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.readData" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">readData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;read_data&#39;</span><span class="p">]</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;read_dump &#39;</span>  <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.remove">
    <p>def <span class="ident">remove</span>(</p><p>self, name)</p>
    </div>
    

    
  
    <div class="desc"><p>Deletes a specified fix. If the fix is for a mesh, we must unfix it and re-import all meshes again and setup them
up as walls. Very tedious!</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.remove', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.remove" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Deletes a specified fix. If the fix is for a mesh, we must unfix it and re-import all meshes again and setup them</span>
<span class="sd">  up as walls. Very tedious!</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># Remove any DUMP-IDS 1st in case the user wants to move a mesh</span>
  <span class="k">if</span> <span class="s1">&#39;mesh&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]:</span>
      <span class="c1"># must delete all meshes / dumps in order to re-import remaining meshes</span>
      <span class="k">for</span> <span class="n">dump</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;dump_mname&#39;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;undump {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dump</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;unfix walls&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;unfix {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mesh</span><span class="p">))</span>
      <span class="k">if</span> <span class="s1">&#39;mfile&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
          <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;mfile cannot be a list. Something is not setup correctly.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]:</span> <span class="c1"># the user has requested all mesh(es) be written as one file</span>
          <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># self.pargs[&#39;traj&#39;][&#39;mfile&#39;] had better be None</span>
          <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;traj&#39;</span><span class="p">][</span><span class="s1">&#39;mfile&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>
      <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
      <span class="c1"># Re-import any remaining meshes</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">importMeshes</span><span class="p">()</span>
      <span class="c1"># Create new dump setups, leaving particle dumps intact</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dumpSetup</span><span class="p">(</span><span class="n">only_mesh</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
  
  <span class="c1"># Otherwise, we are just unfixing a non-mesh fix</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;unfix {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.resume">
    <p>def <span class="ident">resume</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.resume', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.resume" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">rdir</span> <span class="o">=</span> <span class="s1">&#39;{}/*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">rfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">rfile</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="n">rdir</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;read_restart {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rfile</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.run">
    <p>def <span class="ident">run</span>(</p><p>self, nsteps, dt=None, itype=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Runs a simulation for number of steps specified by the user
@itype = sphere (rotational motion on) or rigid_sphere (rotational motion off)
@dt = timestep</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.run', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Runs a simulation for number of steps specified by the user</span>
<span class="sd">   @itype = sphere (rotational motion on) or rigid_sphere (rotational motion off)</span>
<span class="sd">   @dt = timestep&quot;&quot;&quot;</span>
  
  <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupIntegrate</span><span class="p">(</span><span class="n">itype</span><span class="o">=</span><span class="n">itype</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">dt</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;dt&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
      <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Could not find dt in user-supplied dictionary. Aborting ...&#39;</span><span class="p">)</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">name</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.saveas">
    <p>def <span class="ident">saveas</span>(</p><p>self, name, fname)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.saveas', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.saveas" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">saveas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
    <span class="k">except</span><span class="p">:</span>
       <span class="k">raise</span><span class="p">(</span><span class="s2">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.scatter_atoms">
    <p>def <span class="ident">scatter_atoms</span>(</p><p>self, name, type, count, data)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.scatter_atoms', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.scatter_atoms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">scatter_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">scatter_atoms</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.set">
    <p>def <span class="ident">set</span>(</p><p>self, *args)</p>
    </div>
    

    
  
    <div class="desc"><p>Set group/atom attributes</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.set', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.set" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Set group/atom attributes &quot;&quot;&quot;</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;set &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.setupGravity">
    <p>def <span class="ident">setupGravity</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Specify in which direction the gravitational force acts</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.setupGravity', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.setupGravity" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setupGravity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Specify in which direction the gravitational force acts</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="s1">&#39;gravity&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix myGravity all gravity {} vector {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;gravity&#39;</span><span class="p">]))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.setupIntegrate">
    <p>def <span class="ident">setupIntegrate</span>(</p><p>self, itype=None, group=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Specify how Newton's eqs are integrated in time. MUST BE EXECUTED ONLY ONCE.
TODO: extend this to SQ particles</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.setupIntegrate', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.setupIntegrate" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setupIntegrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Specify how Newton&#39;s eqs are integrated in time. MUST BE EXECUTED ONLY ONCE.</span>
<span class="sd">  TODO: extend this to SQ particles</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up integration scheme parameters&#39;</span><span class="p">)</span>
  <span class="n">spheres</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">multi</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="p">:</span>
    <span class="c1"># check timestep ~ do this only ONCE</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix ts_check all check/timestep/gran 1000 0.5 0.5&#39;</span><span class="p">)</span>
    <span class="c1"># Find which components (types) are spheres, multi-spheres, QS, etc.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]):</span>
      <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">ss</span> <span class="ow">and</span> <span class="s1">&#39;wall&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span> <span class="c1"># dont count mesh wall(s)</span>
        <span class="k">if</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sphere&#39;</span><span class="p">:</span>
          <span class="n">spheres</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;multisphere&#39;</span><span class="p">:</span>
          <span class="n">multi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spheres</span><span class="p">):</span>
      <span class="c1">#self.createGroup(*(&#39;spheres type&#39;, (&#39; {}&#39; * len(spheres)).format(*spheres)))</span>
      <span class="k">for</span> <span class="n">sphere</span> <span class="ow">in</span> <span class="n">spheres</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;sphere_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">itype</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} nve/sphere&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sphere</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sphere</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">itype</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="c1"># LIGGGHTS does not permit more than one multisphere group to exist / integrated</span>
    <span class="c1"># So we will reject any MS groups beyond the 1st</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;LIGGGHTS (3.x) does not currently support more than one multisphere group.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi</span><span class="p">):</span> <span class="c1"># must be of length 1</span>
      <span class="c1"># When LIGGGHTS supports multiple multisphere groups, I should uncomment this</span>
      <span class="c1">#self.createGroup(*(&#39;multi type&#39;, (&#39; {}&#39; * len(multi)).format(*multi)))</span>
      <span class="n">ms</span> <span class="o">=</span> <span class="bp">True</span>
      <span class="k">for</span> <span class="n">integ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">integ</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;multisphere&#39;</span><span class="p">):</span>
          <span class="n">ms</span> <span class="o">=</span> <span class="bp">False</span>
      <span class="k">if</span> <span class="n">ms</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;multisphere_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} group{} multisphere&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">multi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.setupNeighbor">
    <p>def <span class="ident">setupNeighbor</span>(</p><p>self, **params)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets up NNS list parameters</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.setupNeighbor', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.setupNeighbor" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setupNeighbor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Sets up NNS list parameters</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up nearest neighbor searching parameters&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="s1">&#39;nns_freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;nns_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="k">if</span> <span class="s1">&#39;nns_skin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;secies&#39;</span><span class="p">]:</span>
      <span class="k">if</span> <span class="s1">&#39;radius&#39;</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;nns_skin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">4</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;neighbor {nns_skin} {nns_type}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;neigh_modify delay 0 every {nns_freq} check yes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.setupParticles">
    <p>def <span class="ident">setupParticles</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Setup particle for insertion if requested by the user</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.setupParticles', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.setupParticles" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setupParticles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Setup particle for insertion if requested by the user</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]:</span>
    <span class="c1"># Make sure we are setting up particles, not walls (so we check for id existence)</span>
    <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">ss</span> <span class="ow">and</span> <span class="s1">&#39;wall&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up particles for group{id}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">))</span>
      <span class="n">randName</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>
      <span class="n">pddName</span> <span class="o">=</span> <span class="s1">&#39;pdd&#39;</span> <span class="o">+</span> <span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">))</span>
      <span class="k">if</span> <span class="s1">&#39;vol_lim&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;vol_lim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-20</span>
      <span class="nb">id</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;group group{} type {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span>
      <span class="k">if</span> <span class="s1">&#39;args&#39;</span><span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">()</span>
      <span class="k">if</span> <span class="s1">&#39;radius&#39;</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;group{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; particletemplate/{style} 15485867 volume_limit {vol_lim} atom_type {id} density constant {density} radius&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">radius</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">radius</span><span class="p">)</span> \
        <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;group{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; particletemplate/{style} 15485867 volume_limit {vol_lim} atom_type {id} density constant {density}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
      
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pddName</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;group{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; particledistribution/discrete 67867967 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; {} 1.0&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randName</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;multisphere&#39;</span><span class="p">:</span>
        <span class="n">itype</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">itype</span> <span class="o">=</span> <span class="s1">&#39;nve/{style}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">ss</span><span class="p">)</span>
      <span class="c1">#Do NOT unfix randName! Will cause a memory corruption error</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">pddName</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pddName</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.setupPhysics">
    <p>def <span class="ident">setupPhysics</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Specify the interation forces</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.setupPhysics', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.setupPhysics" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setupPhysics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Specify the interation forces</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Setting up interaction parameters&#39;</span><span class="p">)</span>
  <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;model-args&#39;</span><span class="p">]</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;pair_style &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;pair_coeff * *&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.setupWall">
    <p>def <span class="ident">setupWall</span>(</p><p>self, wtype, species=None, plane=None, peq=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a wall
@ name: name of the variable defining a wall or a mesh
@ wtype: type of the wall (primitive or mesh)
@ plane: x, y, or z plane for primitive walls
@ peq: plane equation for primitive walls</p>
<p>This function can be called only ONCE for setting up all walls (restriction from LIGGGHTS)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.setupWall', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.setupWall" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setupWall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wtype</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">plane</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">peq</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Creates a wall</span>
<span class="sd">  @ name: name of the variable defining a wall or a mesh</span>
<span class="sd">  @ wtype: type of the wall (primitive or mesh)</span>
<span class="sd">  @ plane: x, y, or z plane for primitive walls</span>
<span class="sd">  @ peq: plane equation for primitive walls</span>
<span class="sd">  This function can be called only ONCE for setting up all walls (restriction from LIGGGHTS)</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">gran</span> <span class="o">=</span> <span class="s1">&#39;gran&#39;</span> <span class="c1"># VERY HACKISH</span>
  <span class="n">model</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">modelExtra</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e8</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;model-args&#39;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">):</span>
      <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;cohesion&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;tangential &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;rolling_friction&#39;</span><span class="p">):</span>
      <span class="n">modelExtra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
  <span class="c1"># Replace any user-specified model args for all mesh walls</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">wtype</span> <span class="o">==</span> <span class="s1">&#39;mesh&#39;</span><span class="p">:</span>
      <span class="n">kname</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">kname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">kname</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span> <span class="c1"># make sure this is an actual mesh keyword, not a mesh defined with a keyname same as a mesh arg!</span>
          <span class="n">modelExtra</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">kname</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">kname</span><span class="p">]</span>
  <span class="n">model</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
  <span class="n">modelExtra</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">)</span>
  <span class="c1"># Can we take model args into account for walls???</span>
  <span class="k">if</span> <span class="n">wtype</span> <span class="o">==</span> <span class="s1">&#39;mesh&#39;</span><span class="p">:</span>
    <span class="n">meshName</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">mname</span> <span class="k">for</span> <span class="n">mname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">][</span><span class="n">mname</span><span class="p">]])</span>
    <span class="n">nMeshes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">meshName</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix walls all wall/{} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gran</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">model</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">modelExtra</span><span class="p">)</span> <span class="o">+</span> \
    <span class="s1">&#39;{} n_meshes {} meshes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wtype</span><span class="p">,</span> <span class="n">nMeshes</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {} &#39;</span> <span class="o">*</span> <span class="n">nMeshes</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">meshName</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">wtype</span> <span class="o">==</span> <span class="s1">&#39;primitive&#39;</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;fix {} all wall/{} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">gran</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">model</span><span class="p">)</span> <span class="o">+</span>  <span class="p">(</span><span class="s1">&#39;{} &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelExtra</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">modelExtra</span><span class="p">)</span> <span class="o">+</span> \
      <span class="s1">&#39;{} type {} {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wtype</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">peq</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Wall type can be either primitive or mesh&#39;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">name</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.DEMPy.velocity">
    <p>def <span class="ident">velocity</span>(</p><p>self, *args)</p>
    </div>
    

    
  
    <div class="desc"><p>Assigns velocity to selected particles.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.DEMPy.velocity', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.DEMPy.velocity" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Assigns velocity to selected particles.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;velocity&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; {}&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="PyGran.Simulator.engine_liggghts.DEMPy.lmp" class="name">var <span class="ident">lmp</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyGran.Simulator.engine_liggghts.DEMPy.monitorList" class="name">var <span class="ident">monitorList</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyGran.Simulator.engine_liggghts.DEMPy.nSS" class="name">var <span class="ident">nSS</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyGran.Simulator.engine_liggghts.DEMPy.output" class="name">var <span class="ident">output</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyGran.Simulator.engine_liggghts.DEMPy.pargs" class="name">var <span class="ident">pargs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyGran.Simulator.engine_liggghts.DEMPy.path" class="name">var <span class="ident">path</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyGran.Simulator.engine_liggghts.DEMPy.rank" class="name">var <span class="ident">rank</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyGran.Simulator.engine_liggghts.DEMPy.split" class="name">var <span class="ident">split</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyGran.Simulator.engine_liggghts.DEMPy.vars" class="name">var <span class="ident">vars</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="PyGran.Simulator.engine_liggghts.liggghts" class="name">class <span class="ident">liggghts</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">liggghts</span><span class="p">:</span>
  <span class="c1"># detect if Python is using version of mpi4py that can pass a communicator</span>

  <span class="n">has_mpi4py_v2</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
    <span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">mpi4py_version</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">mpi4py_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">has_mpi4py_v2</span> <span class="o">=</span> <span class="bp">True</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

  <span class="c1"># create instance of LIGGGHTS</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">library</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;spherical&#39;</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;si&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cmdargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">ptr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">comm</span><span class="p">:</span>
      <span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>

    <span class="k">if</span> <span class="n">library</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Using &quot;</span> <span class="o">+</span> <span class="n">library</span> <span class="o">+</span> <span class="s2">&quot; as a shared library for DEM computations&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Make sure &quot;</span> <span class="o">+</span> <span class="n">library</span> <span class="o">+</span> <span class="s2">&quot; is properly installed on your system&quot;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Catastrophic FAILURE: library {} detected by one processor but not found by another&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">library</span><span class="p">))</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="n">library</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">RTLD_GLOBAL</span><span class="p">)</span>

    <span class="c1"># if no ptr provided, create an instance of LIGGGHTS</span>
    <span class="c1">#   don&#39;t know how to pass an MPI communicator from PyPar</span>
    <span class="c1">#   but we can pass an MPI communicator from mpi4py v2.0.0 and later</span>
    <span class="c1">#   no_mpi call lets LIGGGHTS use MPI_COMM_WORLD</span>
    <span class="c1">#   cargs = array of C strings from args</span>
    <span class="c1"># if ptr, then are embedding Python in LIGGGHTS input script</span>
    <span class="c1">#   ptr is the desired instance of LIGGGHTS</span>
    <span class="c1">#   just convert it to ctypes ptr and store in self.lmp</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ptr</span><span class="p">:</span>
      <span class="c1"># with mpi4py v2, can pass MPI communicator to LIGGGHTS</span>
      <span class="c1"># need to adjust for type of MPI communicator object</span>
      <span class="c1"># allow for int (like MPICH) or void* (like OpenMPI)</span>

      <span class="k">if</span> <span class="n">liggghts</span><span class="o">.</span><span class="n">has_mpi4py_v2</span> <span class="ow">and</span> <span class="n">comm</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">liggghts</span><span class="o">.</span><span class="n">MPI</span><span class="o">.</span><span class="n">_sizeof</span><span class="p">(</span><span class="n">liggghts</span><span class="o">.</span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm</span><span class="p">)</span> <span class="o">==</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">sizeof</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">):</span>
          <span class="n">MPI_Comm</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">MPI_Comm</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>

        <span class="n">narg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cargs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">cmdargs</span><span class="p">:</span>
          <span class="n">cmdargs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;liggghts.py&quot;</span><span class="p">)</span>
          <span class="n">narg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmdargs</span><span class="p">)</span>
          <span class="n">cargs</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="o">*</span><span class="n">narg</span><span class="p">)(</span><span class="o">*</span><span class="n">cmdargs</span><span class="p">)</span>
          <span class="c1">#self.lib.lammps_open.argtypes = [ctypes.c_int, ctypes.c_char_p*narg, \</span>
                                           <span class="c1">#MPI_Comm, ctypes.c_void_p()]</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> \
                                           <span class="n">MPI_Comm</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()]</span>

        <span class="c1">#self.lib.lammps_open.restype = None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()</span>
        <span class="n">comm_ptr</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">_addressof</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
        <span class="n">comm_val</span> <span class="o">=</span> <span class="n">MPI_Comm</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="n">comm_ptr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open</span><span class="p">(</span><span class="n">narg</span><span class="p">,</span><span class="n">cargs</span><span class="p">,</span><span class="n">comm_val</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">))</span>
        
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">cmdargs</span><span class="p">:</span>
          <span class="n">cmdargs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;liggghts.py&quot;</span><span class="p">)</span>
          <span class="n">narg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmdargs</span><span class="p">)</span>
          <span class="n">cargs</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="o">*</span><span class="n">narg</span><span class="p">)(</span><span class="o">*</span><span class="n">cmdargs</span><span class="p">)</span>
          
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open_no_mpi</span><span class="p">(</span><span class="n">narg</span><span class="p">,</span><span class="n">cargs</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open_no_mpi</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">fbyref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">))</span>
          <span class="c1"># could use just this if LIGGGHTS lib interface supported it</span>
          <span class="c1"># self.lmp = self.lib.lammps_open_no_mpi(0,None)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="c1"># magic to convert ptr to ctypes ptr</span>
      <span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCObject_AsVoidPtr</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>
      <span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCObject_AsVoidPtr</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">py_object</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">(</span><span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCObject_AsVoidPtr</span><span class="p">(</span><span class="n">ptr</span><span class="p">))</span>

  <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;lmp&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">opened</span><span class="p">:</span> 
      <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opened</span><span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">file</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">file</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cmd</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">cmd</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">extract_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">extract_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ptr</span>

  <span class="k">def</span> <span class="nf">extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">style</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">ptr</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">ptr</span>
    <span class="k">return</span> <span class="bp">None</span>

  <span class="c1"># in case of global datum, free memory for 1 double via lammps_free()</span>
  <span class="c1"># double was allocated by library interface function</span>

  <span class="k">def</span> <span class="nf">extract_fix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_free</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">result</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">style</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">style</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">ptr</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">None</span>

  <span class="c1"># free memory for 1 double or 1 vector of doubles via lammps_free()</span>
  <span class="c1"># for vector, must copy nlocal returned values to local c_double vector</span>
  <span class="c1"># memory was allocated by library interface function</span>

  <span class="k">def</span> <span class="nf">extract_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">group</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">group</span><span class="p">)</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_free</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">result</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)</span>
      <span class="n">nlocalptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="s2">&quot;nlocal&quot;</span><span class="p">)</span>
      <span class="n">nlocal</span> <span class="o">=</span> <span class="n">nlocalptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="o">*</span><span class="n">nlocal</span><span class="p">)()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
      <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">group</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nlocal</span><span class="p">):</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_free</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="bp">None</span>

  <span class="c1"># set variable value</span>
  <span class="c1"># value is converted to string</span>
  <span class="c1"># returns 0 for success, -1 if failed</span>

  <span class="k">def</span> <span class="nf">set_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_set_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
  <span class="c1"># return total number of atoms in system</span>

  <span class="k">def</span> <span class="nf">get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>

  <span class="c1"># return vector of atom properties gathered across procs, ordered by atom ID</span>

  <span class="k">def</span> <span class="nf">gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">):</span>
    <span class="n">natoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">data</span> <span class="o">=</span> <span class="p">((</span><span class="n">count</span><span class="o">*</span><span class="n">natoms</span><span class="p">)</span><span class="o">*</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">data</span> <span class="o">=</span> <span class="p">((</span><span class="n">count</span><span class="o">*</span><span class="n">natoms</span><span class="p">)</span><span class="o">*</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">data</span>

  <span class="c1"># scatter vector of atom properties across procs, ordered by atom ID</span>
  <span class="c1"># assume vector is of correct type and length, as created by gather_atoms()</span>

  <span class="k">def</span> <span class="nf">scatter_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_scatter_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#PyGran.Simulator.engine_liggghts.liggghts">liggghts</a></li>
          <li><a href="/builtins.object.ext">builtins.object</a></li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="PyGran.Simulator.engine_liggghts.liggghts.MPI" class="name">var <span class="ident">MPI</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyGran.Simulator.engine_liggghts.liggghts.has_mpi4py_v2" class="name">var <span class="ident">has_mpi4py_v2</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyGran.Simulator.engine_liggghts.liggghts.mpi4py_version" class="name">var <span class="ident">mpi4py_version</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.liggghts.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, library=None, style=&#39;spherical&#39;, dim=3, units=&#39;si&#39;, path=None, cmdargs=[], ptr=None, comm=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts.__init__', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">library</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;spherical&#39;</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;si&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cmdargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">ptr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">comm</span><span class="p">:</span>
    <span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
  <span class="k">if</span> <span class="n">library</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">():</span>
      <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Using &quot;</span> <span class="o">+</span> <span class="n">library</span> <span class="o">+</span> <span class="s2">&quot; as a shared library for DEM computations&quot;</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">():</span>
      <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Make sure &quot;</span> <span class="o">+</span> <span class="n">library</span> <span class="o">+</span> <span class="s2">&quot; is properly installed on your system&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Catastrophic FAILURE: library {} detected by one processor but not found by another&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">library</span><span class="p">))</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="n">library</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">RTLD_GLOBAL</span><span class="p">)</span>
  <span class="c1"># if no ptr provided, create an instance of LIGGGHTS</span>
  <span class="c1">#   don&#39;t know how to pass an MPI communicator from PyPar</span>
  <span class="c1">#   but we can pass an MPI communicator from mpi4py v2.0.0 and later</span>
  <span class="c1">#   no_mpi call lets LIGGGHTS use MPI_COMM_WORLD</span>
  <span class="c1">#   cargs = array of C strings from args</span>
  <span class="c1"># if ptr, then are embedding Python in LIGGGHTS input script</span>
  <span class="c1">#   ptr is the desired instance of LIGGGHTS</span>
  <span class="c1">#   just convert it to ctypes ptr and store in self.lmp</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">ptr</span><span class="p">:</span>
    <span class="c1"># with mpi4py v2, can pass MPI communicator to LIGGGHTS</span>
    <span class="c1"># need to adjust for type of MPI communicator object</span>
    <span class="c1"># allow for int (like MPICH) or void* (like OpenMPI)</span>
    <span class="k">if</span> <span class="n">liggghts</span><span class="o">.</span><span class="n">has_mpi4py_v2</span> <span class="ow">and</span> <span class="n">comm</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">liggghts</span><span class="o">.</span><span class="n">MPI</span><span class="o">.</span><span class="n">_sizeof</span><span class="p">(</span><span class="n">liggghts</span><span class="o">.</span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm</span><span class="p">)</span> <span class="o">==</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">sizeof</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">):</span>
        <span class="n">MPI_Comm</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">MPI_Comm</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>
      <span class="n">narg</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">cargs</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="n">cmdargs</span><span class="p">:</span>
        <span class="n">cmdargs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;liggghts.py&quot;</span><span class="p">)</span>
        <span class="n">narg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmdargs</span><span class="p">)</span>
        <span class="n">cargs</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="o">*</span><span class="n">narg</span><span class="p">)(</span><span class="o">*</span><span class="n">cmdargs</span><span class="p">)</span>
        <span class="c1">#self.lib.lammps_open.argtypes = [ctypes.c_int, ctypes.c_char_p*narg, \</span>
                                         <span class="c1">#MPI_Comm, ctypes.c_void_p()]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> \
                                         <span class="n">MPI_Comm</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()]</span>
      <span class="c1">#self.lib.lammps_open.restype = None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()</span>
      <span class="n">comm_ptr</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">_addressof</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
      <span class="n">comm_val</span> <span class="o">=</span> <span class="n">MPI_Comm</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="n">comm_ptr</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open</span><span class="p">(</span><span class="n">narg</span><span class="p">,</span><span class="n">cargs</span><span class="p">,</span><span class="n">comm_val</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">))</span>
      
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="n">cmdargs</span><span class="p">:</span>
        <span class="n">cmdargs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;liggghts.py&quot;</span><span class="p">)</span>
        <span class="n">narg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmdargs</span><span class="p">)</span>
        <span class="n">cargs</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="o">*</span><span class="n">narg</span><span class="p">)(</span><span class="o">*</span><span class="n">cmdargs</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open_no_mpi</span><span class="p">(</span><span class="n">narg</span><span class="p">,</span><span class="n">cargs</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_open_no_mpi</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">fbyref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">))</span>
        <span class="c1"># could use just this if LIGGGHTS lib interface supported it</span>
        <span class="c1"># self.lmp = self.lib.lammps_open_no_mpi(0,None)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># magic to convert ptr to ctypes ptr</span>
    <span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCObject_AsVoidPtr</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>
    <span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCObject_AsVoidPtr</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">py_object</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">(</span><span class="n">pythonapi</span><span class="o">.</span><span class="n">PyCObject_AsVoidPtr</span><span class="p">(</span><span class="n">ptr</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.liggghts.close">
    <p>def <span class="ident">close</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts.close', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts.close" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opened</span><span class="p">:</span> 
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.liggghts.command">
    <p>def <span class="ident">command</span>(</p><p>self, cmd)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts.command', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts.command" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cmd</span><span class="p">):</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.liggghts.extract_atom">
    <p>def <span class="ident">extract_atom</span>(</p><p>self, name, type)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts.extract_atom', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts.extract_atom" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extract_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
  <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)</span>
  <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">))</span>
  <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
  <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
  <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_atom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">ptr</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.liggghts.extract_compute">
    <p>def <span class="ident">extract_compute</span>(</p><p>self, id, style, type)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts.extract_compute', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts.extract_compute" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
  <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">style</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ptr</span>
  <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ptr</span>
  <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.liggghts.extract_fix">
    <p>def <span class="ident">extract_fix</span>(</p><p>self, id, style, type, i=0, j=0)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts.extract_fix', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts.extract_fix" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extract_fix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_free</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
  <span class="k">elif</span> <span class="p">(</span><span class="n">style</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">style</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">None</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_fix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">style</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ptr</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.liggghts.extract_global">
    <p>def <span class="ident">extract_global</span>(</p><p>self, name, type)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts.extract_global', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts.extract_global" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extract_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
  <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)</span>
  <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
  <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.liggghts.extract_variable">
    <p>def <span class="ident">extract_variable</span>(</p><p>self, name, group, type)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts.extract_variable', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts.extract_variable" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extract_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">group</span><span class="p">,</span><span class="nb">type</span><span class="p">):</span>
  <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">group</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_free</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
  <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)</span>
    <span class="n">nlocalptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_global</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="s2">&quot;nlocal&quot;</span><span class="p">)</span>
    <span class="n">nlocal</span> <span class="o">=</span> <span class="n">nlocalptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="o">*</span><span class="n">nlocal</span><span class="p">)()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_extract_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">group</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nlocal</span><span class="p">):</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_free</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
  <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.liggghts.file">
    <p>def <span class="ident">file</span>(</p><p>self, file)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts.file', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts.file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">file</span><span class="p">):</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="nb">file</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.liggghts.gather_atoms">
    <p>def <span class="ident">gather_atoms</span>(</p><p>self, name, type, count)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts.gather_atoms', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts.gather_atoms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">):</span>
  <span class="n">natoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">((</span><span class="n">count</span><span class="o">*</span><span class="n">natoms</span><span class="p">)</span><span class="o">*</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">)()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
  <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">((</span><span class="n">count</span><span class="o">*</span><span class="n">natoms</span><span class="p">)</span><span class="o">*</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">)()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_gather_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
  <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.liggghts.get_natoms">
    <p>def <span class="ident">get_natoms</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts.get_natoms', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts.get_natoms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_get_natoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.liggghts.scatter_atoms">
    <p>def <span class="ident">scatter_atoms</span>(</p><p>self, name, type, count, data)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts.scatter_atoms', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts.scatter_atoms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">scatter_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_scatter_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.liggghts.set_variable">
    <p>def <span class="ident">set_variable</span>(</p><p>self, name, value)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts.set_variable', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts.set_variable" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_set_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyGran.Simulator.engine_liggghts.liggghts.version">
    <p>def <span class="ident">version</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyGran.Simulator.engine_liggghts.liggghts.version', this);">Show source &equiv;</a></p>
  <div id="source-PyGran.Simulator.engine_liggghts.liggghts.version" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">lammps_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmp</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="PyGran.Simulator.engine_liggghts.liggghts.lib" class="name">var <span class="ident">lib</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
